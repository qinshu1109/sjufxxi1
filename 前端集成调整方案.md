# å‰ç«¯é›†æˆè°ƒæ•´æ–¹æ¡ˆ - DB-GPT / AWEL

**ç‰ˆæœ¬**: 2.0 (é‡æ„å¸ˆä¿®è®¢ç‰ˆ)  
**æ›´æ–°æ—¶é—´**: 2025-06-16  
**çŠ¶æ€**: ğŸ”„ æ¶æ„é‡æ–°è®¾è®¡

## ğŸ“Š å½“å‰çŠ¶æ€é‡æ–°è¯„ä¼°

### ğŸ” å®é™…æ¶æ„å‘ç°
ç»è¿‡æ·±å…¥ä»£ç åˆ†æï¼Œå‘ç°ä¸åŸæ¸…å•å‡è®¾çš„å·®å¼‚ï¼š

| åŸå‡è®¾ | å®é™…æƒ…å†µ | å½±å“ |
|--------|----------|------|
| å­˜åœ¨ä¸»ç«™Reactåº”ç”¨ | âŒ ä¸å­˜åœ¨ï¼Œåªæœ‰DB-GPT Next.jsåº”ç”¨ | éœ€è¦é‡æ–°è®¾è®¡é›†æˆç­–ç•¥ |
| éœ€è¦è·¯ç”±é›†æˆ | âœ… DB-GPTå·²æœ‰å®Œæ•´è·¯ç”±ç³»ç»Ÿ | å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ–æ‰©å±• |
| éœ€è¦ç»„ä»¶å¯¹æ¥ | âœ… DB-GPTå·²æœ‰å®Œæ•´ç»„ä»¶åº“ | å¯ä»¥ç›´æ¥ä½¿ç”¨ |
| éœ€è¦æ ·å¼ç»Ÿä¸€ | âœ… DB-GPTå·²ä½¿ç”¨Ant Design + Tailwind | æ ·å¼å·²ç»Ÿä¸€ |

### ğŸ—ï¸ å½“å‰æŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: Next.js 13+ (DB-GPT Web)
- **UIç»„ä»¶åº“**: Ant Design 5.x + Tailwind CSS
- **çŠ¶æ€ç®¡ç†**: React Context + Hooks
- **å›¾è¡¨åº“**: @antv/g2, @antv/g6, @antv/gpt-vis
- **ç¼–è¾‘å™¨**: Monaco Editor (SQLç¼–è¾‘)
- **å›½é™…åŒ–**: react-i18next

## ğŸ¯ é‡æ–°è®¾è®¡çš„é›†æˆæ–¹æ¡ˆ

### æ–¹æ¡ˆA: æ‰©å±•ç°æœ‰DB-GPTå‰ç«¯ (æ¨è)
**ä¼˜åŠ¿**: æœ€å°åŒ–æ”¹åŠ¨ï¼Œå¿«é€Ÿä¸Šçº¿  
**å®æ–½éš¾åº¦**: â­â­â˜†â˜†â˜†

#### æ ¸å¿ƒè°ƒæ•´ç‚¹
1. **è·¯ç”±æ‰©å±•** - åœ¨ç°æœ‰Next.jsè·¯ç”±åŸºç¡€ä¸Šæ·»åŠ ä¸šåŠ¡è·¯ç”±
2. **ç»„ä»¶å¢å¼º** - æ‰©å±•ç°æœ‰ç»„ä»¶ï¼Œæ·»åŠ æŠ–éŸ³æ•°æ®åˆ†æç‰¹å®šåŠŸèƒ½
3. **APIé›†æˆ** - æ•´åˆDifyå’ŒDB-GPTçš„APIè°ƒç”¨
4. **ä¸»é¢˜å®šåˆ¶** - åŸºäºç°æœ‰ä¸»é¢˜ç³»ç»Ÿè¿›è¡Œå“ç‰Œå®šåˆ¶

### æ–¹æ¡ˆB: æ„å»ºç‹¬ç«‹Reactåº”ç”¨ + å¾®å‰ç«¯é›†æˆ
**ä¼˜åŠ¿**: æ¶æ„æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤  
**å®æ–½éš¾åº¦**: â­â­â­â­â˜†

#### æ ¸å¿ƒè°ƒæ•´ç‚¹
1. **åˆ›å»ºä¸»ç«™åº”ç”¨** - ä½¿ç”¨Vite + Reactæ„å»ºä¸»ç«™
2. **å¾®å‰ç«¯é›†æˆ** - ä½¿ç”¨qiankunæˆ–Module Federation
3. **ç»Ÿä¸€ç½‘å…³** - Nginxç»Ÿä¸€è·¯ç”±åˆ†å‘
4. **çŠ¶æ€å…±äº«** - è·¨åº”ç”¨çŠ¶æ€ç®¡ç†

## ğŸ“‹ è¯¦ç»†å®æ–½è®¡åˆ’ (æ–¹æ¡ˆA)

### é˜¶æ®µä¸€: åŸºç¡€é›†æˆ (1-2å¤©)

#### 1.1 ç¯å¢ƒé…ç½®è°ƒæ•´
```bash
# åœ¨external/dbgpt/webç›®å½•ä¸‹
cp .env.template .env.local
```

**é…ç½®å†…å®¹**:
```env
# APIé…ç½®
API_BASE_URL=http://localhost:5000
DIFY_API_URL=http://localhost/api
FEISHU_WEBHOOK_URL=your_webhook_url

# åŠŸèƒ½å¼€å…³
ENABLE_DOUYIN_ANALYTICS=true
ENABLE_DIFY_INTEGRATION=true
```

#### 1.2 è·¯ç”±æ‰©å±•
åœ¨ `external/dbgpt/web/pages/` ä¸‹æ–°å¢ï¼š
- `analytics/` - æŠ–éŸ³æ•°æ®åˆ†æé¡µé¢
- `dify-chat/` - DifyèŠå¤©é›†æˆé¡µé¢
- `reports/` - æŠ¥è¡¨é¡µé¢

#### 1.3 ä¾§è¾¹æ èœå•æ‰©å±•
ä¿®æ”¹ `external/dbgpt/web/new-components/layout/Construct.tsx`ï¼š

```typescript
const menuItems = [
  // ç°æœ‰èœå•...
  {
    key: 'analytics',
    name: t('douyin_analytics'),
    icon: <BarChartOutlined />,
    path: '/analytics',
  },
  {
    key: 'dify-chat',
    name: t('ai_assistant'),
    icon: <MessageOutlined />,
    path: '/dify-chat',
  },
  {
    key: 'reports',
    name: t('reports'),
    icon: <FileTextOutlined />,
    path: '/reports',
  },
];
```

### é˜¶æ®µäºŒ: APIé›†æˆ (2-3å¤©)

#### 2.1 ç»Ÿä¸€APIå®¢æˆ·ç«¯
åˆ›å»º `external/dbgpt/web/client/api/analytics.ts`ï¼š

```typescript
// æŠ–éŸ³æ•°æ®åˆ†æAPI
export const getAnalyticsData = (params: AnalyticsParams) => {
  return GET<AnalyticsParams, AnalyticsResponse>('/api/v1/analytics/data', params);
};

// Difyé›†æˆAPI
export const sendDifyMessage = (message: string) => {
  return POST<DifyMessageRequest, DifyMessageResponse>('/api/v1/dify/chat', { message });
};

// é£ä¹¦å‘Šè­¦API
export const sendFeishuAlert = (alert: AlertData) => {
  return POST<AlertData, AlertResponse>('/api/v1/feishu/alert', alert);
};
```

#### 2.2 APIä»£ç†é…ç½®
ä¿®æ”¹ `external/dbgpt/web/next.config.js`ï¼š

```javascript
const nextConfig = {
  // ç°æœ‰é…ç½®...
  async rewrites() {
    return [
      {
        source: '/api/dify/:path*',
        destination: 'http://localhost/api/:path*',
      },
      {
        source: '/api/analytics/:path*',
        destination: 'http://localhost:5000/api/v1/:path*',
      },
    ];
  },
};
```

### é˜¶æ®µä¸‰: ç»„ä»¶å¼€å‘ (3-4å¤©)

#### 3.1 æ•°æ®åˆ†æç»„ä»¶
- `AnalyticsDashboard` - æ•°æ®åˆ†æä»ªè¡¨æ¿
- `TrendChart` - è¶‹åŠ¿å›¾è¡¨ç»„ä»¶
- `DataTable` - æ•°æ®è¡¨æ ¼ç»„ä»¶
- `FilterPanel` - ç­›é€‰é¢æ¿

#### 3.2 èŠå¤©é›†æˆç»„ä»¶
- `DifyChatBox` - DifyèŠå¤©æ¡†é›†æˆ
- `NL2SQLPanel` - è‡ªç„¶è¯­è¨€è½¬SQLé¢æ¿
- `QueryHistory` - æŸ¥è¯¢å†å²ç»„ä»¶

#### 3.3 æŠ¥è¡¨ç»„ä»¶
- `ReportBuilder` - æŠ¥è¡¨æ„å»ºå™¨
- `ChartRenderer` - å›¾è¡¨æ¸²æŸ“å™¨
- `ExportPanel` - å¯¼å‡ºé¢æ¿

### é˜¶æ®µå››: æ ·å¼å’Œä¸»é¢˜ (1-2å¤©)

#### 4.1 ä¸»é¢˜æ‰©å±•
ä¿®æ”¹ `external/dbgpt/web/tailwind.config.js`ï¼š

```javascript
module.exports = {
  theme: {
    extend: {
      colors: {
        // æŠ–éŸ³å“ç‰Œè‰²
        douyin: {
          primary: '#fe2c55',
          secondary: '#25f4ee',
          dark: '#161823',
        },
        // ç°æœ‰ä¸»é¢˜è‰²...
      },
    },
  },
};
```

#### 4.2 ç»„ä»¶æ ·å¼ç»Ÿä¸€
ä½¿ç”¨Ant Design ConfigProviderç»Ÿä¸€ä¸»é¢˜ï¼š

```typescript
const theme = {
  token: {
    colorPrimary: '#fe2c55', // æŠ–éŸ³çº¢
    borderRadius: 8,
    colorBgContainer: '#ffffff',
  },
  components: {
    Button: {
      borderRadius: 8,
    },
    Card: {
      borderRadius: 12,
    },
  },
};
```

### é˜¶æ®µäº”: æ„å»ºå’Œéƒ¨ç½² (1å¤©)

#### 5.1 æ„å»ºè„šæœ¬ä¼˜åŒ–
ä¿®æ”¹ `external/dbgpt/web/package.json`ï¼š

```json
{
  "scripts": {
    "build:analytics": "NODE_ENV=production next build",
    "build:static": "next build && next export",
    "start:analytics": "next start -p 3000"
  }
}
```

#### 5.2 éƒ¨ç½²é…ç½®
æ›´æ–° `podman-compose.yml`ï¼š

```yaml
services:
  dbgpt-web:
    build:
      context: ./external/dbgpt/web
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - API_BASE_URL=http://dbgpt-api:5000
      - DIFY_API_URL=http://api:5000
    depends_on:
      - dbgpt-api
      - api
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨æŒ‡å—

### å¼€å‘ç¯å¢ƒå¯åŠ¨
```bash
# 1. è¿›å…¥DB-GPT Webç›®å½•
cd external/dbgpt/web

# 2. å®‰è£…ä¾èµ–
yarn install

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.template .env.local
# ç¼–è¾‘ .env.local é…ç½®APIåœ°å€

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
yarn dev

# 5. è®¿é—®åº”ç”¨
# http://localhost:3000 - DB-GPTä¸»ç•Œé¢
# http://localhost:3000/analytics - æŠ–éŸ³æ•°æ®åˆ†æ
# http://localhost:3000/dify-chat - AIåŠ©æ‰‹
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# 1. æ„å»ºé™æ€æ–‡ä»¶
cd external/dbgpt/web
yarn build:static

# 2. å¯åŠ¨å®¹å™¨æœåŠ¡
cd ../../
podman-compose up -d

# 3. éªŒè¯éƒ¨ç½²
curl http://localhost:3000/health
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ç”¨æˆ·ä½“éªŒ
- **ç»Ÿä¸€ç•Œé¢**: ä¸€ä¸ªåº”ç”¨å†…å®Œæˆæ‰€æœ‰æ•°æ®åˆ†æä»»åŠ¡
- **æ— ç¼åˆ‡æ¢**: åœ¨èŠå¤©ã€SQLå®éªŒå®¤ã€æŠ¥è¡¨ä¹‹é—´æµç•…åˆ‡æ¢
- **æ™ºèƒ½äº¤äº’**: è‡ªç„¶è¯­è¨€æŸ¥è¯¢ + å¯è§†åŒ–ç»“æœ
- **å®æ—¶æ›´æ–°**: æ•°æ®å˜åŒ–å®æ—¶åæ˜ åœ¨ç•Œé¢ä¸Š

### æŠ€æœ¯ä¼˜åŠ¿
- **æ€§èƒ½ä¼˜åŒ–**: Next.js SSR + é™æ€ç”Ÿæˆ
- **SEOå‹å¥½**: æœåŠ¡ç«¯æ¸²æŸ“æ”¯æŒ
- **å¼€å‘æ•ˆç‡**: åŸºäºæˆç†Ÿçš„DB-GPTæ¡†æ¶
- **ç»´æŠ¤æˆæœ¬**: å•ä¸€æŠ€æœ¯æ ˆï¼Œé™ä½ç»´æŠ¤å¤æ‚åº¦

## ğŸ”„ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**: é˜¶æ®µä¸€åŸºç¡€é›†æˆ (é¢„è®¡2å¤©)
2. **å¹¶è¡Œå¼€å‘**: é˜¶æ®µäºŒAPIé›†æˆ + é˜¶æ®µä¸‰ç»„ä»¶å¼€å‘
3. **æµ‹è¯•éªŒè¯**: åŠŸèƒ½æµ‹è¯• + æ€§èƒ½æµ‹è¯•
4. **ä¸Šçº¿éƒ¨ç½²**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² + ç›‘æ§é…ç½®

æ‚¨å¸Œæœ›æˆ‘ç«‹å³å¼€å§‹å®æ–½å“ªä¸ªé˜¶æ®µï¼Ÿæˆ‘å»ºè®®ä»é˜¶æ®µä¸€çš„åŸºç¡€é›†æˆå¼€å§‹ã€‚
