(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7643],{71965:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var i=n(87462),s=n(67294),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},a=n(13401),o=s.forwardRef(function(t,e){return s.createElement(a.Z,(0,i.Z)({},t,{ref:e,icon:r}))})},81746:function(t){"undefined"!=typeof self&&self,t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e){t.exports={assign:Object.assign,getHeight:function(t,e,n,i){return void 0===i&&(i="height"),"center"===n?(t[i]+e[i])/2:t.height}}},function(t,e,n){var i=n(3),s=function(){function t(t,e){void 0===e&&(e={}),this.options=e,this.rootNode=i(t,e)}return t.prototype.execute=function(){throw Error("please override this method")},t}();t.exports=s},function(t,e,n){var i=n(4),s=["LR","RL","TB","BT","H","V"],r=["LR","RL","H"],a=s[0];t.exports=function(t,e,n){var o=e.direction||a;if(e.isHorizontal=r.indexOf(o)>-1,o&&-1===s.indexOf(o))throw TypeError("Invalid direction: "+o);if(o===s[0])n(t,e);else if(o===s[1])n(t,e),t.right2left();else if(o===s[2])n(t,e);else if(o===s[3])n(t,e),t.bottom2top();else if(o===s[4]||o===s[5]){var l=i(t,e),h=l.left,c=l.right;n(h,e),n(c,e),e.isHorizontal?h.right2left():h.bottom2top(),c.translate(h.x-c.x,h.y-c.y),t.x=h.x,t.y=c.y;var d=t.getBoundingBox();e.isHorizontal?d.top<0&&t.translate(0,-d.top):d.left<0&&t.translate(-d.left,0)}var u=e.fixedRoot;return void 0===u&&(u=!0),u&&t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),t}},function(t,e,n){var i=n(0),s={getId:function(t){return t.id||t.name},getPreH:function(t){return t.preH||0},getPreV:function(t){return t.preV||0},getHGap:function(t){return t.hgap||18},getVGap:function(t){return t.vgap||18},getChildren:function(t){return t.children},getHeight:function(t){return t.height||36},getWidth:function(t){var e=t.label||" ";return t.width||18*e.split("").length}};function r(t,e){if(this.vgap=this.hgap=0,t instanceof r)return t;this.data=t;var n=e.getHGap(t),i=e.getVGap(t);return this.preH=e.getPreH(t),this.preV=e.getPreV(t),this.width=e.getWidth(t),this.height=e.getHeight(t),this.width+=this.preH,this.height+=this.preV,this.id=e.getId(t),this.x=this.y=0,this.depth=0,this.children||(this.children=[]),this.addGap(n,i),this}i.assign(r.prototype,{isRoot:function(){return 0===this.depth},isLeaf:function(){return 0===this.children.length},addGap:function(t,e){this.hgap+=t,this.vgap+=e,this.width+=2*t,this.height+=2*e},eachNode:function(t){for(var e,n=[this];e=n.shift();)t(e),n=e.children.concat(n)},DFTraverse:function(t){this.eachNode(t)},BFTraverse:function(t){for(var e,n=[this];e=n.shift();)t(e),n=n.concat(e.children)},getBoundingBox:function(){var t={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode(function(e){t.left=Math.min(t.left,e.x),t.top=Math.min(t.top,e.y),t.width=Math.max(t.width,e.x+e.width),t.height=Math.max(t.height,e.y+e.height)}),t},translate:function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.eachNode(function(n){n.x+=t,n.y+=e,n.x+=n.preH,n.y+=n.preV})},right2left:function(){var t=this.getBoundingBox();this.eachNode(function(e){e.x=e.x-(e.x-t.left)*2-e.width}),this.translate(t.width,0)},bottom2top:function(){var t=this.getBoundingBox();this.eachNode(function(e){e.y=e.y-(e.y-t.top)*2-e.height}),this.translate(0,t.height)}}),t.exports=function(t,e,n){void 0===e&&(e={}),e=i.assign({},s,e);var a,o=new r(t,e),l=[o];if(!n&&!t.collapsed){for(;a=l.shift();)if(!a.data.collapsed){var h=e.getChildren(a.data),c=h?h.length:0;if(a.children=Array(c),h&&c)for(var d=0;d<c;d++){var u=new r(h[d],e);a.children[d]=u,l.push(u),u.parent=a,u.depth=a.depth+1}}}return o}},function(t,e,n){var i=n(3);t.exports=function(t,e){for(var n=i(t.data,e,!0),s=i(t.data,e,!0),r=t.children.length,a=Math.round(r/2),o=e.getSide||function(t,e){return e<a?"right":"left"},l=0;l<r;l++){var h=t.children[l];"right"===o(h,l)?s.children.push(h):n.children.push(h)}return n.eachNode(function(t){t.isRoot()||(t.side="left")}),s.eachNode(function(t){t.isRoot()||(t.side="right")}),{left:n,right:s}}},function(t,e,n){var i={compactBox:n(6),dendrogram:n(8),indented:n(10),mindmap:n(12)};t.exports=i},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var s=n(1),r=n(7),a=n(2),o=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return a(this.rootNode,this.options,r)},e}(s),h={};t.exports=function(t,e){return e=o.assign({},h,e),new l(t,e).execute()}},function(t,e){function n(t,e,n,i){void 0===i&&(i=[]),this.w=t||0,this.h=e||0,this.y=n||0,this.x=0,this.c=i||[],this.cs=i.length,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}n.fromNode=function(t,e){if(!t)return null;var i=[];return(t.children.forEach(function(t){i.push(n.fromNode(t,e))}),e)?new n(t.height,t.width,t.x,i):new n(t.width,t.height,t.y,i)},t.exports=function(t,e){void 0===e&&(e={});var i,s=e.isHorizontal;function r(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function a(t){return t.y+t.h}function o(t,e,n){for(;null!==n&&t>=n.low;)n=n.nxt;return{low:t,index:e,nxt:n}}!function t(e,n,i){void 0===i&&(i=0),n?(e.x=i,i+=e.width):(e.y=i,i+=e.height),e.children.forEach(function(e){t(e,n,i)})}(t,s);var l=n.fromNode(t,s);return function t(e){if(0===e.cs){r(e);return}t(e.c[0]);for(var n=o(a(e.c[0].el),0,null),i=1;i<e.cs;++i){t(e.c[i]);var s=a(e.c[i].er);(function(t,e,n){for(var i=t.c[e-1],s=i.mod,r=t.c[e],o=r.mod;null!==i&&null!==r;){a(i)>n.low&&(n=n.nxt);var l,h,c,d=s+i.prelim+i.w-(o+r.prelim);d>0&&(o+=d,l=n.index,t.c[e].mod+=d,t.c[e].msel+=d,t.c[e].mser+=d,function(t,e,n,i){if(n!==e-1){var s=e-n;t.c[n+1].shift+=i/s,t.c[e].shift-=i/s,t.c[e].change-=i-i/s}}(t,e,l,d));var u=a(i),p=a(r);u<=p&&null!==(i=0===(h=i).cs?h.tr:h.c[h.cs-1])&&(s+=i.mod),u>=p&&null!==(r=0===(c=r).cs?c.tl:c.c[0])&&(o+=r.mod)}!i&&r?function(t,e,n,i){var s=t.c[0].el;s.tl=n;var r=i-n.mod-t.c[0].msel;s.mod+=r,s.prelim-=r,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,r,o):i&&!r&&function(t,e,n,i){var s=t.c[e].er;s.tr=n;var r=i-n.mod-t.c[e].mser;s.mod+=r,s.prelim-=r,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,i,s)})(e,i,n),n=o(s,i,n)}e.prelim=(e.c[0].prelim+e.c[0].mod+e.c[e.cs-1].mod+e.c[e.cs-1].prelim+e.c[e.cs-1].w)/2-e.w/2,r(e)}(l),function t(e,n){n+=e.mod,e.x=e.prelim+n,function(t){for(var e=0,n=0,i=0;i<t.cs;i++)e+=t.c[i].shift,n+=e+t.c[i].change,t.c[i].mod+=n}(e);for(var i=0;i<e.cs;i++)t(e.c[i],n)}(l,0),function t(e,n,i){i?n.y=e.x:n.x=e.x,e.c.forEach(function(e,s){t(e,n.children[s],i)})}(l,t,s),i=function t(e,n){var i=n?e.y:e.x;return e.children.forEach(function(e){i=Math.min(t(e,n),i)}),i}(t,s),function t(e,n,i){i?e.y+=n:e.x+=n,e.children.forEach(function(e){t(e,n,i)})}(t,-i,s),t}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var s=n(1),r=n(9),a=n(2),o=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return this.rootNode.width=0,a(this.rootNode,this.options,r)},e}(s),h={};t.exports=function(t,e){return e=o.assign({},h,e),new l(t,e).execute()}},function(t,e,n){var i=n(0);function s(t,e){void 0===t&&(t=0),void 0===e&&(e=[]),this.x=this.y=0,this.leftChild=this.rightChild=null,this.height=0,this.children=e}var r={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};t.exports=function(t,e){void 0===e&&(e={}),e=i.assign({},r,e);var n,a=0,o=function t(e){if(!e)return null;e.width=0,e.depth&&e.depth>a&&(a=e.depth);var n=e.children,i=n.length,r=new s(e.height,[]);return n.forEach(function(e,n){var s=t(e);r.children.push(s),0===n&&(r.leftChild=s),n===i-1&&(r.rightChild=s)}),r.originNode=e,r.isLeaf=e.isLeaf(),r}(t);return function t(e){if(e.isLeaf||0===e.children.length)e.drawingDepth=a;else{var n=e.children.map(function(e){return t(e)}),i=Math.min.apply(null,n);e.drawingDepth=i-1}return e.drawingDepth}(o),function t(i){i.x=i.drawingDepth*e.rankSep,i.isLeaf?(i.y=0,n&&(i.y=n.y+n.height+e.nodeSep,i.originNode.parent!==n.originNode.parent&&(i.y+=e.subTreeSep)),n=i):(i.children.forEach(function(e){t(e)}),i.y=(i.leftChild.y+i.rightChild.y)/2)}(o),function t(e,n,i){i?(n.x=e.x,n.y=e.y):(n.x=e.y,n.y=e.x),e.children.forEach(function(e,s){t(e,n.children[s],i)})}(o,t,e.isHorizontal),t}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var s=n(1),r=n(11),a=n(4),o=n(0),l=["LR","RL","H"],h=l[0],c=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){var t=this.options,e=this.rootNode;t.isHorizontal=!0;var n=t.indent,i=void 0===n?20:n,s=t.dropCap,o=void 0===s||s,c=t.direction,d=void 0===c?h:c,u=t.align;if(d&&-1===l.indexOf(d))throw TypeError("Invalid direction: "+d);if(d===l[0])r(e,i,o,u);else if(d===l[1])r(e,i,o,u),e.right2left();else if(d===l[2]){var p=a(e,t),g=p.left,f=p.right;r(g,i,o,u),g.right2left(),r(f,i,o,u);var y=g.getBoundingBox();f.translate(y.width,0),e.x=f.x-e.width/2}return e},e}(s),d={};t.exports=function(t,e){return e=o.assign({},d,e),new c(t,e).execute()}},function(t,e,n){var i=n(0);t.exports=function(t,e,n,s){var r=null;t.eachNode(function(t){(function(t,e,n,s,r){var a="function"==typeof n?n(t):n*t.depth;if(!s)try{if(t.id===t.parent.children[0].id){t.x+=a,t.y=e?e.y:0;return}}catch(t){}if(t.x+=a,e){if(t.y=e.y+i.getHeight(e,t,r),e.parent&&t.parent.id!==e.parent.id){var o=e.parent,l=o.y+i.getHeight(o,t,r);t.y=l>t.y?l:t.y}}else t.y=0})(t,r,e,n,s),r=t})}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var s=n(1),r=n(13),a=n(2),o=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return a(this.rootNode,this.options,r)},e}(s),h={};t.exports=function(t,e){return e=o.assign({},h,e),new l(t,e).execute()}},function(t,e,n){var i=n(0),s={getSubTreeSep:function(){return 0}};t.exports=function(t,e){void 0===e&&(e={}),e=i.assign({},s,e),t.parent={x:0,width:0,height:0,y:0},t.BFTraverse(function(t){t.x=t.parent.x+t.parent.width}),t.parent=null,function t(e,n){var i=0;return e.children.length?e.children.forEach(function(e){i+=t(e,n)}):i=e.height,e._subTreeSep=n.getSubTreeSep(e.data),e.totalHeight=Math.max(e.height,i)+2*e._subTreeSep,e.totalHeight}(t,e),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode(function(t){var e=t.children,n=e.length;if(n){var i=e[0];if(i.startY=t.startY+t._subTreeSep,1===n)i.y=t.y+t.height/2-i.height/2;else{i.y=i.startY+i.totalHeight/2-i.height/2;for(var s=1;s<n;s++){var r=e[s];r.startY=e[s-1].startY+e[s-1].totalHeight,r.y=r.startY+r.totalHeight/2-r.height/2}}}}),function t(e){var n=e.children,i=n.length;if(i){n.forEach(function(e){t(e)});var s=n[0],r=n[i-1],a=r.y-s.y+r.height,o=0;if(n.forEach(function(t){o+=t.totalHeight}),a>e.height)e.y=s.y+a/2-e.height/2;else if(1!==n.length||e.height>o){var l=e.y+(e.height-a)/2-s.y;n.forEach(function(t){t.translate(0,l)})}else e.y=(s.y+s.height/2+r.y+r.height/2)/2-e.height/2}}(t)}}])},35374:function(t,e,n){"use strict";n.d(e,{B7:function(){return f},HT:function(){return y},zO:function(){return p}});var i,s,r=0,a=0,o=0,l=0,h=0,c=0,d="object"==typeof performance&&performance.now?performance:Date,u="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function p(){return h||(u(g),h=d.now()+c)}function g(){h=0}function f(){this._call=this._time=this._next=null}function y(t,e,n){var i=new f;return i.restart(t,e,n),i}function m(){h=(l=d.now())+c,r=a=0;try{!function(){p(),++r;for(var t,e=i;e;)(t=h-e._time)>=0&&e._call.call(null,t),e=e._next;--r}()}finally{r=0,function(){for(var t,e,n=i,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:i=e);s=t,b(r)}(),h=0}}function v(){var t=d.now(),e=t-l;e>1e3&&(c-=e,l=t)}function b(t){!r&&(a&&(a=clearTimeout(a)),t-h>24?(t<1/0&&(a=setTimeout(m,t-d.now()-c)),o&&(o=clearInterval(o))):(o||(l=d.now(),o=setInterval(v,1e3)),r=1,u(m)))}f.prototype=y.prototype={constructor:f,restart:function(t,e,n){if("function"!=typeof t)throw TypeError("callback is not a function");n=(null==n?p():+n)+(null==e?0:+e),this._next||s===this||(s?s._next=this:i=this,s=this),this._call=t,this._time=n,b()},stop:function(){this._call&&(this._call=null,this._time=1/0,b())}}},80817:function(t){function e(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}t.exports=function(t){let n=function(t){let n=[];for(let i=0;i<t.length;i++){for(;n.length>=2&&0>=e(n[n.length-2],n[n.length-1],t[i]);)n.pop();n.push(t[i])}return n.pop(),n}(t),i=function(t){let n=t.reverse(),i=[];for(let t=0;t<n.length;t++){for(;i.length>=2&&0>=e(i[i.length-2],i[i.length-1],n[t]);)i.pop();i.push(n[t])}return i.pop(),i}(t),s=i.concat(n);return s.push(t[0]),s}},63652:function(t){t.exports={toXy:function(t,e){return void 0===e?t.slice():t.map(function(t){let n=Function("pt","return [pt"+e[0]+",pt"+e[1]+"];");return n(t)})},fromXy:function(t,e){return void 0===e?t.slice():t.map(function(t){let n=Function("pt","const o = {}; o"+e[0]+"= pt[0]; o"+e[1]+"= pt[1]; return o;");return n(t)})}}},58867:function(t){function e(t,e){this._cells=[],this._cellSize=e,this._reverseCellSize=1/e;for(let e=0;e<t.length;e++){let n=t[e],i=this.coordToCellNum(n[0]),s=this.coordToCellNum(n[1]);if(this._cells[i])this._cells[i][s]?this._cells[i][s].push(n):this._cells[i][s]=[n];else{let t=[];t[s]=[n],this._cells[i]=t}}}e.prototype={cellPoints:function(t,e){return void 0!==this._cells[t]&&void 0!==this._cells[t][e]?this._cells[t][e]:[]},rangePoints:function(t){let e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),i=this.coordToCellNum(t[2]),s=this.coordToCellNum(t[3]),r=[];for(let t=e;t<=i;t++)for(let e=n;e<=s;e++)for(let n=0;n<this.cellPoints(t,e).length;n++)r.push(this.cellPoints(t,e)[n]);return r},removePoint:function(t){let e;let n=this.coordToCellNum(t[0]),i=this.coordToCellNum(t[1]),s=this._cells[n][i];for(let n=0;n<s.length;n++)if(s[n][0]===t[0]&&s[n][1]===t[1]){e=n;break}return s.splice(e,1),s},trunc:Math.trunc||function(t){return t-t%1},coordToCellNum:function(t){return this.trunc(t*this._reverseCellSize)},extendBbox:function(t,e){return[t[0]-e*this._cellSize,t[1]-e*this._cellSize,t[2]+e*this._cellSize,t[3]+e*this._cellSize]}},t.exports=function(t,n){return new e(t,n)}},1344:function(t,e,n){"use strict";let i=n(77444),s=n(58867),r=n(63652),a=n(80817);function o(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function l(t,e,n){let i=[e[0]-t[0],e[1]-t[1]],s=[n[0]-t[0],n[1]-t[1]],r=o(t,e),a=o(t,n),l=i[0]*s[0]+i[1]*s[1];return l/Math.sqrt(r*a)}function h(t,e){for(let n=0;n<e.length-1;n++){let s=[e[n],e[n+1]];if((t[0][0]!==s[0][0]||t[0][1]!==s[0][1])&&(t[0][0]!==s[1][0]||t[0][1]!==s[1][1])&&i(t,s))return!0}return!1}let c=Math.cos(90/(180/Math.PI));t.exports=function(t,e,n){let i=function(t){let e=[t[0]],n=t[0];for(let i=1;i<t.length;i++){let s=t[i];(n[0]!==s[0]||n[1]!==s[1])&&e.push(s),n=s}return e}(r.toXy(t,n).sort(function(t,e){return t[0]-e[0]||t[1]-e[1]}));if(i.length<4){let t=i.concat([i[0]]);return n?r.fromXy(t,n):t}let d=function(t){let e=1/0,n=1/0,i=-1/0,s=-1/0;for(let r=t.length-1;r>=0;r--)t[r][0]<e&&(e=t[r][0]),t[r][1]<n&&(n=t[r][1]),t[r][0]>i&&(i=t[r][0]),t[r][1]>s&&(s=t[r][1]);return[i-e,s-n]}(i),u=[.6*d[0],.6*d[1]],p=a(i),g=i.filter(function(t){return 0>p.indexOf(t)}),f=Math.ceil(1/(i.length/(d[0]*d[1]))),y=function t(e,n,i,s,r){let a=!1;for(let t=0;t<e.length-1;t++){let d,u,p;let g=[e[t],e[t+1]],f=g[0][0]+","+g[0][1]+","+g[1][0]+","+g[1][1];if(o(g[0],g[1])<n||r.has(f))continue;let y=0,m=[Math.min(g[0][0],g[1][0]),Math.min(g[0][1],g[1][1]),Math.max(g[0][0],g[1][0]),Math.max(g[0][1],g[1][1])];do d=(m=s.extendBbox(m,y))[2]-m[0],u=m[3]-m[1],p=function(t,e,n){let i=null,s=c,r=c,a,o;for(let c=0;c<e.length;c++)a=l(t[0],t[1],e[c]),o=l(t[1],t[0],e[c]),a>s&&o>r&&!h([t[0],e[c]],n)&&!h([t[1],e[c]],n)&&(s=a,r=o,i=e[c]);return i}(g,s.rangePoints(m),e),y++;while(null===p&&(i[0]>d||i[1]>u));d>=i[0]&&u>=i[1]&&r.add(f),null!==p&&(e.splice(t+1,0,p),s.removePoint(p),a=!0)}return a?t(e,n,i,s,r):e}(p,Math.pow(e||20,2),u,s(g,f),new Set);return n?r.fromXy(y,n):y}},77444:function(t){function e(t,e,n,i,s,r){let a=(r-e)*(n-t)-(i-e)*(s-t);return a>0||!(a<0)}t.exports=function(t,n){let i=t[0][0],s=t[0][1],r=t[1][0],a=t[1][1],o=n[0][0],l=n[0][1],h=n[1][0],c=n[1][1];return e(i,s,o,l,h,c)!==e(r,a,o,l,h,c)&&e(i,s,r,a,o,l)!==e(i,s,r,a,h,c)}},60976:function(t,e,n){"use strict";let i;n.d(e,{kJ:function(){return aa},jD:function(){return ta}});var s,r,a,o,l,h,c,d,u,p,g,f,y,m,v,b,E,x,w,S,C,O,D,T,M,A,R,k,P={};n.r(P),n.d(P,{circle:function(){return nD},diamond:function(){return nM},rect:function(){return nR},simple:function(){return nP},triangle:function(){return nT},triangleRect:function(){return nk},vee:function(){return nA}});var N=n(31990),L=function(t){return null==t},I=function(t){return L(t)?"":t.toString()},B=function(t){var e=I(t);return e.charAt(0).toUpperCase()+e.substring(1)},_=function(t){return"object"==typeof t&&null!==t},F=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},j={}.toString,z=function(t,e){return j.call(t)==="[object "+e+"]"},H=function(t){return z(t,"String")},W=function(t,e){if(t===e)return!0;if(!t||!e||H(t)||H(e))return!1;if(F(t)||F(e)){if(t.length!==e.length)return!1;for(var n=!0,i=0;i<t.length&&(n=W(t[i],e[i]));i++);return n}if(_(t)||_(e)){var s=Object.keys(t),r=Object.keys(e);if(s.length!==r.length)return!1;for(var n=!0,i=0;i<s.length&&(n=W(t[s[i]],e[s[i]]));i++);return n}return!1},V=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e};let G={duration:500},Y={duration:1e3,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",iterations:1,fill:"both"};(s=v||(v={})).NodeAdded="NodeAdded",s.NodeUpdated="NodeUpdated",s.NodeRemoved="NodeRemoved",s.EdgeAdded="EdgeAdded",s.EdgeUpdated="EdgeUpdated",s.EdgeRemoved="EdgeRemoved",s.ComboAdded="ComboAdded",s.ComboUpdated="ComboUpdated",s.ComboRemoved="ComboRemoved",(r=b||(b={})).DRAW="draw",r.COLLAPSE="collapse",r.EXPAND="expand",r.TRANSFORM="transform",(a=E||(E={})).CLICK="canvas:click",a.DBLCLICK="canvas:dblclick",a.POINTER_OVER="canvas:canvas:pointerover",a.POINTER_LEAVE="canvas:pointerleave",a.POINTER_ENTER="canvas:pointerenter",a.POINTER_MOVE="canvas:pointermove",a.POINTER_OUT="canvas:pointerout",a.POINTER_DOWN="canvas:pointerdown",a.POINTER_UP="canvas:pointerup",a.CONTEXT_MENU="canvas:contextmenu",a.DRAG_START="canvas:dragstart",a.DRAG="canvas:drag",a.DRAG_END="canvas:dragend",a.DRAG_ENTER="canvas:dragenter",a.DRAG_OVER="canvas:dragover",a.DRAG_LEAVE="canvas:dragleave",a.DROP="canvas:drop",a.WHEEL="canvas:wheel",(o=x||(x={})).CLICK="combo:click",o.DBLCLICK="combo:dblclick",o.POINTER_OVER="combo:pointerover",o.POINTER_LEAVE="combo:pointerleave",o.POINTER_ENTER="combo:pointerenter",o.POINTER_MOVE="combo:pointermove",o.POINTER_OUT="combo:pointerout",o.POINTER_DOWN="combo:pointerdown",o.POINTER_UP="combo:pointerup",o.CONTEXT_MENU="combo:contextmenu",o.DRAG_START="combo:dragstart",o.DRAG="combo:drag",o.DRAG_END="combo:dragend",o.DRAG_ENTER="combo:dragenter",o.DRAG_OVER="combo:dragover",o.DRAG_LEAVE="combo:dragleave",o.DROP="combo:drop",(l=w||(w={})).CLICK="click",l.DBLCLICK="dblclick",l.POINTER_OVER="pointerover",l.POINTER_LEAVE="pointerleave",l.POINTER_ENTER="pointerenter",l.POINTER_MOVE="pointermove",l.POINTER_OUT="pointerout",l.POINTER_DOWN="pointerdown",l.POINTER_UP="pointerup",l.CONTEXT_MENU="contextmenu",l.DRAG_START="dragstart",l.DRAG="drag",l.DRAG_END="dragend",l.DRAG_ENTER="dragenter",l.DRAG_OVER="dragover",l.DRAG_LEAVE="dragleave",l.DROP="drop",l.KEY_DOWN="keydown",l.KEY_UP="keyup",l.WHEEL="wheel",(h=S||(S={})).KEY_DOWN="keydown",h.KEY_UP="keyup",(c=C||(C={})).CLICK="edge:click",c.DBLCLICK="edge:dblclick",c.POINTER_OVER="edge:pointerover",c.POINTER_LEAVE="edge:pointerleave",c.POINTER_ENTER="edge:pointerenter",c.POINTER_MOVE="edge:pointermove",c.POINTER_OUT="edge:pointerout",c.POINTER_DOWN="edge:pointerdown",c.POINTER_UP="edge:pointerup",c.CONTEXT_MENU="edge:contextmenu",c.DRAG_ENTER="edge:dragenter",c.DRAG_OVER="edge:dragover",c.DRAG_LEAVE="edge:dragleave",c.DROP="edge:drop",(d=O||(O={})).BEFORE_CANVAS_INIT="beforecanvasinit",d.AFTER_CANVAS_INIT="aftercanvasinit",d.BEFORE_SIZE_CHANGE="beforesizechange",d.AFTER_SIZE_CHANGE="aftersizechange",d.BEFORE_ELEMENT_CREATE="beforeelementcreate",d.AFTER_ELEMENT_CREATE="afterelementcreate",d.BEFORE_ELEMENT_UPDATE="beforeelementupdate",d.AFTER_ELEMENT_UPDATE="afterelementupdate",d.BEFORE_ELEMENT_DESTROY="beforeelementdestroy",d.AFTER_ELEMENT_DESTROY="afterelementdestroy",d.BEFORE_ELEMENT_TRANSLATE="beforeelementtranslate",d.AFTER_ELEMENT_TRANSLATE="afterelementtranslate",d.BEFORE_DRAW="beforedraw",d.AFTER_DRAW="afterdraw",d.BEFORE_RENDER="beforerender",d.AFTER_RENDER="afterrender",d.BEFORE_ANIMATE="beforeanimate",d.AFTER_ANIMATE="afteranimate",d.BEFORE_LAYOUT="beforelayout",d.AFTER_LAYOUT="afterlayout",d.BEFORE_STAGE_LAYOUT="beforestagelayout",d.AFTER_STAGE_LAYOUT="afterstagelayout",d.BEFORE_TRANSFORM="beforetransform",d.AFTER_TRANSFORM="aftertransform",d.BATCH_START="batchstart",d.BATCH_END="batchend",d.BEFORE_DESTROY="beforedestroy",d.AFTER_DESTROY="afterdestroy",d.BEFORE_RENDERER_CHANGE="beforerendererchange",d.AFTER_RENDERER_CHANGE="afterrendererchange",(u=D||(D={})).UNDO="undo",u.REDO="redo",u.CANCEL="cancel",u.ADD="add",u.CLEAR="clear",u.CHANGE="change",(p=T||(T={})).CLICK="node:click",p.DBLCLICK="node:dblclick",p.POINTER_OVER="node:pointerover",p.POINTER_LEAVE="node:pointerleave",p.POINTER_ENTER="node:pointerenter",p.POINTER_MOVE="node:pointermove",p.POINTER_OUT="node:pointerout",p.POINTER_DOWN="node:pointerdown",p.POINTER_UP="node:pointerup",p.CONTEXT_MENU="node:contextmenu",p.DRAG_START="node:dragstart",p.DRAG="node:drag",p.DRAG_END="node:dragend",p.DRAG_ENTER="node:dragenter",p.DRAG_OVER="node:dragover",p.DRAG_LEAVE="node:dragleave",p.DROP="node:drop";let U="combo",K="tree";(g=M||(M={})).NODE="node",g.EDGE="edge",g.COMBO="combo",g.THEME="theme",g.PALETTE="palette",g.LAYOUT="layout",g.BEHAVIOR="behavior",g.PLUGIN="plugin",g.ANIMATION="animation",g.TRANSFORM="transform",g.SHAPE="shape";let Z={animation:{},behavior:{},combo:{},edge:{},layout:{},node:{},palette:{},theme:{},plugin:{},transform:{},shape:{}};function X(t,e){var n;let i=null===(n=Z[t])||void 0===n?void 0:n[e];if(i)return i}function $(t){return"[".concat("G6"," v").concat("5.0.17","] ").concat(t)}let q={mute:!1,debug:t=>{q.mute||console.debug($(t))},info:t=>{q.mute||console.info($(t))},warn:t=>{q.mute||console.warn($(t))},error:t=>{q.mute||console.error($(t))}};function J(t){let{theme:e}=t;if(!e)return{};let n=X(M.THEME,e);return n||(q.warn("The theme of ".concat(e," is not registered.")),{})}function Q(t,e){if(Array.isArray(t)&&0===t.length)return null;let n=Array.isArray(t)?t[0]:t,i=Array.isArray(t)?t.slice(1):e||[];return new Proxy(n,{get:(t,e)=>"function"!=typeof t[e]||["onframe","onfinish"].includes(e)?"finished"===e?Promise.all([n.finished,...i.map(t=>t.finished)]):Reflect.get(t,e):function(){for(var n=arguments.length,s=Array(n),r=0;r<n;r++)s[r]=arguments[r];t[e](...s),i.forEach(t=>{var n;return null===(n=t[e])||void 0===n?void 0:n.call(t,...s)})},set:(t,e,n)=>(["onframe","onfinish"].includes(e)||i.forEach(t=>{t[e]=n}),Reflect.set(t,e,n))})}function tt(t){let e=t.reduce((t,e)=>(Object.entries(e).forEach(e=>{let[n,i]=e;void 0===t[n]?t[n]=[i]:t[n].push(i)}),t),{});Object.entries(e).forEach(n=>{let[i,s]=n;(s.length!==t.length||s.some(t=>L(t))||s.every(t=>!["sourceNode","targetNode","childrenNode"].includes(i)&&W(t,s[0])))&&delete e[i]});let n=Object.entries(e).reduce((t,e)=>{let[n,i]=e;return i.forEach((e,i)=>{t[i]?t[i][n]=e:t[i]={[n]:e}}),t},[]);return 0!==t.length&&0===n.length&&n.push(...[{_:0},{_:0}]),n}function te(t){switch(t){case"opacity":return 1;case"x":case"y":case"z":case"zIndex":return 0;case"visibility":return"visible";case"collapsed":return!1;case"states":return[];default:return}}function tn(t,e){let{animation:n}=t;if(!1===n||!1===e)return!1;let i={...G};return V(n)&&Object.assign(i,n),V(e)&&Object.assign(i,e),i}var ti=function(t){return Array.isArray?Array.isArray(t):z(t,"Array")},ts=function(t){if(!_(t)||!z(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},tr=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i+=1)!function t(e,n,i,s){for(var r in i=i||0,s=s||5,n)if(function(t,e){if(Object.hasOwn)return Object.hasOwn(t,e);if(null==t)throw TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)}(n,r)){var a=n[r];null!==a&&ts(a)?(ts(e[r])||(e[r]={}),i<s?t(e[r],a,i+1,s):e[r]=n[r]):ti(a)?(e[r]=[],e[r]=e[r].concat(a)):void 0!==a&&(e[r]=a)}}(t,e[i]);return t};function ta(t){if(void 0!==t.id)return t.id;if(void 0!==t.source&&void 0!==t.target)return"".concat(t.source,"-").concat(t.target);throw Error($("The datum does not have available id."))}function to(t,e){let n={nodes:(t.nodes||[]).map(ta),edges:(t.edges||[]).map(ta),combos:(t.combos||[]).map(ta)};return e?Object.values(n).flat():n}function tl(t,e,n,i){let s=i?i.replace(/translate(3d)?\([^)]*\)/g,""):"";return 0===n?"translate(".concat(t,", ").concat(e,")").concat(s):"translate3d(".concat(t,", ").concat(e,", ").concat(n,")").concat(s)}let th=function(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=ta(i),a="".concat(n,"s"),o=t.add[a].get(r)||t.update[a].get(r)||t.remove[a].get(r)||i;Object.entries(t).forEach(t=>{let[n,l]=t;e===n?l[a].set(r,s?tr(o,i):o):l[a].delete(r)})},tc=(t,e,n)=>{let i;if(!n.length)return null;let[s,r]=e,a=e=>{if(!e)return{shape:t,fromStyle:s,toStyle:r};{var n;let i=t.getShape(e);if(!i)return null;let a="get".concat(B(e),"Style"),o=(null==t?void 0:null===(n=t[a])||void 0===n?void 0:n.bind(t))||(t=>t),l=(null==o?void 0:o(s))||{},h=(null==o?void 0:o(r))||{};return{shape:i,fromStyle:l,toStyle:h}}},o=n.map(t=>{let{fields:e,shape:n,states:s,...r}=t,o=a(n);if(!o)return null;let{shape:l,fromStyle:h,toStyle:c}=o,d=[{},{}];if(e.forEach(t=>{var e,n;Object.assign(d[0],{[t]:null!==(e=h[t])&&void 0!==e?e:te(t)}),Object.assign(d[1],{[t]:null!==(n=c[t])&&void 0!==n?n:te(t)})}),d.some(t=>Object.keys(t).some(t=>["x","y","z"].includes(t)))){let{x:t=0,y:e=0,z:n=0,transform:i=""}=l.attributes||{};d.forEach(s=>{s.transform=tl(s.x||t,s.y||e,s.z||n,i)})}let u=l.animate(tt(d),r);return void 0===n&&(i=u),u}).filter(Boolean),l=i||(null==o?void 0:o[0]);return l?Q(l,o.filter(t=>t!=t)):null},td=[{fields:["x","y"]}],tu=[{fields:["sourceNode","targetNode"]}],tp=[{fields:["childrenNode","x","y"]}];function tg(t,e,n){let i=new Map(t.map(t=>[n(t),t])),s=new Map(e.map(t=>[n(t),t])),r=new Set(i.keys()),a=new Set(s.keys()),o=[],l=[],h=[],c=[];return a.forEach(t=>{r.has(t)?W(i.get(t),s.get(t))?c.push(s.get(t)):l.push(s.get(t)):o.push(s.get(t))}),r.forEach(t=>{a.has(t)||h.push(i.get(t))}),{enter:o,exit:h,keep:c,update:l}}class tf{setExtensions(t){let e=function(t,e,n){let i={},s=t=>(t in i||(i[t]=0),"".concat(e,"-").concat(t,"-").concat(i[t]++));return n.map(e=>"string"==typeof e?{type:e,key:s(e)}:"function"==typeof e?e.call(t):e.key?e:{...e,key:s(e.type)})}(this.context.graph,this.category,t),{enter:n,update:i,exit:s,keep:r}=tg(this.extensions,e,t=>t.key);this.createExtensions(n),this.updateExtensions([...i,...r]),this.destroyExtensions(s),this.extensions=e}createExtension(t){let{category:e}=this,{key:n,type:i}=t,s=X(e,i);if(!s)return q.warn("The extension ".concat(i," of ").concat(e," is not registered."));let r=new s(this.context,t);this.extensionMap[n]=r}createExtensions(t){t.forEach(t=>this.createExtension(t))}updateExtension(t){let{key:e}=t,n=this.extensionMap[e];n&&n.update(t)}updateExtensions(t){t.forEach(t=>this.updateExtension(t))}destroyExtension(t){let e=this.extensionMap[t];e&&(e.destroy(),delete this.extensionMap[t])}destroyExtensions(t){t.forEach(t=>{let{key:e}=t;return this.destroyExtension(e)})}destroy(){Object.values(this.extensionMap).forEach(t=>t.destroy()),this.context={},this.extensions=[],this.extensionMap={}}constructor(t){this.extensions=[],this.extensionMap={},this.context=t}}class ty{update(t){this.options=Object.assign(this.options,t)}destroy(){this.context={},this.options={},this.destroyed=!0}constructor(t,e){this.events=[],this.destroyed=!1,this.context=t,this.options=e}}class tm extends ty{}var tv=function(t){return"function"==typeof t},tb=function(t){if("object"!=typeof t||null===t)return t;if(ti(t)){e=[];for(var e,n=0,i=t.length;n<i;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=tb(t[n]):e[n]=t[n]}else for(var s in e={},t)"object"==typeof t[s]&&null!=t[s]?e[s]=tb(t[s]):e[s]=t[s];return e};function tE(t){return t instanceof Float32Array||!!Array.isArray(t)&&(2===t.length||3===t.length)&&t.every(t=>"number"==typeof t)}function tx(t,e,n){return t>=e&&t<=n}function tw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(Array.isArray(t)){let[e=0,n=e,i=e,s=n]=t;return[e,n,i,s]}return[t,t,t,t]}function tS(t){return t.max[0]-t.min[0]}function tC(t){return t.max[1]-t.min[1]}function tO(t){return[tS(t),tC(t)]}function tD(t,e){let n=tE(t)?function(t){let[e,n,i=0]=t,s=new N.mN;return s.setMinMax([e,n,i],[e,n,i]),s}(t):t.getShape("key").getBounds();return e?tT(n,e):n}function tT(t,e){let[n,i,s,r]=tw(e),[a,o,l]=t.min,[h,c,d]=t.max,u=new N.mN;return u.setMinMax([a-r,o-n,l],[h+i,c+s,d]),u}function tM(t){if(0===t.length)return new N.mN;if(1===t.length)return t[0];let e=new N.mN;e.setMinMax(t[0].min,t[0].max);for(let n=1;n<t.length;n++){let i=t[n];e.setMinMax([Math.min(e.min[0],i.min[0]),Math.min(e.min[1],i.min[1]),Math.min(e.min[2],i.min[2])],[Math.max(e.max[0],i.max[0]),Math.max(e.max[1],i.max[1]),Math.max(e.max[2],i.max[2])])}return e}function tA(t,e){return tx(t[0],e.min[0],e.max[0])&&tx(t[1],e.min[1],e.max[1])}function tR(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{min:[i,s],max:[r,a]}=e,o=(t[1]===s||t[1]===a)&&(n||tx(t[0],i,r)),l=(t[0]===i||t[0]===r)&&(n||tx(t[1],s,a));return o||l}function tk(t,e){let[n,i]=e,[s,r]=t.min,[a,o]=t.max,l=n-s,h=a-n,c=i-r,d=o-i,u=Math.min(l,h,c,d);return u===l?"left":u===h?"right":u===c?"top":u===d?"bottom":"left"}function tP(t,e){let n=tb(e);if(tA(e,t)){let i=tk(t,e);switch(i){case"left":n[0]=t.min[0];break;case"right":n[0]=t.max[0];break;case"top":n[1]=t.min[1];break;case"bottom":n[1]=t.max[1]}}else{let[i,s]=e,[r,a]=t.min,[o,l]=t.max;n[0]=tx(i,r,o)?i:i<r?r:o,n[1]=tx(s,a,l)?s:s<a?a:l}return n}let tN=[0,0,0];function tL(t,e){return t.map((t,n)=>t+e[n])}function tI(t,e){return t.map((t,n)=>t-e[n])}function tB(t,e){return"number"==typeof e?t.map(t=>t*e):t.map((t,n)=>t*e[n])}function t_(t,e){return"number"==typeof e?t.map(t=>t/e):t.map((t,n)=>t/e[n])}function tF(t,e){return t.map(t=>t*e)}function tj(t,e){return Math.sqrt(t.reduce((t,n,i)=>t+(n-e[i]||0)**2,0))}function tz(t,e){return t.reduce((t,n,i)=>t+Math.abs(n-e[i]),0)}function tH(t){let e=t.reduce((t,e)=>t+e**2,0);return t.map(t=>t/Math.sqrt(e))}function tW(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t[0]*e[1]-t[1]*e[0],s=Math.acos(tB(t,e).reduce((t,e)=>t+e,0)/(tj(t,tN)*tj(e,tN)));return n&&i<0&&(s=2*Math.PI-s),s}function tV(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e?[-t[1],t[0]]:[t[1],-t[0]]}function tG(t){return[t[0],t[1]]}function tY(t){return 2===t.length?[t[0],t[1],0]:t}function tU(t,e){let[n,i]=t,[s,r]=e,a=tI(n,i),o=tI(s,r);return(function(t,e){let n=tY(t),i=tY(e);return[n[1]*i[2]-n[2]*i[1],n[2]*i[0]-n[0]*i[2],n[0]*i[1]-n[1]*i[0]]})(a,o).every(t=>0===t)}function tK(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(tU(t,e))return;let[i,s]=t,[r,a]=e,o=((i[0]-r[0])*(r[1]-a[1])-(i[1]-r[1])*(r[0]-a[0]))/((i[0]-s[0])*(r[1]-a[1])-(i[1]-s[1])*(r[0]-a[0])),l=a[0]-r[0]?(i[0]-r[0]+o*(s[0]-i[0]))/(a[0]-r[0]):(i[1]-r[1]+o*(s[1]-i[1]))/(a[1]-r[1]);if(n||tx(o,0,1)&&tx(l,0,1))return[i[0]+o*(s[0]-i[0]),i[1]+o*(s[1]-i[1])]}function tZ(t){if(Array.isArray(t))return tx(t[0],0,1)&&tx(t[1],0,1)?t:[.5,.5];let e=t.split("-"),n=e.includes("left")?0:e.includes("right")?1:.5,i=e.includes("top")?0:e.includes("bottom")?1:.5;return[n,i]}function tX(t){let{x:e=0,y:n=0,z:i=0}=t.style||{};return[+e,+n,+i]}function t$(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=tZ(e);return function(t,e){let[n,i]=e,{min:s,max:r}=t;return[s[0]+n*(r[0]-s[0]),s[1]+i*(r[1]-s[1])]}(t,n)}function tq(t){var e;return[t.x,t.y,null!==(e=t.z)&&void 0!==e?e:0]}function tJ(t){var e;return{x:t[0],y:t[1],z:null!==(e=t[2])&&void 0!==e?e:0}}function tQ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.map(t=>parseFloat(t.toFixed(e)))}function t0(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=i?tI(t,e):tI(e,t),r=tH(s),a=[r[0]*n,r[1]*n];return tL(tG(t),a)}function t1(t,e,n){let i=!(arguments.length>3)||void 0===arguments[3]||arguments[3];for(let s=0;s<n.length;s++){let r=n[s],a=n[(s+1)%n.length];i&&(r=tL(e,r),a=tL(e,a));let o=tK([e,t],[r,a]);if(o)return{point:o,line:[r,a]}}return{point:e,line:void 0}}function t2(t,e){let n=e.center,i=tI(t,e.center),s=Math.atan2(i[1],i[0]);if(isNaN(s))return n;let r=tS(e)/2,a=tC(e)/2,o=n[0]+r*Math.cos(s),l=n[1]+a*Math.sin(s);return[o,l]}function t3(t,e){let[n,i]=e[0],[s,r]=e[1],[a,o]=t,l=s-n,h=r-i;if(0===l&&0===h)return[n,i];let c=((a-n)*l+(o-i)*h)/(l*l+h*h);c>1?c=1:c<0&&(c=0);let d=n+c*l,u=i+c*h;return[d,u]}function t6(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=function(t){let e=t.reduce((t,e)=>tL(t,e),[0,0]);return t_(e,t.length)}(t);return t.sort((t,i)=>{let[s,r]=t,[a,o]=i,l=Math.atan2(r-n[1],s-n[0]),h=Math.atan2(o-n[1],a-n[0]);return e?h-l:l-h})}function t4(t,e){return[t,[t[0],e[1]],e,[e[0],t[1]]]}let t8=t=>t.map(t=>H(t)?t.toLocaleLowerCase():t);class t9{bind(t,e){0!==t.length&&this.map.set(t,e)}unbind(t,e){this.map.forEach((n,i)=>{W(i,t)&&(!e||e===n)&&this.map.delete(i)})}unbindAll(){this.map.clear()}match(t){let e=t8(Array.from(this.recordKey)).sort(),n=t8(t).sort();return W(e,n)}bindEvents(){let{emitter:t}=this;t.on(w.KEY_DOWN,this.onKeyDown),t.on(w.KEY_UP,this.onKeyUp),t.on(w.WHEEL,this.onWheel),t.on(w.DRAG,this.onDrag),window.addEventListener("focus",this.onFocus)}trigger(t){this.map.forEach((e,n)=>{this.match(n)&&e(t)})}triggerExtendKey(t,e){this.map.forEach((n,i)=>{i.includes(t)&&W(Array.from(this.recordKey),i.filter(e=>e!==t))&&n(e)})}destroy(){this.unbindAll(),this.emitter.off(w.KEY_DOWN,this.onKeyDown),this.emitter.off(w.KEY_UP,this.onKeyUp),this.emitter.off(w.WHEEL,this.onWheel),this.emitter.off(w.DRAG,this.onDrag),window.removeEventListener("blur",this.onFocus)}constructor(t){this.map=new Map,this.recordKey=new Set,this.onKeyDown=t=>{(null==t?void 0:t.key)&&(this.recordKey.add(t.key),this.trigger(t))},this.onKeyUp=t=>{(null==t?void 0:t.key)&&this.recordKey.delete(t.key)},this.onWheel=t=>{this.triggerExtendKey(w.WHEEL,t)},this.onDrag=t=>{this.triggerExtendKey(w.DRAG,t)},this.onFocus=()=>{this.recordKey.clear()},this.emitter=t,this.bindEvents()}}class t5 extends tm{onPointerDown(t){if(!this.validate(t)||!this.isKeydown()||this.startPoint)return;let{canvas:e,graph:n}=this.context,i={...this.options.style};this.options.style.lineWidth&&(i.lineWidth=+this.options.style.lineWidth/n.getZoom()),this.rectShape=new N.UL({id:"g6-brush-select",style:i}),e.appendChild(this.rectShape),this.startPoint=[t.canvas.x,t.canvas.y]}onPointerMove(t){var e;if(!this.startPoint)return;let{immediately:n,mode:i}=this.options;this.endPoint=t7(t),null===(e=this.rectShape)||void 0===e||e.attr({x:Math.min(this.endPoint[0],this.startPoint[0]),y:Math.min(this.endPoint[1],this.startPoint[1]),width:Math.abs(this.endPoint[0]-this.startPoint[0]),height:Math.abs(this.endPoint[1]-this.startPoint[1])}),n&&"default"===i&&this.updateElementsStates(t4(this.startPoint,this.endPoint))}onPointerUp(t){if(this.startPoint){if(!this.endPoint){this.clearBrush();return}this.endPoint=t7(t),this.updateElementsStates(t4(this.startPoint,this.endPoint)),this.clearBrush()}}clearStates(){this.endPoint||this.clearElementsStates()}clearElementsStates(){let{graph:t}=this.context,e=Object.values(t.getData()).reduce((t,e)=>Object.assign({},t,e.reduce((t,e)=>(t[ta(e)]=[],t),{})),{});t.setElementState(e,this.options.animation)}updateElementsStates(t){let{graph:e}=this.context,{enableElements:n,state:i,mode:s,onSelect:r}=this.options,a=this.selector(e,t,n),o={};switch(s){case"union":a.forEach(t=>{o[t]=[...e.getElementState(t),i]});break;case"diff":a.forEach(t=>{let n=e.getElementState(t);o[t]=n.includes(i)?n.filter(t=>t!==i):[...n,i]});break;case"intersect":a.forEach(t=>{let n=e.getElementState(t);o[t]=n.includes(i)?[i]:[]});break;default:a.forEach(t=>{o[t]=[i]})}tv(r)&&(o=r(o)),e.setElementState(o,this.options.animation)}selector(t,e,n){if(!n||0===n.length)return[];let i=[],s=t.getData();if(n.forEach(n=>{s["".concat(n,"s")].forEach(n=>{let s=ta(n);"hidden"!==t.getElementVisibility(s)&&function(t,e,n,i){let s=t[0],r=t[1],a=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);let o=i-n;for(let t=0,i=o-1;t<o;i=t++){let o=e[t+n][0],l=e[t+n][1],h=e[i+n][0],c=e[i+n][1],d=l>r!=c>r&&s<(h-o)*(r-l)/(c-l)+o;d&&(a=!a)}return a}(t.getElementPosition(s),e)&&i.push(s)})}),n.includes("edge")){let t=s.edges;null==t||t.forEach(t=>{let{source:e,target:n}=t;i.includes(e)&&i.includes(n)&&i.push(ta(t))})}return i}clearBrush(){var t;null===(t=this.rectShape)||void 0===t||t.remove(),this.rectShape=void 0,this.startPoint=void 0,this.endPoint=void 0}isKeydown(){let{trigger:t}=this.options,e=Array.isArray(t)?t:[t];return this.shortcut.match(e.filter(t=>"drag"!==t))}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}bindEvents(){let{graph:t}=this.context;t.on(w.POINTER_DOWN,this.onPointerDown),t.on(w.POINTER_MOVE,this.onPointerMove),t.on(w.POINTER_UP,this.onPointerUp),t.on(E.CLICK,this.clearStates)}unbindEvents(){let{graph:t}=this.context;t.off(w.POINTER_DOWN,this.onPointerDown),t.off(w.POINTER_MOVE,this.onPointerMove),t.off(w.POINTER_UP,this.onPointerUp),t.off(E.CLICK,this.clearStates)}update(t){this.unbindEvents(),this.options=tr(this.options,t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,tr({},t5.defaultOptions,e)),this.shortcut=new t9(t.graph),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.clearStates=this.clearStates.bind(this),this.bindEvents()}}t5.defaultOptions={animation:!1,enable:!0,enableElements:["node","combo","edge"],immediately:!1,mode:"default",state:"selected",trigger:["shift"],style:{width:0,height:0,lineWidth:1,fill:"#1677FF",stroke:"#1677FF",fillOpacity:.1,zIndex:2,pointerEvents:"none"}};let t7=t=>[t.canvas.x,t.canvas.y],et=["node","edge","combo"];function ee(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;"TB"===i&&e(t,s);let r=n(t);if(r)for(let t of r)ee(t,e,n,i,s+1);"BT"===i&&e(t,s)}function en(t,e,n,i){if("combo"===e||"node"===e)return ei(t,n,i);let s=t.getEdgeData(n);if(!s)return[];let r=ei(t,s.source,i-1),a=ei(t,s.target,i-1);return Array.from(new Set([...r,...a,n]))}function ei(t,e,n){let i=new Set,s=new Set,r=new Set;return!function(t,e,n){let i=[[t,0]];for(;i.length;){let[t,s]=i.shift();e(t,s);let r=n(t);if(r)for(let t of r)i.push([t,s+1])}}(e,(e,i)=>{i>n||(r.add(e),t.getRelatedEdgesData(e).forEach(t=>{let e=ta(t);!s.has(e)&&i<n&&(r.add(e),s.add(e))}))},e=>t.getRelatedEdgesData(e).map(t=>t.source===e?t.target:t.source).filter(t=>!i.has(t)&&(i.add(t),!0))),Array.from(r)}function es(t){return t.states||[]}class er extends tm{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),et.forEach(e=>{t.on("".concat(e,":").concat(w.CLICK),this.onClickSelect)}),t.on(E.CLICK,this.onClickCanvas)}get isMultipleSelect(){let{multiple:t,trigger:e}=this.options;return t&&this.shortcut.match(e)}getNeighborIds(t){let{target:e,targetType:n}=t,{graph:i}=this.context,{degree:s}=this.options;return en(i,n,e.id,"function"==typeof s?s(t):s).filter(t=>t!==e.id)}async updateState(t){let{state:e,unselectedState:n,neighborState:i,animation:s}=this.options;if(!e&&!i&&!n)return;let{target:r}=t,{graph:a}=this.context,o=a.getElementData(r.id),l=es(o).includes(e)?"unselect":"select",h={},c=this.isMultipleSelect,d=[r.id],u=this.getNeighborIds(t);if(c){if(Object.assign(h,this.getDataStates()),"select"===l){let t=(t,e)=>{t.forEach(t=>{let i=new Set(a.getElementState(t));i.add(e),i.delete(n),h[t]=Array.from(i)})};t(d,e),t(u,i),n&&Object.keys(h).forEach(t=>{let s=h[t];s.includes(e)||s.includes(i)||s.includes(n)||h[t].push(n)})}else{let t=h[r.id];h[r.id]=t.filter(t=>t!==e&&t!==i),t.includes(n)||h[r.id].push(n),u.forEach(t=>{h[t]=h[t].filter(t=>t!==i),h[t].includes(e)||h[t].push(n)})}}else if("select"===l){Object.assign(h,this.getClearStates(!!n));let t=(t,e)=>{t.forEach(t=>{h[t]||(h[t]=a.getElementState(t)),h[t].push(e)})};t(d,e),t(u,i),n&&Object.keys(h).forEach(t=>{d.includes(t)||u.includes(t)||h[t].push(n)})}else Object.assign(h,this.getClearStates());await a.setElementState(h,s)}getDataStates(){let{graph:t}=this.context,{nodes:e,edges:n,combos:i}=t.getData(),s={};return[...e,...n,...i].forEach(t=>{s[ta(t)]=es(t)}),s}getClearStates(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{graph:e}=this.context,{state:n,unselectedState:i,neighborState:s}=this.options,r=new Set([n,i,s]),{nodes:a,edges:o,combos:l}=e.getData(),h={};return[...a,...o,...l].forEach(e=>{let n=es(e),i=n.filter(t=>!r.has(t));t?h[ta(e)]=i:i.length!==n.length&&(h[ta(e)]=i)}),h}async clearState(){let{graph:t}=this.context;await t.setElementState(this.getClearStates(),this.options.animation)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;et.forEach(e=>{t.off("".concat(e,":").concat(w.CLICK),this.onClickSelect)}),t.off(E.CLICK,this.onClickCanvas)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},er.defaultOptions,e)),this.onClickSelect=async t=>{var e,n;this.validate(t)&&(await this.updateState(t),null===(n=(e=this.options).onClick)||void 0===n||n.call(e,t))},this.onClickCanvas=async t=>{var e,n;this.validate(t)&&(await this.clearState(),null===(n=(e=this.options).onClick)||void 0===n||n.call(e,t))},this.shortcut=new t9(t.graph),this.bindEvents()}}function ea(t){var e;return!!(null===(e=t.style)||void 0===e?void 0:e.collapsed)}er.defaultOptions={animation:!0,enable:!0,multiple:!1,trigger:["shift"],state:"selected",neighborState:"selected",unselectedState:void 0,degree:0};var eo=function(t,e,n){for(var i=0,s=H(e)?e.split("."):e;t&&i<s.length;)t=t[s[i++]];return void 0===t||i<s.length?n:t},el=function(t){return z(t,"Number")},eh=function(t,e,n){var i=t,s=H(e)?e.split("."):e;return s.forEach(function(t,e){e<s.length-1?(V(i[t])||(i[t]=el(s[e+1])?[]:{}),i=i[t]):i[t]=n}),t},ec=function(t){var e=I(t);return e.charAt(0).toLowerCase()+e.substring(1)};function ed(t,e){if(!t.startsWith(e))return!1;let n=t[e.length];return n>="A"&&n<="Z"}function eu(t,e){let n=Object.entries(t).reduce((t,n)=>{let[i,s]=n;return"className"===i||"class"===i||ed(i,e)&&Object.assign(t,{[function(t,e){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e||!ed(t,e))return t;let i=t.slice(e.length);return n?ec(i):i}(i,e)]:s}),t},{});if("opacity"in t){let i="".concat(e).concat(B("opacity")),s=t.opacity;if(i in t){let e=t[i];Object.assign(n,{opacity:s*e})}else Object.assign(n,{opacity:s})}return n}function ep(t,e){let n=e.length;return Object.keys(t).reduce((i,s)=>{if(s.startsWith(e)){let e=s.slice(n);i[e]=t[s]}return i},{})}function eg(t,e){let n="string"==typeof e?[e]:e,i={};return Object.keys(t).forEach(e=>{n.find(t=>e.startsWith(t))||(i[e]=t[e])}),i}function ef(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"==typeof t)return[t,t,t];let[e,n=e,i=e]=t;return[e,n,i]}function ey(t,e){let{datum:n,graph:i}=e;return"function"==typeof t?t.call(i,n):Object.fromEntries(Object.entries(t).map(t=>{let[e,s]=t;return"function"==typeof s?[e,s.call(i,n)]:[e,s]}))}function em(t,e){let n=(null==t?void 0:t.style)||{},i=(null==e?void 0:e.style)||{};return Object.assign({},t,e,{style:Object.assign({},n,i)})}let ev="cachedStyle",eb=t=>"__".concat(t,"__");function eE(t,e){let n=Array.isArray(e)?e:[e];eo(t,ev)||eh(t,ev,{}),n.forEach(e=>{eh(eo(t,ev),eb(e),t.attributes[e])})}function ex(t,e){return eo(t,[ev,eb(e)])}function ew(t,e){return eb(e) in(eo(t,ev)||{})}function eS(t){return function(e,n,i){let s=i.value;return i.value=function(e){for(var i=arguments.length,r=Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];let o="".concat(n,"_invoke");if(!ex(this,o))return eh(this,[ev,eb(o)],!0),s.call(this,e,...r);let l="".concat(n,"_style"),h=ex(this,l),c=t(this,e);return(eh(this,[ev,eb(l)],c),eC(h,c))?null:s.call(this,e,...r)},i}}let eC=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if("object"!=typeof t||"object"!=typeof e)return t===e;let i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(let s of i){let i=t[s],r=e[s];if(n>1&&"object"==typeof i&&"object"==typeof r){if(!eC(i,r,n-1))return!1}else if(i!==r)return!1}return!0};var eO=Object.prototype.hasOwnProperty,eD=function(t,e){if(!e||!ti(t))return{};for(var n,i={},s=tv(e)?e:function(t){return t[e]},r=0;r<t.length;r++){var a=t[r];n=s(a),eO.call(i,n)?i[n].push(a):i[n]=[a]}return i};function eT(t){if(t)return"string"==typeof t||"function"==typeof t||Array.isArray(t)?{type:"group",field:t=>t.id,color:t,invert:!1}:t}function eM(t){let e="string"==typeof t?X("palette",t):t;if("function"!=typeof e)return e}function eA(t,e){let n=2*t;return"string"==typeof e?n=t*Number(e.replace("%",""))/100:"number"==typeof e&&(n=e),isNaN(n)&&(n=2*t),n}function eR(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(t.max[0]-t.min[0])*(i?n:1);return eA(s,e)}let ek=new WeakMap;function eP(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;if(void 0===e)return;let s=function(r){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,o=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;return r.childNodes.forEach(e=>s(e,t))};if(i&&!i(r))return o();if(n||r!==t){ek.has(r)||ek.set(r,r.style.visibility);let t="hidden"===a||"hidden"===(ek.has(r)?ek.get(r):r.style.visibility)?"hidden":"visible";r.style.visibility=t,o(t)}else t.style.visibility=e,ek.delete(t),o(e)};s(t)}var eN={}.toString,eL=Object.prototype,eI=function(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||eL;return t===n},eB=Object.prototype.hasOwnProperty,e_=function(t){if(L(t))return!0;if(F(t))return!t.length;var e=eN.call(t).replace(/^\[object /,"").replace(/]$/,"");if("Map"===e||"Set"===e)return!t.size;if(eI(t))return!Object.keys(t).length;for(var n in t)if(eB.call(t,n))return!1;return!0};class eF extends N.b_{get parsedAttributes(){return this.attributes}upsert(t,e,n,i,s){var r,a,o,l,h,c,d,u;let p=this.shapeMap[t];if(!1===n){p&&(null==s||null===(o=s.beforeDestroy)||void 0===o||o.call(s,p),i.removeChild(p),delete this.shapeMap[t],null==s||null===(l=s.afterDestroy)||void 0===l||l.call(s,p));return}let g="string"==typeof e?X(M.SHAPE,e):e;if(!g)throw Error($("Shape ".concat(e," not found")));if(!p||p.destroyed||!(p instanceof g)){p&&(null==s||null===(d=s.beforeDestroy)||void 0===d||d.call(s,p),null==p||p.destroy(),null==s||null===(u=s.afterDestroy)||void 0===u||u.call(s,p)),null==s||null===(h=s.beforeCreate)||void 0===h||h.call(s);let e=new g({className:t,style:n});return i.appendChild(e),this.shapeMap[t]=e,null==s||null===(c=s.afterCreate)||void 0===c||c.call(s,e),e}return null==s||null===(r=s.beforeUpdate)||void 0===r||r.call(s,p),it(p,n),null==s||null===(a=s.afterUpdate)||void 0===a||a.call(s,p),p}transformPosition(t){let{x:e=0,y:n=0,z:i=0,transform:s}=t;(0!==e||0!==n||0!==i)&&(this.style.transform=tl(+e,+n,+i,s))}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},this.attributes,t);this.attr(e),this.render(e,this),this.transformPosition(e),this.setVisibility()}bindEvents(){}getGraphicStyle(t){return function(t){let{x:e,y:n,z:i,class:s,className:r,transform:a,transformOrigin:o,context:l,zIndex:h,visibility:c,...d}=t;return d}(t)}get compositeShapes(){return[["badges","badge-"],["ports","port-"]]}animate(t,e){if(0===t.length)return null;let n=[];if(void 0!==t[0].x||void 0!==t[0].y||void 0!==t[0].z){let{x:e=0,y:n=0,z:i=0}=this.attributes;t.forEach(t=>{let{x:s=e,y:r=n,z:a=i}=t;Object.assign(t,{transform:tl(+s,+r,+a)})})}let i=super.animate(t,e);if(i&&(ej(this,i),n.push(i)),Array.isArray(t)&&t.length>0){let i=["transform","transformOrigin","x","y","z","zIndex"];if(Object.keys(t[0]).some(t=>!i.includes(t))){Object.entries(this.shapeMap).forEach(i=>{let[s,r]=i,a="get".concat(B(s),"Style"),o=this[a];if(tv(o)){let i=t.map(t=>o.call(this,{...this.attributes,...t})),s=r.animate(tt(i),e);s&&(ej(r,s),n.push(s))}});let i=(i,s)=>{if(!e_(i)){let r="get".concat(B(s),"Style"),a=this[r];if(tv(a)){let s=t.map(t=>a.call(this,{...this.attributes,...t}));Object.entries(s[0]).map(t=>{let[r]=t,a=s.map(t=>t[r]),o=i[r];if(o){let t=o.animate(tt(a),e);t&&(ej(o,t),n.push(t))}})}}};this.compositeShapes.forEach(t=>{let[e,n]=t,s=ep(this.shapeMap,n);i(s,e)})}}return Q(n)}getShape(t){return this.shapeMap[t]}setVisibility(){let{visibility:t}=this.attributes;eP(this,t,!0)}destroy(){this.shapeMap={},this.animateMap={},super.destroy()}constructor(t){super(t),this.shapeMap={},this.animateMap={},this.transformPosition(this.attributes),this.render(this.attributes,this),this.setVisibility(),this.bindEvents()}}function ej(t,e){null==e||e.finished.then(()=>{let n=t.activeAnimations.findIndex(t=>t===e);n>-1&&t.activeAnimations.splice(n,1)})}class ez extends eF{isTextStyle(t){return ed(t,"label")}isBackgroundStyle(t){return ed(t,"background")}getTextStyle(t){let{padding:e,...n}=this.getGraphicStyle(t);return eg(n,"background")}getBackgroundStyle(t){if(!1===t.background)return!1;let e=this.getGraphicStyle(t),{wordWrap:n,wordWrapWidth:i,padding:s}=e,r=eu(e,"background"),{min:[a,o],center:[l,h],halfExtents:[c,d]}=this.shapeMap.text.getGeometryBounds(),[u,p,g,f]=tw(s),y=2*c+f+p,{width:m,height:v}=r;m&&v?Object.assign(r,{x:l-Number(m)/2,y:h-Number(v)/2}):Object.assign(r,{x:a-f,y:o-u,width:n?Math.min(y,i+f+p):y,height:2*d+u+g});let{radius:b}=r;if("string"==typeof b&&b.endsWith("%")){let t=Number(b.replace("%",""))/100;r.radius=Math.min(+r.width,+r.height)*t}return r}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("text",N.xv,this.getTextStyle(t),e),this.upsert("background",N.UL,this.getBackgroundStyle(t),e)}getGeometryBounds(){let t=this.getShape("background")||this.getShape("text");return t.getGeometryBounds()}constructor(t){super(em({style:ez.defaultStyleProps},t))}}ez.defaultStyleProps={padding:0,fontSize:12,fontFamily:"system-ui, sans-serif",wordWrap:!0,maxLines:1,wordWrapWidth:128,textOverflow:"...",textBaseline:"middle",backgroundOpacity:.75,backgroundZIndex:-1,backgroundLineWidth:0};class eH extends eF{getBadgeStyle(t){return this.getGraphicStyle(t)}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("label",ez,this.getBadgeStyle(t),e)}getGeometryBounds(){let t=this.getShape("label"),e=t.getShape("background")||t.getShape("text");return e.getGeometryBounds()}constructor(t){super(em({style:eH.defaultStyleProps},t))}}eH.defaultStyleProps={padding:[2,4,2,4],fontSize:10,wordWrap:!1,backgroundRadius:"50%",backgroundOpacity:1};let eW={M:["x","y"],m:["dx","dy"],H:["x"],h:["dx"],V:["y"],v:["dy"],L:["x","y"],l:["dx","dy"],Z:[],z:[],C:["x1","y1","x2","y2","x","y"],c:["dx1","dy1","dx2","dy2","dx","dy"],S:["x2","y2","x","y"],s:["dx2","dy2","dx","dy"],Q:["x1","y1","x","y"],q:["dx1","dy1","dx","dy"],T:["x","y"],t:["dx","dy"],A:["rx","ry","rotation","large-arc","sweep","x","y"],a:["rx","ry","rotation","large-arc","sweep","dx","dy"]},eV=t=>{if(t.length<2)return[["M",0,0],["L",0,0]];let e=t[0],n=t[1],i=t[t.length-1],s=t[t.length-2];t.unshift(s,i),t.push(e,n);let r=[["M",i[0],i[1]]];for(let e=1;e<t.length-2;e+=1){let[n,i]=t[e-1],[s,a]=t[e],[o,l]=t[e+1],[h,c]=e!==t.length-2?t[e+2]:[o,l],d=s+(o-n)/6,u=a+(l-i)/6,p=o-(h-s)/6,g=l-(c-a)/6;r.push(["C",d,u,p,g,o,l])}return r};class eG extends eF{getLabelStyle(t){if(!t.label||!t.d||0===t.d.length)return!1;let{maxWidth:e,offsetX:n,offsetY:i,autoRotate:s,placement:r,closeToPath:a,...o}=eu(this.getGraphicStyle(t),"label"),l=this.shapeMap.key,h=null==l?void 0:l.getRenderBounds();return Object.assign(function(t,e,n,i,s,r,a){var o;let l,h;let[c,d]=t$(t,e),u={textAlign:"left"===e?"right":"right"===e?"left":"center",textBaseline:"top"===e?"bottom":"bottom"===e?"top":"middle",transform:"translate(".concat(c+n,", ").concat(d+i,")")};if("center"===e||!s)return u;let p=function(t){let e=[],n="string"==typeof t?function(t){let e=t.replace(/[\n\r]/g,"").replace(/-/g," -").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ").trim().split(/\s*,|\s+/),n=[],i="",s={};for(;e.length>0;){let t=e.shift();t in eW?i=t:e.unshift(t),s={type:i},eW[i].forEach(n=>{t=e.shift(),s[n]=t}),"M"===i?i="L":"m"===i&&(i="l");let[r,...a]=Object.values(s);n.push([r,...a.map(Number)])}return n}(t):t;return n.forEach(t=>{let n=t[0];if("Z"===n){e.push(e[0]);return}if("A"!==n)for(let n=1;n<t.length;n+=2)e.push([t[n],t[n+1],0]);else{let n=t.length;e.push([t[n-2],t[n-1],0])}}),e}(r);if(!p||p.length<=3)return u;let g=p.map((t,e)=>{let n=p[(e+1)%p.length];return W(t,n)?null:[t,n]}).filter(Boolean),f=(o=[c,d],l=1/0,h=[[0,0],[0,0]],g.forEach(t=>{let e=function(t,e){let n=t3(t,e);return tj(t,n)}(o,t);e<l&&(l=e,h=t)}),h),y=t3([c,d],f);if(y&&f&&(u.transform="translate(".concat(y[0]+n,", ").concat(y[1]+i,")"),a)){let t=Math.atan((f[0][1]-f[1][1])/(f[0][0]-f[1][0]));u.transform+="rotate(".concat(t/Math.PI*180,"deg)"),u.textAlign="center",("right"===e||"left"===e)&&(t>0?u.textBaseline="right"===e?"bottom":"top":u.textBaseline="right"===e?"top":"bottom")}return u}(h,r,n,i,a,t.d,s),{wordWrapWidth:eR(h,e)},o)}getKeyStyle(t){return this.getGraphicStyle(t)}render(t,e){this.upsert("key",N.y$,this.getKeyStyle(t),e),this.upsert("label",ez,this.getLabelStyle(t),e)}constructor(t){super(em({style:eG.defaultStyleProps},t))}}eG.defaultStyleProps={label:!0,labelPlacement:"bottom",labelCloseToPath:!0,labelAutoRotate:!0,labelOffsetX:0,labelOffsetY:0};class eY extends N.Ee{handleRadius(){let{radius:t,clipPath:e,width:n=0,height:i=0}=this.attributes;if(t&&n&&i){let[s,r]=this.getBounds().min,a={x:s,y:r,radius:t,width:n,height:i};if(e)Object.assign(this.parsedStyle.clipPath.style,a);else{let t=new N.UL({style:a});this.style.clipPath=t}}else e&&(this.style.clipPath=null)}constructor(t){super(t),this.onMounted=()=>{this.handleRadius()},this.onAttrModified=()=>{this.handleRadius()},eK=this,this.isMutationObserved=!0,this.addEventListener(N.Dk.MOUNTED,this.onMounted),this.addEventListener(N.Dk.ATTR_MODIFIED,this.onAttrModified)}}let eU=new WeakMap,eK=null,eZ=t=>{if(eK&&(function(t){let e=[],n=t.parentNode;for(;n;)e.push(n),n=n.parentNode;return e})(eK).includes(t)){let e=eU.get(t);e?e.includes(eK)||e.push(eK):eU.set(t,[eK])}},eX=t=>{let e=eU.get(t);e&&e.forEach(t=>t.handleRadius())};class e$ extends eF{isImage(){let{src:t}=this.attributes;return!!t}getIconStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,{width:e=0,height:n=0}=t,i=this.getGraphicStyle(t);return this.isImage()?{x:-e/2,y:-n/2,...i}:{textBaseline:"middle",textAlign:"center",...i}}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("icon",this.isImage()?eY:N.xv,this.getIconStyle(t),e)}constructor(t){super(t)}}class eq extends eF{get context(){return this.attributes.context}get parsedAttributes(){return this.attributes}onframe(){}animate(t,e){let n=super.animate(t,e);return n&&(n.onframe=()=>this.onframe(),n.finished.then(()=>this.onframe())),n}}var eJ=function(t,e,n,i){var s,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,n,a):s(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};class eQ extends eq{getSize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,{size:e}=t;return ef(e)}getKeyStyle(t){let e=this.getGraphicStyle(t);return Object.assign(eg(e,["label","halo","icon","badge","port"]))}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;let{placement:e,maxWidth:n,offsetX:i,offsetY:s,...r}=eu(this.getGraphicStyle(t),"label"),a=this.getShape("key").getLocalBounds();return Object.assign(n7(a,e,i,s),{wordWrapWidth:eR(a,n)},r)}getHaloStyle(t){if(!1===t.halo)return!1;let{fill:e,...n}=this.getKeyStyle(t),i=eu(this.getGraphicStyle(t),"halo");return{...n,stroke:e,...i}}getIconStyle(t){if(!1===t.icon||!t.iconText&&!t.iconSrc)return!1;let e=eu(this.getGraphicStyle(t),"icon");return Object.assign(function(t,e){let n=ef(t),i={};return e.text&&!e.fontSize&&(i={fontSize:.5*Math.min(...n)}),!e.src||e.width&&e.height||(i={width:.5*n[0],height:.5*n[1]}),i}(t.size,e),e)}getBadgesStyle(t){var e;let n=ep(this.shapeMap,"badge-"),i={};if(Object.keys(n).forEach(t=>{i[t]=!1}),!1===t.badge||!(null===(e=t.badges)||void 0===e?void 0:e.length))return i;let{badges:s=[],badgePalette:r,opacity:a=1,...o}=t,l=eM(r),h=eu(this.getGraphicStyle(o),"badge");return s.forEach((t,e)=>{i[e]={backgroundFill:l?l[e%(null==l?void 0:l.length)]:void 0,opacity:a,...h,...this.getBadgeStyle(t)}}),i}getBadgeStyle(t){let e=this.getShape("key"),{placement:n="top",offsetX:i,offsetY:s,...r}=t,a=n7(e.getLocalBounds(),n,i,s,!0);return{...a,...r}}getPortsStyle(t){var e;let n=this.getPorts(),i={};if(Object.keys(n).forEach(t=>{i[t]=!1}),!1===t.port||!(null===(e=t.ports)||void 0===e?void 0:e.length))return i;let s=eu(this.getGraphicStyle(t),"port"),{ports:r=[]}=t;return r.forEach((e,n)=>{let r=e.key||n,a={...s,...e};if(n3(a))i[r]=!1;else{let[n,s]=this.getPortXY(t,e);i[r]={transform:"translate(".concat(n,", ").concat(s,")"),...a}}}),i}getPortXY(t,e){let{placement:n="left"}=e,i=this.getShape("key");return n1(function(t,e){if(!t)return e.getLocalBounds();let n=t.canvas.getLayer(),i=e.cloneNode();eP(i,"hidden"),n.appendChild(i);let s=i.getLocalBounds();return n.removeChild(i),s}(this.context,i),n)}getPorts(){return ep(this.shapeMap,"port-")}getCenter(){return this.getShape("key").getBounds().center}getIntersectPoint(t){let e=this.getShape("key").getBounds();return function(t,e){let n=t$(e,"center"),i=[t$(e,"left-top"),t$(e,"right-top"),t$(e,"right-bottom"),t$(e,"left-bottom")];return t1(t,n,i,!1).point}(t,e)}drawHaloShape(t,e){let n=this.getShape("key");this.upsert("halo",n.constructor,this.getHaloStyle(t),e)}drawIconShape(t,e){this.upsert("icon",e$,this.getIconStyle(t),e),eZ(this)}drawBadgeShapes(t,e){let n=this.getBadgesStyle(t);Object.keys(n).forEach(t=>{this.upsert("badge-".concat(t),eH,n[t],e)})}drawPortShapes(t,e){let n=this.getPortsStyle(t);Object.keys(n).forEach(t=>{this.upsert("port-".concat(t),N.Cd,n[t],e)})}drawLabelShape(t,e){this.upsert("label",ez,this.getLabelStyle(t),e)}_drawKeyShape(t,e){return this.drawKeyShape(t,e)}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this._drawKeyShape(t,e),this.getShape("key")&&(this.drawHaloShape(t,e),this.drawIconShape(t,e),this.drawBadgeShapes(t,e),this.drawLabelShape(t,e),this.drawPortShapes(t,e))}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&eX(this)}onframe(){this.drawBadgeShapes(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this)}constructor(t){super(em({style:eQ.defaultStyleProps},t)),this.type="node"}}eQ.defaultStyleProps={x:0,y:0,size:32,droppable:!0,draggable:!0,port:!0,ports:[],portZIndex:2,portLinkToCenter:!1,badge:!0,badges:[],badgeZIndex:3,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloStrokeOpacity:.25,haloPointerEvents:"none",haloZIndex:-1,icon:!0,iconZIndex:1,label:!0,labelIsBillboard:!0,labelMaxWidth:"200%",labelPlacement:"bottom",labelWordWrap:!1,labelZIndex:0},eJ([eS((t,e)=>t.getHaloStyle(e))],eQ.prototype,"drawHaloShape",null),eJ([eS((t,e)=>t.getIconStyle(e))],eQ.prototype,"drawIconShape",null),eJ([eS((t,e)=>t.getBadgesStyle(e))],eQ.prototype,"drawBadgeShapes",null),eJ([eS((t,e)=>t.getPortsStyle(e))],eQ.prototype,"drawPortShapes",null),eJ([eS((t,e)=>t.getLabelStyle(e))],eQ.prototype,"drawLabelShape",null),eJ([eS((t,e)=>t.getKeyStyle(e))],eQ.prototype,"_drawKeyShape",null);class e0 extends eQ{drawKeyShape(t,e){return this.upsert("key",N.Cd,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t);return{...e,r:Math.min(...this.getSize(t))/2}}getIconStyle(t){let e=super.getIconStyle(t),{r:n}=this.getShape("key").attributes,i=2*n*.8;return!!e&&{width:i,height:i,...e}}getIntersectPoint(t){let e=this.getShape("key").getBounds();return t2(t,e)}constructor(t){super(em({style:e0.defaultStyleProps},t))}}e0.defaultStyleProps={size:32};class e1 extends eQ{get parsedAttributes(){return this.attributes}drawKeyShape(t,e){return this.upsert("key",N.mg,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t);return{...e,points:this.getPoints(t)}}getIntersectPoint(t){var e,n;let{points:i}=this.getShape("key").attributes,s=[+((null===(e=this.attributes)||void 0===e?void 0:e.x)||0),+((null===(n=this.attributes)||void 0===n?void 0:n.y)||0)];return t1(t,s,i).point}constructor(t){super(t)}}class e2 extends e0{parseOuterR(){let{size:t}=this.parsedAttributes;return Math.min(...ef(t))/2}parseInnerR(){let{innerR:t}=this.parsedAttributes;return H(t)?parseInt(t)/100*this.parseOuterR():t}drawDonutShape(t,e){var n;let{donuts:i}=t;if(!(null==i?void 0:i.length))return;let s=i.map(t=>el(t)?{value:t}:t),r=eu(this.getGraphicStyle(t),"donut"),a=eM(t.donutPalette);if(!a)return;let o=s.reduce((t,e)=>t+(null!==(n=e.value)&&void 0!==n?n:0),0),l=this.parseOuterR(),h=this.parseInnerR(),c=0;s.forEach((t,n)=>{let{value:i=0,color:d=a[n%a.length],...u}=t,p=(0===o?1/s.length:i/o)*360;this.upsert("round".concat(n),N.y$,{...r,d:e8(l,h,c,c+p),fill:d,...u},e),c+=p})}render(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;super.render(t,e),this.drawDonutShape(t,e)}constructor(t){super(em({style:e2.defaultStyleProps},t))}}e2.defaultStyleProps={innerR:"50%",donuts:[],donutPalette:"tableau"};let e3=(t,e,n,i)=>[t+Math.sin(i)*n,e-Math.cos(i)*n],e6=(t,e,n,i)=>i<=0||n<=i?[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"]]:[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"],["M",t+i,e],["A",i,i,0,1,0,t-i,e],["A",i,i,0,1,0,t+i,e],["Z"]],e4=(t,e,n,i,s,r)=>{let[a,o]=[s/360*2*Math.PI,r/360*2*Math.PI],l=[e3(t,e,i,a),e3(t,e,n,a),e3(t,e,n,o),e3(t,e,i,o)],h=o-a>Math.PI?1:0;return[["M",l[0][0],l[0][1]],["L",l[1][0],l[1][1]],["A",n,n,0,h,1,l[2][0],l[2][1]],["L",l[3][0],l[3][1]],["A",i,i,0,h,0,l[0][0],l[0][1]],["Z"]]},e8=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,[s,r]=[0,0];return Math.abs(n-i)%360<1e-6?e6(s,r,t,e):e4(s,r,t,e,n,i)};class e9 extends eQ{drawKeyShape(t,e){return this.upsert("key",N.Pj,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t),[n,i]=this.getSize(t);return{...e,rx:n/2,ry:i/2}}getIconStyle(t){let e=super.getIconStyle(t),{rx:n,ry:i}=this.getShape("key").attributes,s=2*Math.min(+n,+i)*.8;return!!e&&{width:s,height:s,...e}}getIntersectPoint(t){let e=this.getShape("key").getBounds();return t2(t,e)}constructor(t){super(em({style:e9.defaultStyleProps},t))}}e9.defaultStyleProps={size:[45,35]};var e5=function(t,e){if(t){if(ti(t))for(var n=0,i=t.length;n<i&&!1!==e(t[n],n);n++);else if(V(t)){for(var s in t)if(t.hasOwnProperty(s)&&!1===e(t[s],s))break}}},e7=Object.prototype.hasOwnProperty,nt=function(t,e){if(null===t||!ts(t))return{};var n={};return e5(e,function(e){e7.call(t,e)&&(n[e]=t[e])}),n},ne=function(t){return void 0===t};class nn extends eQ{get eventService(){return this.context.canvas.context.eventService}get events(){return[w.CLICK,w.POINTER_DOWN,w.POINTER_MOVE,w.POINTER_UP,w.POINTER_OVER,w.POINTER_LEAVE]}getDomElement(){return this.getShape("key").getDomElement()}getKeyStyle(t){let e=nt(t,["innerHTML","pointerEvents","cursor"]),[n,i]=this.getSize(t);return{...e,width:n,height:i}}drawKeyShape(t,e){let n=this.getKeyStyle(t),{width:i=0,height:s=0}=n,r=this.upsert("key-container",N.UL,{width:i,height:s,opacity:0},e);return this.upsert("key",N.k9,n,r)}connectedCallback(){let t=this.getDomElement();this.events.forEach(e=>{t.addEventListener(e,this.forwardEvents)})}attributeChangedCallback(t,e,n){"zIndex"===t&&e!==n&&(this.getDomElement().style.zIndex=n)}destroy(){let t=this.getDomElement();this.events.forEach(e=>{t.removeEventListener(e,this.forwardEvents)}),super.destroy()}normalizeToPointerEvent(t,e){let n=[];if(e.isTouchEvent(t))for(let e=0;e<t.changedTouches.length;e++){let i=t.changedTouches[e];ne(i.button)&&(i.button=0),ne(i.buttons)&&(i.buttons=1),ne(i.isPrimary)&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),ne(i.width)&&(i.width=i.radiusX||1),ne(i.height)&&(i.height=i.radiusY||1),ne(i.tiltX)&&(i.tiltX=0),ne(i.tiltY)&&(i.tiltY=0),ne(i.pointerType)&&(i.pointerType="touch"),ne(i.pointerId)&&(i.pointerId=i.identifier||0),ne(i.pressure)&&(i.pressure=i.force||.5),ne(i.twist)&&(i.twist=0),ne(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=t.type,n.push(i)}else e.isMouseEvent(t)&&(ne(t.isPrimary)&&(t.isPrimary=!0),ne(t.width)&&(t.width=1),ne(t.height)&&(t.height=1),ne(t.tiltX)&&(t.tiltX=0),ne(t.tiltY)&&(t.tiltY=0),ne(t.pointerType)&&(t.pointerType="mouse"),ne(t.pointerId)&&(t.pointerId=1),ne(t.pressure)&&(t.pressure=.5),ne(t.twist)&&(t.twist=0),ne(t.tangentialPressure)&&(t.tangentialPressure=0),t.isNormalized=!0),n.push(t);return n}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.ctrlKey=e.ctrlKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null}bootstrapEvent(t,e,n,i){t.view=n,t.originalEvent=null,t.nativeEvent=i,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);let{x:s,y:r}=this.getViewportXY(e);t.viewport.x=s,t.viewport.y=r;let[a,o]=this.context.canvas.getCanvasByViewport([s,r]);return t.canvas.x=a,t.canvas.y=o,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=i.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t}getViewportXY(t){let e,n;let{offsetX:i,offsetY:s,clientX:r,clientY:a}=t;if(!this.context.canvas.context.config.supportsCSSTransform||L(i)||L(s)){let t=this.eventService.client2Viewport({x:r,y:a});e=t.x,n=t.y}else e=i,n=s;return{x:e,y:n}}onframe(){super.onframe();let{opacity:t}=this.attributes;this.getDomElement().style.opacity="".concat(t)}constructor(t){super({...t,style:Object.assign({},nn.defaultStyleProps,t.style)}),this.rootPointerEvent=new N.nR(null),this.forwardEvents=t=>{let e=this.context.canvas,n=e.context.renderingContext.root.ownerDocument.defaultView,i=this.normalizeToPointerEvent(t,n);i.forEach(i=>{let s=this.bootstrapEvent(this.rootPointerEvent,i,n,t);e.context.eventService.mapEvent(s)})}}}nn.defaultStyleProps={size:[160,80],halo:!1,icon:!1,label:!1,pointerEvents:"auto"};class ni extends eQ{getKeyStyle(t){let[e,n]=this.getSize(t),{fillOpacity:i,opacity:s=i,...r}=super.getKeyStyle(t);return{opacity:s,...r,width:e,height:n,x:-e/2,y:-n/2}}getHaloStyle(t){if(!1===t.halo)return!1;let{fill:e,stroke:n,...i}=this.getShape("key").attributes,s=eu(this.getGraphicStyle(t),"halo"),r=Number(s.lineWidth),[a,o]=tL(this.getSize(t),[r,r]);return{...s,width:a,height:o,fill:"transparent",x:-a/2,y:-o/2}}getIconStyle(t){let e=super.getIconStyle(t),[n,i]=this.getSize(t);return!!e&&{width:.8*n,height:.8*i,...e}}drawKeyShape(t,e){let n=this.upsert("key",eY,this.getKeyStyle(t),e);return eZ(this),n}drawHaloShape(t,e){this.upsert("halo",N.UL,this.getHaloStyle(t),e)}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&eX(this)}constructor(t){super(em({style:ni.defaultStyleProps},t))}}ni.defaultStyleProps={size:32};class ns extends e1{getPoints(t){let{direction:e}=t,[n,i]=this.getSize(t);return function(t,e,n){let i=e/2,s=t/2,r={up:[[-s,i],[s,i],[0,-i]],left:[[-s,0],[s,i],[s,-i]],right:[[-s,i],[-s,-i],[s,0]],down:[[-s,-i],[s,-i],[0,i]]};return r[n]||r.up}(n,i,e)}getPortXY(t,e){let{direction:n}=t,{placement:i="top"}=e,s=this.getShape("key").getLocalBounds(),[r,a]=this.getSize(t),o=function(t,e,n){let i=e/2,s=t/2,r={};return"down"===n?(r.bottom=r.default=[0,i],r.right=[s,-i],r.left=[-s,-i]):"left"===n?(r.top=[s,-i],r.bottom=[s,i],r.left=r.default=[-s,0]):"right"===n?(r.top=[-s,-i],r.bottom=[-s,i],r.right=r.default=[s,0]):(r.left=[-s,i],r.top=r.default=[0,-i],r.right=[s,i]),r}(r,a,n);return n1(s,i,o,!1)}getIconStyle(t){let{icon:e,iconText:n,iconSrc:i,direction:s}=t;if(!1===e||e_(n||i))return!1;let r=eu(this.getGraphicStyle(t),"icon"),a=this.getShape("key").getLocalBounds(),[o,l]=function(t,e){let{center:n}=t,[i,s]=tO(t),r="up"===e||"down"===e?n[0]:"right"===e?n[0]-i/6:n[0]+i/6,a="left"===e||"right"===e?n[1]:"down"===e?n[1]-s/6:n[1]+s/6;return[r,a]}(a,s),h=2*function(t,e){let[n,i]=tO(t);return[n,i]="up"===e||"down"===e?[n,i]:[i,n],(i**2-(Math.sqrt((n/2)**2+i**2)-n/2)**2)/(2*i)}(a,s)*.8;return{x:o,y:l,width:h,height:h,...r}}constructor(t){super(em({style:ns.defaultStyleProps},t))}}ns.defaultStyleProps={size:40,direction:"up"};class nr extends eQ{getKeySize(t){let{collapsed:e,childrenNode:n=[]}=t;return 0===n.length?this.getEmptyKeySize(t):e?this.getCollapsedKeySize(t):this.getExpandedKeySize(t)}getEmptyKeySize(t){let{padding:e,collapsedSize:n}=t,[i,s,r,a]=tw(e);return tL(ef(n),[a+s,i+r,0])}getCollapsedKeySize(t){return ef(t.collapsedSize)}getExpandedKeySize(t){let e=this.getContentBBox(t);return[tS(e),tC(e),0]}getContentBBox(t){let{context:e,childrenNode:n=[],padding:i}=t,s=n.map(t=>e.element.getElement(t)).filter(Boolean);if(0===s.length){let e=new N.mN,{x:n=0,y:i=0,size:s}=t,[r,a]=ef(s);return e.setMinMax([n-r/2,i-a/2,0],[n+r/2,i+a/2,0]),e}let r=tM(s.map(t=>t.getBounds()));return i?tT(r,i):r}drawCollapsedMarkerShape(t,e){this.upsert("collapsed-marker",e$,this.getCollapsedMarkerStyle(t),e),eZ(this)}getCollapsedMarkerStyle(t){if(!t.collapsed||!t.collapsedMarker)return!1;let{type:e,...n}=eu(this.getGraphicStyle(t),"collapsedMarker"),i=this.getShape("key"),[s,r]=t$(i.getLocalBounds(),"center"),a={...n,x:s,y:r};if(e){let n=this.getCollapsedMarkerText(e,t);Object.assign(a,{text:n})}return a}getCollapsedMarkerText(t,e){let{context:n,childrenData:i=[]}=e,{model:s}=n;return"descendant-count"===t?s.getDescendantsData(this.id).length.toString():"child-count"===t?i.length.toString():"node-count"===t?s.getDescendantsData(this.id).filter(t=>"node"===s.getElementType(ta(t))).length.toString():tv(t)?t(i):""}getComboZIndex(t){let e=this.context.model.getAncestorsData(this.id,U)||[];return e.length}getComboPosition(t){let{x:e=0,y:n=0,collapsed:i,context:s,childrenData:r=[]}=t;if(0===r.length)return[+e,+n,0];if(i){let{model:t}=s,i=t.getDescendantsData(this.id).filter(e=>!t.isCombo(ta(e)));if(i.length>0){let t=i.reduce((t,e)=>tL(t,tX(e)),[0,0,0]);return t_(t,i.length)}return[+e,+n,0]}return this.getContentBBox(t).center}getComboStyle(t){let{zIndex:e=this.getComboZIndex(t)}=t,[n,i]=this.getComboPosition(t);return{x:n,y:i,transform:"translate(".concat(n,", ").concat(i,")"),zIndex:e}}updateComboPosition(t){let e=this.getComboStyle(t);Object.assign(this.style,e);let{x:n,y:i}=e;this.context.model.syncComboDatum({id:this.id,style:{x:n,y:i}}),eX(this)}render(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;super.render(t,e),this.drawCollapsedMarkerShape(t,e)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.update(t),this.updateComboPosition(this.parsedAttributes)}onframe(){super.onframe(),this.attributes.collapsed||this.updateComboPosition(this.parsedAttributes),this.drawKeyShape(this.parsedAttributes,this)}animate(t,e){let n=super.animate(this.attributes.collapsed?t:t.map(t=>{let{x:e,y:n,z:i,transform:s,...r}=t;return r}),e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then(()=>this.onframe()),Reflect.set(t,e,n))}):n}constructor(t){super(em({style:nr.defaultStyleProps},t)),this.type="combo",this.updateComboPosition(this.parsedAttributes)}}nr.defaultStyleProps={childrenNode:[],droppable:!0,draggable:!0,collapsed:!1,collapsedSize:32,collapsedMarker:!0,collapsedMarkerZIndex:1,collapsedMarkerFontSize:12,collapsedMarkerTextAlign:"center",collapsedMarkerTextBaseline:"middle",collapsedMarkerType:"child-count"},function(t,e,n,i){var s,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,n,a):s(e,n))||a);r>3&&a&&Object.defineProperty(e,n,a)}([eS((t,e)=>t.getCollapsedMarkerStyle(e))],nr.prototype,"drawCollapsedMarkerShape",null);var na=function(t,e){if(!F(t))return t;for(var n=[],i=0;i<t.length;i++){var s=t[i];e(s,i)&&n.push(s)}return n};let no={padding:10};function nl(t,e,n,i,s,r){let{padding:a}=Object.assign(no,r),o=tD(n,a),l=tD(i,a),h=[t,...s,e],c=null,d=[];for(let t=0,e=h.length;t<e-1;t++){var u,p;let n=t+1,i=h[t],s=h[n],r=(u=i,p=s,u[1]===p[1]||u[0]===p[0]),g=null;0===t?n===e-1?o.intersects(l)?g=nf(i,s,o,l):r||(g=function(t,e,n,i){let s=np(t,e,n),r=tY(s.points[0]);if(tA(r,i)){s=np(e,t,i);let a=tY(s.points[0]);if(tA(a,n)){let o=t0(t,r,nu(n,nd(t,r))/2),l=t0(e,a,nu(i,nd(e,a))/2),h=[(o[0]+l[0])/2,(o[1]+l[1])/2],c=np(t,h,n),d=ng(h,e,i,c.direction);s.points=[c.points[0],d.points[0]],s.direction=d.direction}}return s}(i,s,o,l)):tA(s,o)?g=nf(i,s,o,tD(s,a),c):r||(g=np(i,s,o)):n===e-1?tA(i,l)?g=nf(i,s,tD(i,a),l,c):r||(g=ng(i,s,l,c)):r||(g=function(t,e,n){let i=[t[0],e[1]],s=[e[0],t[1]],r=nd(t,i),a=nd(t,s),o=n?nh[n]:null,l=r===n||r!==o&&a!==n?i:s;return{points:[l],direction:nd(l,e)}}(i,s,c)),g?(d.push(...g.points),c=g.direction):c=nd(i,s),n<e-1&&d.push(s)}return d}let nh={N:"S",S:"N",W:"E",E:"W"},nc={N:-Math.PI/2,S:Math.PI/2,E:0,W:Math.PI};function nd(t,e){let[n,i]=t,[s,r]=e;return n===s?i>r?"N":"S":i===r?n>s?"W":"E":null}function nu(t,e){return"N"===e||"S"===e?tC(t):tS(t)}function np(t,e,n){let i=ny(t,e,n);return{points:[i],direction:nd(i,e)}}function ng(t,e,n,i){let s=[[e[0],t[1]],[t[0],e[1]]],r=s.filter(t=>!tA(t,n)&&!tR(t,n,!0)),a=r.filter(e=>nd(e,t)!==i);if(a.length>0){let n=a.find(e=>nd(t,e)===i)||a[0];return{points:[n],direction:nd(n,e)}}{var o;let a=(void 0===(o=r)&&(o=[]),na(s,function(t){var e;return!(F(e=o)&&e.indexOf(t)>-1)}))[0],l=t0(e,a,nu(n,i)/2),h=ny(l,t,n);return{points:[h,l],direction:nd(l,e)}}}function nf(t,e,n,i,s){let r;let a=tM([n,i]),o=tj(e,a.center)>tj(t,a.center),[l,h]=o?[e,t]:[t,e],c=tC(a)+tS(a);if(s){let t=[l[0]+c*Math.cos(nc[s]),l[1]+c*Math.sin(nc[s])];r=t0(tP(a,t),t,.01)}else r=t0(tP(a,l),l,-.01);let d=ny(r,h,a),u=[tQ(r,2),tQ(d,2)];if(W(tQ(r),tQ(d))){let t=tW(tI(r,l),[1,0,0])+Math.PI/2;d=[h[0]+c*Math.cos(t),h[1]+c*Math.sin(t),0],d=tQ(t0(tP(a,d),h,-.01),2);let e=ny(r,d,a);u=[r,e,d]}return{points:o?u.reverse():u,direction:o?nd(r,e):nd(d,e)}}function ny(t,e,n){let i=[t[0],e[1]];return tA(i,n)&&(i=[e[0],t[1]]),i}function nm(t,e,n,i,s){let r="number"==typeof e?e:.5;"start"===e&&(r=0),"end"===e&&(r=.99);let a=tq(t.getPoint(r)),o=tq(t.getPoint(r+.01)),l="start"===e?"left":"end"===e?"right":"center";if(a[1]===o[1]||!n){let[e,n]=nv(t,r,i,s);return{transform:"translate(".concat(e,", ").concat(n,")"),textAlign:l}}let h=Math.atan2(o[1]-a[1],o[0]-a[0]),c=o[0]<a[0];c&&(l="center"===l?l:"left"===l?"right":"left",i*=-1,h+=Math.PI);let[d,u]=nv(t,r,i,s,h),p="translate(".concat(d,", ").concat(u,") rotate(").concat(h/Math.PI*180,"deg)");return{textAlign:l,transform:p}}function nv(t,e,n,i,s){let[r,a]=tq(t.getPoint(e)),o=n,l=i;return s&&(o=n*Math.cos(s)-i*Math.sin(s),l=n*Math.sin(s)+i*Math.cos(s)),[r+o,a+l]}function nb(t,e,n,i){if(W(t,e))return t;let s=tI(e,t),r=[t[0]+n*s[0],t[1]+n*s[1]],a=tH(tV(s,!1));return r[0]+=i*a[0],r[1]+=i*a[1],r}function nE(t,e,n){return[["M",t[0],t[1]],["C",n[0][0],n[0][1],n[1][0],n[1][1],e[0],e[1]]]}function nx(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t[0],s=t[t.length-1],r=t.slice(1,t.length-1),a=[["M",i[0],i[1]]];return r.forEach((t,n)=>{let o=r[n-1]||i,l=r[n+1]||s;if(!tU([o,t],[t,l])&&e){let[n,i]=function(t,e,n,i){let s=tz(t,e),r=tz(n,e),a=Math.min(i,Math.min(s,r)/2),o=[e[0]-a/s*(e[0]-t[0]),e[1]-a/s*(e[1]-t[1])],l=[e[0]-a/r*(e[0]-n[0]),e[1]-a/r*(e[1]-n[1])];return[o,l]}(o,t,l,e);a.push(["L",n[0],n[1]],["Q",t[0],t[1],i[0],i[1]],["L",i[0],i[1]])}else a.push(["L",t[0],t[1]])}),a.push(["L",s[0],s[1]]),n&&a.push(["Z"]),a}let nw=t=>{let e=Math.PI/2,n=tC(t)/2,i=tS(t)/2,s=Math.atan2(n,i)/2,r=Math.atan2(i,n)/2;return{top:[-e-r,-e+r],"top-right":[-e+r,-s],"right-top":[-e+r,-s],right:[-s,s],"bottom-right":[s,e-r],"right-bottom":[s,e-r],bottom:[e-r,e+r],"bottom-left":[e+r,Math.PI-s],"left-bottom":[e+r,Math.PI-s],left:[Math.PI-s,Math.PI+s],"top-left":[Math.PI+s,-e-r],"left-top":[Math.PI+s,-e-r]}};function nS(t,e,n,i,s){let r=tD(t),a=t.getCenter(),o=i&&n6(i),l=s&&n6(s);if(!o||!l){let i=nw(r),s=i[e][0],h=i[e][1],[c,d]=tO(r),u=Math.max(c,d),p=tL(a,[u*Math.cos(s),u*Math.sin(s),0]),g=tL(a,[u*Math.cos(h),u*Math.sin(h),0]);o=n5(t,p),l=n5(t,g),n||([o,l]=[l,o])}return[o,l]}function nC(t,e){let n=new Set,i=new Set,s=new Set;return t.forEach(r=>{let a=e(r);a.forEach(e=>{n.add(e),t.includes(e.source)&&t.includes(e.target)?i.add(e):s.add(e)})}),{edges:Array.from(n),internal:Array.from(i),external:Array.from(s)}}function nO(t,e){let n=[],i=t;for(;i;){n.push(i);let t=e(ta(i));if(t)i=t;else break}if(n.some(t=>{var e;return null===(e=t.style)||void 0===e?void 0:e.collapsed})){let t=n.reverse().findIndex(ea);return n[t]||n.at(-1)}return t}let nD=(t,e)=>{let n=Math.max(t,e)/2;return[["M",-t/2,0],["A",n,n,0,1,0,2*n-t/2,0],["A",n,n,0,1,0,-t/2,0],["Z"]]},nT=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",t/2,e/2],["Z"]],nM=(t,e)=>[["M",-t/2,0],["L",0,-e/2],["L",t/2,0],["L",0,e/2],["Z"]],nA=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",4*t/5-t/2,0],["L",t/2,e/2],["Z"]],nR=(t,e)=>[["M",-t/2,-e/2],["L",t/2,-e/2],["L",t/2,e/2],["L",-t/2,e/2],["Z"]],nk=(t,e)=>{let n=t/2,i=t/7,s=t-i;return[["M",-n,0],["L",0,-e/2],["L",0,e/2],["Z"],["M",s-n,-e/2],["L",s+i-n,-e/2],["L",s+i-n,e/2],["L",s-n,e/2],["Z"]]},nP=(t,e)=>[["M",t/2,-e/2],["L",-t/2,0],["L",t/2,0],["L",-t/2,0],["L",t/2,e/2]];var nN=function(t,e,n,i){var s,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,n,a):s(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};class nL extends eq{get sourceNode(){let{context:t,sourceNode:e}=this.parsedAttributes;return t.element.getElement(e)}get targetNode(){let{context:t,targetNode:e}=this.parsedAttributes;return t.element.getElement(e)}getKeyStyle(t){let{loop:e,...n}=this.getGraphicStyle(t),{sourceNode:i,targetNode:s}=this,r=e&&i&&s&&i===s?this.getLoopPath(t):this.getKeyPath(t);return{d:r,...eg(n,["halo","label","startArrow","endArrow"])}}getLoopPath(t){let{sourcePort:e,targetPort:n}=t,i=this.sourceNode,s=tD(i),r=Math.max(tS(s),tC(s)),{placement:a,clockwise:o,dist:l=r}=eu(this.getGraphicStyle(t),"loop");return function(t,e,n,i,s,r){let a=t.getPorts()[s||r],o=t.getPorts()[r||s],[l,h]=nS(t,e,n,a,o),c=function(t,e,n,i){let s=t.getCenter();if(W(e,n)){let t=tI(e,s),r=[i*Math.sign(t[0])||i/2,i*Math.sign(t[1])||-i/2,0];return[tL(e,r),tL(n,tB(r,[1,-1,1]))]}return[t0(s,e,tj(s,e)+i),t0(s,n,tj(s,n)+i)]}(t,l,h,i);return a&&(l=n9(a,c[0])),o&&(h=n9(o,c[c.length-1])),nE(l,h,c)}(i,a,o,l,e,n)}getEndpoints(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],{sourcePort:i,targetPort:s}=t,{sourceNode:r,targetNode:a}=this,[o,l]=function(t,e,n,i){let s=n4(t,e,n,i),r=n4(e,t,i,n);return[s,r]}(r,a,i,s);if(!e){let t=o?n6(o):r.getCenter(),e=l?n6(l):a.getCenter();return[t,e]}let h="function"==typeof n?n():n,c=n8(o||r,h[0]||l||a),d=n8(l||a,h[h.length-1]||o||r);return[c,d]}getHaloStyle(t){if(!1===t.halo)return!1;let e=this.getKeyStyle(t),n=eu(this.getGraphicStyle(t),"halo");return{...e,...n}}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;let e=eu(this.getGraphicStyle(t),"label"),{placement:n,offsetX:i,offsetY:s,autoRotate:r,maxWidth:a,...o}=e,l=nm(this.shapeMap.key,n,r,i,s),h=this.shapeMap.key.getLocalBounds(),c=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=tj(t[0],t[1])*n;return eA(i,e)}([h.min,h.max],a);return Object.assign({wordWrapWidth:c},l,o)}getBadgeStyle(t){if(!1===t.badge||!t.badgeText)return!1;let{offsetX:e,offsetY:n,placement:i,...s}=eu(t,"badge");return Object.assign(s,function(t,e,n,i,s){var r,a;let o=(null===(r=t.badge)||void 0===r?void 0:r.getGeometryBounds().halfExtents[0])*2||0,l=(null===(a=t.label)||void 0===a?void 0:a.getGeometryBounds().halfExtents[0])*2||0;return nm(t.key,n,!0,(l?(l/2+o/2)*("suffix"===e?1:-1):0)+i,s)}(this.shapeMap,i,t.labelPlacement,e,n))}drawArrow(t,e){let n="start"===e,i=t["start"===e?"startArrow":"endArrow"],s=this.shapeMap.key;if(i){let e=this.getArrowStyle(t,n),[i,r,a]=n?["markerStart","markerStartOffset","startArrowOffset"]:["markerEnd","markerEndOffset","endArrowOffset"],o=s.parsedStyle[i];if(o)o.attr(e);else{let t=e.src?N.Ee:N.y$,n=new t({style:e});s.style[i]=n}s.style[r]=t[a]||e.width/2+ +e.lineWidth}else{var r;let t=n?"markerStart":"markerEnd";null===(r=s.style[t])||void 0===r||r.destroy(),s.style[t]=null}}getArrowStyle(t,e){var n;let i=this.getShape("key").attributes,{size:s,type:r,...a}=eu(this.getGraphicStyle(t),e?"startArrow":"endArrow"),[o,l]=ef((n=i.lineWidth,s||(n<4?10:4===n?12:2.5*n))),h=tv(r)?r:P[r]||nT,c=h(o,l);return Object.assign(nt(i,["stroke","strokeOpacity","fillOpacity"]),{width:o,height:l},{...c&&{d:c,fill:"simple"===r?"":i.stroke}},a)}drawLabelShape(t,e){this.upsert("label",ez,this.getLabelStyle(t),e)}drawHaloShape(t,e){this.upsert("halo",N.y$,this.getHaloStyle(t),e)}drawBadgeShape(t,e){this.upsert("badge",eH,this.getBadgeStyle(t),e)}drawSourceArrow(t){this.drawArrow(t,"start")}drawTargetArrow(t){this.drawArrow(t,"end")}drawKeyShape(t,e){let n=this.upsert("key",N.y$,this.getKeyStyle(t),e);return n}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.drawKeyShape(t,e),this.getShape("key")&&(this.drawSourceArrow(t),this.drawTargetArrow(t),this.drawLabelShape(t,e),this.drawHaloShape(t,e),this.drawBadgeShape(t,e))}onframe(){this.drawKeyShape(this.parsedAttributes,this),this.drawSourceArrow(this.parsedAttributes),this.drawTargetArrow(this.parsedAttributes),this.drawHaloShape(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this),this.drawBadgeShape(this.parsedAttributes,this)}animate(t,e){let n=super.animate(t,e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then(()=>this.onframe()),Reflect.set(t,e,n))}):n}constructor(t){super(em({style:nL.defaultStyleProps},t)),this.type="edge"}}nL.defaultStyleProps={badge:!0,badgeOffsetX:0,badgeOffsetY:0,badgePlacement:"suffix",isBillboard:!0,label:!0,labelAutoRotate:!0,labelIsBillboard:!0,labelMaxWidth:"80%",labelOffsetX:4,labelOffsetY:0,labelPlacement:"center",labelTextBaseline:"middle",labelWordWrap:!1,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloPointerEvents:"none",haloStrokeOpacity:.25,haloZIndex:-1,loop:!0,startArrow:!1,startArrowLineDash:0,startArrowLineJoin:"round",startArrowLineWidth:1,startArrowTransformOrigin:"center",startArrowType:"vee",endArrow:!1,endArrowLineDash:0,endArrowLineJoin:"round",endArrowLineWidth:1,endArrowTransformOrigin:"center",endArrowType:"vee",loopPlacement:"top",loopClockwise:!0},nN([eS((t,e)=>t.getLabelStyle(e))],nL.prototype,"drawLabelShape",null),nN([eS((t,e)=>t.getHaloStyle(e))],nL.prototype,"drawHaloShape",null),nN([eS((t,e)=>t.getBadgeStyle(e))],nL.prototype,"drawBadgeShape",null),nN([eS((t,e)=>t.getArrowStyle(e,"start"))],nL.prototype,"drawSourceArrow",null),nN([eS((t,e)=>t.getArrowStyle(e,"end"))],nL.prototype,"drawTargetArrow",null),nN([eS((t,e)=>t.getKeyStyle(e))],nL.prototype,"drawKeyShape",null);class nI extends nL{getKeyPath(t){let[e,n]=this.getEndpoints(t),{controlPoints:i,curvePosition:s,curveOffset:r}=t,a=this.getControlPoints(e,n,el(s)?[s,1-s]:s,el(r)?[r,-r]:r,i);return nE(e,n,a)}getControlPoints(t,e,n,i,s){return(null==s?void 0:s.length)===2?s:[nb(t,e,n[0],i[0]),nb(t,e,n[1],i[1])]}constructor(t){super(em({style:nI.defaultStyleProps},t))}}nI.defaultStyleProps={curvePosition:.5,curveOffset:20};class nB extends nI{getControlPoints(t,e,n,i){let s=e[0]-t[0];return[[t[0]+s*n[0]+i[0],t[1]],[e[0]-s*n[1]+i[1],e[1]]]}constructor(t){super(em({style:nB.defaultStyleProps},t))}}nB.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class n_ extends nI{getControlPoints(t,e,n,i){let s=e[1]-t[1];return[[t[0],t[1]+s*n[0]+i[0]],[e[0],e[1]-s*n[1]+i[1]]]}constructor(t){super(em({style:n_.defaultStyleProps},t))}}n_.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class nF extends nL{getKeyPath(t){let[e,n]=this.getEndpoints(t);return[["M",e[0],e[1]],["L",n[0],n[1]]]}constructor(t){super(em({style:nF.defaultStyleProps},t))}}nF.defaultStyleProps={};let nj={enableObstacleAvoidance:!1,offset:10,maxAllowedDirectionChange:Math.PI/2,maximumLoops:3e3,gridSize:5,startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{right:{stepX:1,stepY:0},left:{stepX:-1,stepY:0},bottom:{stepX:0,stepY:1},top:{stepX:0,stepY:-1}},penalties:{0:0,90:0},distFunc:tz},nz=t=>"".concat(Math.round(t[0]),"|||").concat(Math.round(t[1]));function nH(t,e){let n=t=>Math.round(t/e);return el(t)?n(t):t.map(n)}function nW(t,e){let n=e[0]-t[0],i=e[1]-t[1];return n||i?Math.atan2(i,n):0}function nV(t,e,n,i){let s=nW(t,e),r=n[nz(t)],a=nW(r||i,t);return function(t,e){let n=Math.abs(t-e);return n>Math.PI?2*Math.PI-n:n}(a,s)}let nG=(t,e)=>{let{offset:n,gridSize:i}=e,s={};return t.forEach(t=>{if(!t||t.destroyed||!t.isVisible())return;let e=tT(t.getRenderBounds(),n);for(let t=nH(e.min[0],i);t<=nH(e.max[0],i);t+=1)for(let n=nH(e.min[1],i);n<=nH(e.max[1],i);n+=1)s["".concat(t,"|||").concat(n)]=!0}),s};function nY(t,e,n){return Math.min(...e.map(e=>n(t,e)))}let nU=(t,e,n,i)=>{if(!e)return[t];let{directionMap:s,offset:r}=i,a=tT(e.getRenderBounds(),r),o=Object.keys(s).reduce((e,i)=>{if(n.includes(i)){let n=s[i],[r,o]=tO(a),l=[t[0]+n.stepX*r,t[1]+n.stepY*o],h=function(t){let{min:[e,n],max:[i,s]}=t,r=[e,s],a=[i,s],o=[i,n],l=[e,n];return[[r,a],[a,o],[o,l],[l,r]]}(a);for(let n=0;n<h.length;n++){let i=tK([t,l],h[n]);i&&tR(i,a)&&e.push(i)}}return e},[]);return tA(t,a)||o.push(t),o.map(t=>nH(t,i.gridSize))},nK=(t,e,n,i,s,r,a)=>{let o=[],l=[r[0]===i[0]?i[0]:t[0]*a,r[1]===i[1]?i[1]:t[1]*a];o.unshift(l);let h=t,c=e[nz(h)];for(;c;){let t=c,i=h,s=nV(t,i,e,n);s&&(l=[t[0]===i[0]?l[0]:t[0]*a,t[1]===i[1]?l[1]:t[1]*a],o.unshift(l)),c=e[nz(t)],h=t}let d=s.map(t=>[t[0]*a,t[1]*a]),u=function(t,e,n){let i=t[0],s=n(t[0],e);for(let r=0;r<t.length;r++){let a=t[r],o=n(a,e);o<s&&(i=a,s=o)}return i}(d,l,tz);return o.unshift(u),o};class nZ{_innerAdd(t,e){let n=0,i=e-1;for(;i-n>1;){let e=Math.floor((n+i)/2);if(this.arr[e].value>t.value)i=e;else if(this.arr[e].value<t.value)n=e;else{this.arr.splice(e,0,t),this.map[t.id]=!0;return}}this.arr.splice(i,0,t),this.map[t.id]=!0}add(t){delete this.map[t.id];let e=this.arr.length;if(!e||this.arr[e-1].value<t.value){this.arr.push(t),this.map[t.id]=!0;return}this._innerAdd(t,e)}remove(t){this.map[t]&&delete this.map[t]}_clearAndGetMinId(){let t;for(let e=this.arr.length-1;e>=0;e--)this.map[this.arr[e].id]?t=this.arr[e].id:this.arr.splice(e,1);return t}_findFirstId(){for(;this.arr.length;){let t=this.arr.shift();if(this.map[t.id])return t.id}}minId(t){return t?this._clearAndGetMinId():this._findFirstId()}constructor(){this.arr=[],this.map={},this.arr=[],this.map={}}}class nX extends nL{getControlPoints(t){let{router:e}=t,{sourceNode:n,targetNode:i}=this,[s,r]=this.getEndpoints(t,!1),a=[];if(e){if("shortest-path"===e.type){let o=this.context.element.getNodes();(a=function(t,e,n,i){let s;let r=tG(t.getCenter()),a=tG(e.getCenter()),o=Object.assign(nj,i),{gridSize:l}=o,h=o.enableObstacleAvoidance?n:[t,e],c=nG(h,o),d=nH(r,l),u=nH(a,l),p=nU(r,t,o.startDirections,o),g=nU(a,e,o.endDirections,o);p.forEach(t=>delete c[nz(t)]),g.forEach(t=>delete c[nz(t)]);let f={},y={},m={},v={},b={},E=new nZ;for(let t=0;t<p.length;t++){let e=p[t],n=nz(e);f[n]=e,v[n]=0,b[n]=nY(e,g,o.distFunc),E.add({id:n,value:b[n]})}let x=g.map(t=>nz(t)),w=o.maximumLoops,S=1/0;for(let[t,e]of Object.entries(f))b[t]<=S&&(S=b[t],s=e);for(;Object.keys(f).length>0&&w>0;){let t=E.minId(!1);if(t)s=f[t];else break;let e=nz(s);if(x.includes(e))return nK(s,m,d,a,p,u,l);for(let t of(delete f[e],E.remove(e),y[e]=!0,Object.values(o.directionMap))){let n=tL(s,[t.stepX,t.stepY]),i=nz(n);if(y[i])continue;let r=nV(s,n,m,d);if(r>o.maxAllowedDirectionChange||c[i])continue;f[i]||(f[i]=n);let a=o.penalties[r],h=o.distFunc(s,n)+(isNaN(a)?l:a),u=v[e]+h,p=v[i];p&&u>=p||(m[i]=s,v[i]=u,b[i]=u+nY(n,g,o.distFunc),E.add({id:i,value:b[i]}))}w-=1}return[]}(n,i,o,e)).length||(a=nl(s,r,n,i,t.controlPoints,{padding:e.offset}))}else"orth"===e.type&&(a=nl(s,r,n,i,t.controlPoints,e))}else a=t.controlPoints;return a}getPoints(t){let e=this.getControlPoints(t),[n,i]=this.getEndpoints(t,!0,e);return[n,...e,i]}getKeyPath(t){let e=this.getPoints(t);return nx(e,t.radius)}getLoopPath(t){let{sourcePort:e,targetPort:n,radius:i}=t,s=this.sourceNode,r=tD(s),a=Math.max(tS(r),tC(r))/4,{placement:o,clockwise:l,dist:h=a}=eu(this.getGraphicStyle(t),"loop");return function(t,e,n,i,s,r,a){let o=n2(t),l=o[r||a],h=o[a||r],[c,d]=nS(t,n,i,l,h),u=function(t,e,n,i){let s=[],r=tD(t);if(W(e,n)){let t=tk(r,e);switch(t){case"left":s.push([e[0]-i,e[1]]),s.push([e[0]-i,e[1]+i]),s.push([e[0],e[1]+i]);break;case"right":s.push([e[0]+i,e[1]]),s.push([e[0]+i,e[1]+i]),s.push([e[0],e[1]+i]);break;case"top":s.push([e[0],e[1]-i]),s.push([e[0]+i,e[1]-i]),s.push([e[0]+i,e[1]]);break;case"bottom":s.push([e[0],e[1]+i]),s.push([e[0]+i,e[1]+i]),s.push([e[0]+i,e[1]])}}else{let t=tk(r,e),a=tk(r,n);if(t===a){let r,a;switch(t){case"left":r=Math.min(e[0],n[0])-i,s.push([r,e[1]]),s.push([r,n[1]]);break;case"right":r=Math.max(e[0],n[0])+i,s.push([r,e[1]]),s.push([r,n[1]]);break;case"top":a=Math.min(e[1],n[1])-i,s.push([e[0],a]),s.push([n[0],a]);break;case"bottom":a=Math.max(e[1],n[1])+i,s.push([e[0],a]),s.push([n[0],a])}}else{let o=(t,e)=>({left:[e[0]-i,e[1]],right:[e[0]+i,e[1]],top:[e[0],e[1]-i],bottom:[e[0],e[1]+i]})[t],l=o(t,e),h=o(a,n),c=ny(l,h,r);s.push(l,c,h)}}return s}(t,c,d,s);return l&&(c=n9(l,u[0])),h&&(d=n9(h,u[u.length-1])),nx([c,...u,d],e)}(s,i,o,l,h,e,n)}constructor(t){super(em({style:nX.defaultStyleProps},t))}}nX.defaultStyleProps={radius:0,controlPoints:[],router:!1};class n$ extends nL{getKeyPath(t){let{curvePosition:e,curveOffset:n}=t,[i,s]=this.getEndpoints(t),r=t.controlPoint||nb(i,s,e,n);return[["M",i[0],i[1]],["Q",r[0],r[1],s[0],s[1]]]}constructor(t){super(em({style:n$.defaultStyleProps},t))}}function nq(t){return t instanceof eQ&&"node"===t.type}function nJ(t){return t instanceof nL}function nQ(t){return t instanceof nr}n$.defaultStyleProps={curvePosition:.5,curveOffset:30};let n0={top:[.5,0],right:[1,.5],bottom:[.5,1],left:[0,.5],default:[.5,.5]};function n1(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n0,i=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s=[.5,.5],r=H(e)?eo(n,e.toLocaleLowerCase(),s):e;if(!i&&H(e))return r;let[a,o]=r||s;return[t.min[0]+tS(t)*a,t.min[1]+tC(t)*o]}function n2(t){if(!t)return{};let e=t.getPorts(),n=t.attributes.ports||[];return n.forEach((n,i)=>{let{key:s,placement:r}=n;if(n3(n)){var a;e[a=s||i]||(e[a]=t$(t.getShape("key").getBounds(),r))}}),e}function n3(t){let{r:e}=t;return!e||0===Number(e)}function n6(t){return tE(t)?t:t.getPosition()}function n4(t,e,n,i){let s,r;let a=n2(t);if(n)return a[n];let o=Object.values(a);if(0===o.length)return;let l=o.map(t=>n6(t)),h=function(t,e){let n=n2(t);if(e)return[n6(n[e])];let i=Object.values(n);return i.length>0?i.map(t=>n6(t)):[t.getCenter()]}(e,i),[c]=(s=1/0,r=[l[0],h[0]],l.forEach(t=>{h.forEach(e=>{let n=tj(t,e);n<s&&(s=n,r=[t,e])})}),r);return o.find(t=>n6(t)===c)}function n8(t,e){return nQ(t)||nq(t)?n5(t,e):n9(t,e)}function n9(t,e){if(!t||!e)return[0,0,0];if(tE(t))return t;if(t.attributes.linkToCenter)return t.getPosition();let n=tE(e)?e:nq(e)?e.getCenter():e.getPosition();return t2(n,t.getBounds())}function n5(t,e){if(!t||!e)return[0,0,0];let n=tE(e)?e:nq(e)?e.getCenter():e.getPosition();return t.getIntersectPoint(n)||t.getCenter()}function n7(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=e.split("-"),[a,o]=t$(t,e),l=r.includes("left")?"right":r.includes("right")?"left":"center",h=r.includes("top")?"bottom":r.includes("bottom")?"top":"middle";return s&&(h="top"===h?"bottom":"bottom"===h?"top":h),{transform:"translate(".concat(a+n,", ").concat(o+i,")"),textBaseline:h,textAlign:l}}function it(t,e){"update"in t?t.update(e):t.attr(e)}function ie(t){return eo(t,"__to_be_destroyed__",!1)}class ii extends tm{update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.on("node:".concat(e),this.onCollapseExpand),t.on("combo:".concat(e),this.onCollapseExpand)}unbindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.off("node:".concat(e),this.onCollapseExpand),t.off("combo:".concat(e),this.onCollapseExpand)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},ii.defaultOptions,e)),this.onCollapseExpand=async t=>{if(!this.validate(t))return;let{target:e}=t;if(!(nq(e)||nJ(e)||nQ(e)))return;let n=e.id,{model:i,graph:s}=this.context,r=i.getElementDataById(n);if(!r)return!1;let{onCollapse:a,onExpand:o,animation:l}=this.options;ea(r)?(await s.expandElement(n,l),null==o||o(n)):(await s.collapseElement(n,l),null==a||a(n))},this.bindEvents()}}ii.defaultOptions={enable:!0,animation:!0,trigger:w.DBLCLICK};var is={};let ir="g6-create-edge-assist-node-id";class ia extends tm{update(t){super.update(t),this.bindEvents()}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;this.unbindEvents(),"click"===e?(t.on(T.CLICK,this.handleCreateEdge),t.on(x.CLICK,this.handleCreateEdge),t.on(E.CLICK,this.cancelEdge),t.on(C.CLICK,this.cancelEdge)):(t.on(T.DRAG_START,this.handleCreateEdge),t.on(x.DRAG_START,this.handleCreateEdge),t.on(w.POINTER_UP,this.drop)),t.on(w.POINTER_MOVE,this.updateAssistEdge)}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map(t=>t.id).concat(t)))}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;t.off(T.CLICK,this.handleCreateEdge),t.off(x.CLICK,this.handleCreateEdge),t.off(E.CLICK,this.cancelEdge),t.off(C.CLICK,this.cancelEdge),t.off(T.DRAG_START,this.handleCreateEdge),t.off(x.DRAG_START,this.handleCreateEdge),t.off(w.POINTER_UP,this.drop),t.off(w.POINTER_MOVE,this.updateAssistEdge)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},ia.defaultOptions,e)),this.drop=async t=>{let{targetType:e}=t;["combo","node"].includes(e)&&this.source?await this.handleCreateEdge(t):await this.cancelEdge()},this.handleCreateEdge=async t=>{var e;if(!this.validate(t))return;let{graph:n,canvas:i,batch:s,element:r}=this.context,{style:a}=this.options;if(this.source){this.createEdge(t),await this.cancelEdge();return}s.startBatch(),i.setCursor("crosshair"),this.source=this.getSelectedNodeIDs([t.target.id])[0],n.addNodeData([{id:ir,style:{visibility:"hidden",ports:[{key:"port-1",placement:[.5,.5]}]}}]),n.addEdgeData([{id:"g6-create-edge-assist-edge-id",source:this.source,target:ir,style:{pointerEvents:"none",...a}}]),await (null===(e=r.draw({animation:!1}))||void 0===e?void 0:e.finished)},this.updateAssistEdge=async t=>{var e;if(!this.source)return;let{model:n,element:i}=this.context;n.translateNodeTo(ir,[t.canvas.x,t.canvas.y]),await (null===(e=i.draw({animation:!1,silence:!0}))||void 0===e?void 0:e.finished)},this.createEdge=t=>{var e,n,i;let{graph:s}=this.context,{style:r,onFinish:a,onCreate:o}=this.options,l=null===(e=t.target)||void 0===e?void 0:e.id;if(void 0===l||void 0===this.source)return;let h=null===(n=this.getSelectedNodeIDs([t.target.id]))||void 0===n?void 0:n[0],c="".concat(this.source,"-").concat(h,"-").concat((is[i=i||"g"]?is[i]+=1:is[i]=1,i+is[i])),d=o({id:c,source:this.source,target:h,style:r});s.addEdgeData([d]),a(d)},this.cancelEdge=async()=>{var t;if(!this.source)return;let{graph:e,element:n,batch:i}=this.context;e.removeNodeData([ir]),this.source=void 0,await (null===(t=n.draw({animation:!1}))||void 0===t?void 0:t.finished),i.endBatch()},this.bindEvents()}}ia.defaultOptions={animation:!0,enable:!0,style:{},trigger:"drag",onCreate:t=>t,onFinish:()=>{}};var io=function(t,e,n){var i;return function(){var s=this,r=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(s,r)},e),a&&t.apply(s,r)}};class il extends tm{update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{trigger:t}=this.options;if(V(t)){let{up:e=[],down:n=[],left:i=[],right:s=[]}=t;this.shortcut.bind(e,t=>this.onTranslate([0,1],t)),this.shortcut.bind(n,t=>this.onTranslate([0,-1],t)),this.shortcut.bind(i,t=>this.onTranslate([1,0],t)),this.shortcut.bind(s,t=>this.onTranslate([-1,0],t))}else{let{graph:t}=this.context;t.on(w.DRAG_START,this.onDragStart),t.on(w.DRAG,this.onDrag),t.on(w.DRAG_END,this.onDragEnd)}}async onTranslate(t,e){if(!this.validate(e))return;let{sensitivity:n}=this.options;await this.translate(tB(t,-1*n),this.options.animation),this.invokeOnFinish()}async translate(t,e){let[n,i]=t,{direction:s}=this.options;"x"===s?i=0:"y"===s&&(n=0),await this.context.graph.translateBy([n,i],e)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return"function"==typeof e?e(t):!!e}unbindEvents(){this.shortcut.unbindAll();let{graph:t}=this.context;t.off(w.DRAG_START,this.onDragStart),t.off(w.DRAG,this.onDrag),t.off(w.DRAG_END,this.onDragEnd)}destroy(){this.shortcut.destroy(),this.unbindEvents(),this.context.canvas.setCursor(this.defaultCursor),super.destroy()}constructor(t,e){super(t,Object.assign({},il.defaultOptions,e)),this.isDragging=!1,this.onDragStart=t=>{this.validate(t)&&(this.isDragging=!0,this.context.canvas.setCursor("grabbing"))},this.onDrag=t=>{if(!this.isDragging)return;let{x:e,y:n}=t.movement;(e|n)!=0&&this.translate([e,n],!1)},this.onDragEnd=()=>{var t,e;this.isDragging=!1,this.context.canvas.setCursor(this.defaultCursor),null===(e=(t=this.options).onFinish)||void 0===e||e.call(t)},this.invokeOnFinish=io(()=>{var t,e;null===(e=(t=this.options).onFinish)||void 0===e||e.call(t)},300),this.shortcut=new t9(t.graph),this.bindEvents(),this.defaultCursor=this.context.canvas.getConfig().cursor||"default"}}il.defaultOptions={enable:t=>!("targetType"in t)||"canvas"===t.targetType,sensitivity:10,direction:"both"};class ih extends tm{get animation(){return!!this.options.shadow&&this.options.animation}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{graph:t}=this.context;this.enableElements.forEach(e=>{t.on("".concat(e,":").concat(w.DRAG_START),this.onDragStart),t.on("".concat(e,":").concat(w.DRAG),this.onDrag),t.on("".concat(e,":").concat(w.DRAG_END),this.onDragEnd),t.on("".concat(e,":").concat(w.POINTER_ENTER),this.setCursor),t.on("".concat(e,":").concat(w.POINTER_LEAVE),this.setCursor)}),["link"].includes(this.options.dropEffect)&&(t.on(x.DROP,this.onDrop),t.on(E.DROP,this.onDrop))}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map(t=>t.id).concat(t)))}getDelta(t){let e=this.context.graph.getZoom();return t_([t.dx,t.dy],e)}onDragStart(t){var e;if(this.enable=this.validate(t),!this.enable)return;let{batch:n,canvas:i}=this.context;i.setCursor((null===(e=this.options.cursor)||void 0===e?void 0:e.grabbing)||"grabbing"),this.isDragging=!0,n.startBatch(),this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target),this.options.shadow&&this.createShadow(this.target)}onDrag(t){if(!this.enable)return;let e=this.getDelta(t);this.options.shadow?this.moveShadow(e):this.moveElement(this.target,e)}onDragEnd(){var t,e,n;if(this.enable=!1,this.options.shadow){if(!this.shadow)return;this.shadow.style.visibility="hidden";let{x:t=0,y:e=0}=this.shadow.attributes,[n,i]=tI([+t,+e],this.shadowOrigin);this.moveElement(this.target,[n,i])}this.showEdges(),null===(e=(t=this.options).onFinish)||void 0===e||e.call(t,this.target);let{batch:i,canvas:s}=this.context;i.endBatch(),s.setCursor((null===(n=this.options.cursor)||void 0===n?void 0:n.grab)||"grab"),this.isDragging=!1,this.target=[]}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}async moveElement(t,e){let{graph:n,model:i}=this.context,{dropEffect:s}=this.options;"move"===s&&t.forEach(t=>i.refreshComboData(t)),n.translateElementBy(Object.fromEntries(t.map(t=>[t,e])),!1)}moveShadow(t){if(!this.shadow)return;let{x:e=0,y:n=0}=this.shadow.attributes,[i,s]=t;this.shadow.attr({x:+e+i,y:+n+s})}createShadow(t){let e=eu(this.options,"shadow"),n=tM(t.map(t=>this.context.element.getElement(t).getBounds())),[i,s]=n.min;this.shadowOrigin=[i,s];let[r,a]=tO(n),o={width:r,height:a,x:i,y:s};this.shadow?this.shadow.attr({...e,...o,visibility:"visible"}):(this.shadow=new N.UL({style:{$layer:"transient",...e,...o,pointerEvents:"none"}}),this.context.canvas.appendChild(this.shadow))}showEdges(){this.options.shadow||0===this.hiddenEdges.length||(this.context.graph.showElement(this.hiddenEdges),this.hiddenEdges=[])}hideEdge(){let{hideEdge:t,shadow:e}=this.options;if("none"===t||e)return;let{graph:n}=this.context;"all"===t?this.hiddenEdges=n.getEdgeData().map(ta):this.hiddenEdges=Array.from(new Set(this.target.map(e=>n.getRelatedEdgesData(e,t).map(ta)).flat())),n.hideElement(this.hiddenEdges)}unbindEvents(){let{graph:t}=this.context;this.enableElements.forEach(e=>{t.off("".concat(e,":").concat(w.DRAG_START),this.onDragStart),t.off("".concat(e,":").concat(w.DRAG),this.onDrag),t.off("".concat(e,":").concat(w.DRAG_END),this.onDragEnd),t.off("".concat(e,":").concat(w.POINTER_ENTER),this.setCursor),t.off("".concat(e,":").concat(w.POINTER_LEAVE),this.setCursor)}),t.off("combo:".concat(w.DROP),this.onDrop),t.off("canvas:".concat(w.DROP),this.onDrop)}destroy(){var t;this.unbindEvents(),null===(t=this.shadow)||void 0===t||t.destroy(),super.destroy()}constructor(t,e){super(t,Object.assign({},ih.defaultOptions,e)),this.enable=!1,this.enableElements=["node","combo"],this.target=[],this.shadowOrigin=[0,0],this.hiddenEdges=[],this.isDragging=!1,this.onDrop=async t=>{var e;if("link"!==this.options.dropEffect)return;let{model:n,element:i}=this.context,s=t.target.id;this.target.forEach(t=>{let e=n.getParentData(t,U);e&&ta(e)===s&&n.refreshComboData(s),n.setParent(t,s,U)}),await (null===(e=null==i?void 0:i.draw({animation:!0}))||void 0===e?void 0:e.finished)},this.setCursor=t=>{if(this.isDragging)return;let{type:e}=t,{canvas:n}=this.context,{cursor:i}=this.options;e===w.POINTER_ENTER?n.setCursor((null==i?void 0:i.grab)||"grab"):n.setCursor((null==i?void 0:i.default)||"default")},this.onDragStart=this.onDragStart.bind(this),this.onDrag=this.onDrag.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onDrop=this.onDrop.bind(this),this.bindEvents()}}ih.defaultOptions={animation:!0,enable:t=>["node","combo"].includes(t.targetType),dropEffect:"move",state:"selected",hideEdge:"none",shadow:!1,shadowZIndex:100,shadowFill:"#F3F9FF",shadowFillOpacity:.5,shadowStroke:"#1890FF",shadowStrokeOpacity:.9,shadowLineDash:[5,5],cursor:{default:"default",grab:"grab",grabbing:"grabbing"}};var ic=n(72137);class id{constructor(t,e){this.context=t,this.options=e||{}}}function iu(t){let{nodes:e,edges:n}=t,i={nodes:[],edges:[],combos:[]};return e.forEach(t=>{let e=t.data._isCombo?i.combos:i.nodes,{x:n,y:s,z:r=0}=t.data;null==e||e.push({id:t.id,style:{x:n,y:s,z:r}})}),n.forEach(t=>{let{id:e,source:n,target:s,data:{points:r=[],controlPoints:a=r.slice(1,r.length-1)}}=t;i.edges.push({id:e,source:n,target:s,style:{...(null==a?void 0:a.length)?{controlPoints:a.map(tq)}:{}}})}),i}function ip(t,e){for(var n=arguments.length,i=Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e in t)return t[e](...i);if("instance"in t){let n=t.instance;if(e in n)return n[e](...i)}return null}function ig(t,e){if(e in t)return t[e];if("instance"in t){let n=t.instance;if(e in n)return n[e]}return null}class iy extends tm{bindEvents(){let{graph:t}=this.context;t.on(O.AFTER_TRANSFORM,this.fixElementSize),t.on(O.BEFORE_DRAW,this.resetTransform)}unbindEvents(){let{graph:t}=this.context;t.off(O.AFTER_TRANSFORM,this.fixElementSize),t.off(O.BEFORE_DRAW,this.resetTransform)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},iy.defaultOptions,e)),this.elementCache=new Map,this.isZoomEvent=t=>"scale"in t.data,this.fixElementSize=async t=>{if(!this.isZoomEvent(t)||!this.validate(t))return;let{graph:e,element:n}=this.context,{state:i}=this.options,s=i?[...e.getElementDataByState("node",i),...e.getElementDataByState("edge",i),...e.getElementDataByState("combo",i)]:Object.values(e.getData()).flat();if(!s.length)return;let r=t.data.scale||e.getZoom();s.forEach(t=>{let i=ta(t),s=null==n?void 0:n.getElement(i),a=e.getElementType(i),o=this.options[a];if(!o){this.elementCache.set(i,s),"edge"===a&&(s.style.transformOrigin="center"),s.setLocalScale(1/r);return}let l=function(t){let e=[],n=t=>{(null==t?void 0:t.children.length)&&t.children.forEach(t=>{e.push(t),n(t)})};return n(t),e}(s),h=Array.isArray(o)?o:[o];h.forEach(t=>{let{shape:e,fields:n}=t,i=e(l);n.forEach(t=>{ew(i,t)||eE(i,t);let e=ex(i,t);el(e)&&(i.style[t]=e/r)})})})},this.resetTransform=async()=>{this.elementCache&&(this.elementCache.forEach(t=>t.setLocalScale(1)),this.elementCache.clear())},this.bindEvents()}}iy.defaultOptions={enable:t=>t.data.scale<1,state:"selected",edge:[{shape:t=>t.find(t=>"key"===t.className),fields:["lineWidth"]},{shape:t=>t.find(t=>{var e;return(null===(e=t.parentElement)||void 0===e?void 0:e.className)==="label"&&"text"===t.className}),fields:["fontSize","lineHeight"]}]};class im extends tm{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),et.forEach(e=>{t.on("".concat(e,":").concat(w.CLICK),this.focus)})}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;et.forEach(e=>{t.off("".concat(e,":").concat(w.CLICK),this.focus)})}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},im.defaultOptions,e)),this.focus=async t=>{if(!this.validate(t))return;let{graph:e}=this.context;await e.focusElement(t.target.id,this.options.animation)},this.bindEvents()}}im.defaultOptions={animation:{easing:"ease-in",duration:500},enable:!0};class iv extends tm{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),et.forEach(e=>{t.on("".concat(e,":").concat(w.POINTER_OVER),this.hoverElement),t.on("".concat(e,":").concat(w.POINTER_OUT),this.hoverElement)});let e=this.context.canvas.document;e.addEventListener("".concat(w.DRAG_START),this.toggleFrozen),e.addEventListener("".concat(w.DRAG_END),this.toggleFrozen)}validate(t){if(this.destroyed||this.isFrozen||this.context.graph.isCollapsingExpanding)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;et.forEach(e=>{t.off("".concat(e,":").concat(w.POINTER_OVER),this.hoverElement),t.off("".concat(e,":").concat(w.POINTER_OUT),this.hoverElement)});let e=this.context.canvas.document;e.removeEventListener("".concat(w.DRAG_START),this.toggleFrozen),e.removeEventListener("".concat(w.DRAG_END),this.toggleFrozen)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},iv.defaultOptions,e)),this.isFrozen=!1,this.toggleFrozen=t=>{this.isFrozen="dragstart"===t.type},this.hoverElement=t=>{if(!this.validate(t))return;let e=t.type===w.POINTER_OVER;this.updateElementsState(t,e);let{onHover:n,onHoverEnd:i}=this.options;e?null==n||n(t):null==i||i(t)},this.updateElementsState=(t,e)=>{if(!this.options.state&&!this.options.inactiveState)return;let{graph:n}=this.context,{state:i,degree:s,animation:r,inactiveState:a}=this.options,{targetType:o,target:l}=t,h=s?en(n,o,l.id,s):[l.id],c={};if(i&&Object.assign(c,this.getElementsState(h,i,e)),a){let t=to(n.getData(),!0).filter(t=>!h.includes(t));Object.assign(c,this.getElementsState(t,a,e))}n.setElementState(c,r)},this.getElementsState=(t,e,n)=>{let{graph:i}=this.context,s={};return t.forEach(t=>{let r=i.getElementState(t),a=n?[...r,e]:r.filter(t=>t!==e);s[t]=a}),s},this.bindEvents()}}iv.defaultOptions={animation:!1,enable:!0,degree:0,state:"active",inactiveState:void 0};class ib extends tm{bindEvents(){let{graph:t}=this.context;t.on(O.BEFORE_TRANSFORM,this.hideShapes),t.on(O.AFTER_TRANSFORM,this.showShapes)}unbindEvents(){let{graph:t}=this.context;t.off(O.BEFORE_TRANSFORM,this.hideShapes),t.off(O.AFTER_TRANSFORM,this.showShapes)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},ib.defaultOptions,e)),this.isVisible=!0,this.setElementsVisibility=(t,e,n)=>{t.forEach(t=>{eP(t,e,!1,t=>!t.className||!(null==n?void 0:n.includes(t.className)))})},this.hideShapes=t=>{if(!this.validate(t)||!this.isVisible)return;let{element:e}=this.context,{shapes:n={}}=this.options;this.setElementsVisibility(e.getNodes(),"hidden",n.node),this.setElementsVisibility(e.getEdges(),"hidden",n.edge),this.setElementsVisibility(e.getCombos(),"hidden",n.combo),this.isVisible=!1},this.showShapes=io(t=>{if(!this.validate(t)||this.isVisible)return;let{element:e}=this.context;this.setElementsVisibility(e.getNodes(),"visible"),this.setElementsVisibility(e.getEdges(),"visible"),this.setElementsVisibility(e.getCombos(),"visible"),this.isVisible=!0},this.options.debounce),this.bindEvents()}}ib.defaultOptions={enable:!0,debounce:200,shapes:{node:["key"]}};class iE extends tm{update(t){super.update(t),this.bindEvents()}bindEvents(){var t,e;let{trigger:n}=this.options;if(this.shortcut.unbindAll(),V(n)){null===(t=this.graphDom)||void 0===t||t.removeEventListener(w.WHEEL,this.onWheel);let{up:e=[],down:i=[],left:s=[],right:r=[]}=n;this.shortcut.bind(e,t=>this.scroll([0,-10],t)),this.shortcut.bind(i,t=>this.scroll([0,10],t)),this.shortcut.bind(s,t=>this.scroll([-10,0],t)),this.shortcut.bind(r,t=>this.scroll([10,0],t))}else null===(e=this.graphDom)||void 0===e||e.addEventListener(w.WHEEL,this.onWheel,{passive:!1})}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}formatDisplacement(t){let[e,n]=t,{direction:i,sensitivity:s}=this.options;return e*=s,n*=s,"x"===i?n=0:"y"===i&&(e=0),[e,n]}async scroll(t,e){if(!this.validate(e))return;let{onFinish:n}=this.options,i=this.context.graph,s=this.formatDisplacement(t);await i.translateBy(s,!1),null==n||n()}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),null===(t=this.graphDom)||void 0===t||t.removeEventListener(w.WHEEL,this.onWheel),super.destroy()}constructor(t,e){super(t,Object.assign({},iE.defaultOptions,e)),this.onWheel=async t=>{this.options.preventDefault&&t.preventDefault();let e=t.deltaX,n=t.deltaY;await this.scroll([-e,-n],t)},this.shortcut=new t9(t.graph),this.bindEvents()}}iE.defaultOptions={enable:!0,sensitivity:1,preventDefault:!0};var ix=function(t,e,n){return t<e?e:t>n?n:t};class iw extends tm{update(t){super.update(t),this.bindEvents()}bindEvents(){let{trigger:t}=this.options;if(this.shortcut.unbindAll(),Array.isArray(t)){var e;null===(e=this.context.canvas.getContainer())||void 0===e||e.addEventListener(w.WHEEL,this.preventDefault),this.shortcut.bind([...t,w.WHEEL],t=>{let{deltaX:e,deltaY:n}=t;this.zoom(-(null!=n?n:e),t,!1)})}if("object"==typeof t){let{zoomIn:e=[],zoomOut:n=[],reset:i=[]}=t;this.shortcut.bind(e,t=>this.zoom(10,t,this.options.animation)),this.shortcut.bind(n,t=>this.zoom(-10,t,this.options.animation)),this.shortcut.bind(i,this.onReset)}}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tv(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),null===(t=this.context.canvas.getContainer())||void 0===t||t.removeEventListener(w.WHEEL,this.preventDefault),super.destroy()}constructor(t,e){super(t,Object.assign({},iw.defaultOptions,e)),this.zoom=async(t,e,n)=>{let i;if(!this.validate(e))return;let{graph:s}=this.context;"viewport"in e&&(i=tq(e.viewport));let{sensitivity:r,onFinish:a}=this.options,o=1+ix(t,-50,50)*r/100,l=s.getZoom();await s.zoomTo(l*o,n,i),null==a||a()},this.onReset=async()=>{await this.context.graph.zoomTo(1,this.options.animation)},this.preventDefault=t=>{this.options.preventDefault&&t.preventDefault()},this.shortcut=new t9(t.graph),this.bindEvents()}}iw.defaultOptions={animation:{duration:200},enable:!0,sensitivity:1,trigger:[],preventDefault:!0};var iS=n(81746),iC=n(28104),iO=n(63795),iD=n(39233),iT=n(5192),iM=n(93390),iA=n(51712),iR=n(67753),ik=n(12368),iP=n(89469),iN=n(41733),iL=n(64912),iI=n(29257),iB=n(26629),i_=function(t,e,n){if(!ti(t)&&!ts(t))return t;var i=n;return e5(t,function(t,n){i=e(i,t,n)}),i},iF=function(t,e){return i_(t,function(t,n,i){return e.includes(i)||(t[i]=n),t},{})};let ij=t=>t?parseInt(t):0;function iz(t){let e=640,n=480,[i,s]=function(t){let e=getComputedStyle(t),n=t.clientWidth||ij(e.width),i=t.clientHeight||ij(e.height),s=ij(e.paddingLeft)+ij(e.paddingRight),r=ij(e.paddingTop)+ij(e.paddingBottom);return[n-s,i-r]}(t);return e=i||e,n=s||n,[Math.max(el(e)?e:1,1),Math.max(el(n)?n:1,1)]}function iH(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=document.createElement("div");return n.setAttribute("class","g6-".concat(t)),n.style.position="absolute",n.style.display="block",e&&(n.style.inset="0px",n.style.height="100%",n.style.width="100%",n.style.overflow="hidden",n.style.pointerEvents="none"),n}function iW(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body,r=document.getElementById(t);r&&r.remove();let a=document.createElement(e);return a.innerHTML=i,a.id=t,Object.assign(a.style,n),s.appendChild(a),a}class iV extends ty{}class iG extends iV{async update(t){super.update(t),Object.assign(this.$element.style,iF(this.options,["key","type"]))}destroy(){super.destroy(),this.$element.remove()}constructor(t,e){super(t,Object.assign({},iG.defaultOptions,e)),this.$element=iH("background");let n=this.context.canvas.getContainer();n.prepend(this.$element),this.update(e)}}function iY(t,e,n,i,s,r){let a=n-t,o=i-e,l=s-t,h=r-e,c=l*a+h*o,d=0;d=c<=0?0:(c=(l=a-l)*a+(h=o-h)*o)<=0?0:c*c/(a*a+o*o);let u=l*l+h*h-d;return u<0?0:u}function iU(t,e,n,i){return(t-n)*(t-n)+(e-i)*(e-i)}function iK(t){let e=Math.min(t.x1,t.x2),n=Math.max(t.x1,t.x2),i=Math.min(t.y1,t.y2),s=Math.max(t.y1,t.y2);return{x:e,y:i,x2:n,y2:s,width:n-e,height:s-i}}iG.defaultOptions={transition:"background 0.5s",backgroundSize:"cover"};class iZ{constructor(t,e,n,i){this.x1=t,this.y1=e,this.x2=n,this.y2=i}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}draw(t){t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2)}toString(){return`Line(from=(${this.x1},${this.y1}),to=(${this.x2},${this.y2}))`}static from(t){return new iZ(t.x1,t.y1,t.x2,t.y2)}cuts(t,e){if(this.y1===this.y2||e<this.y1&&e<=this.y2||e>this.y1&&e>=this.y2||t>this.x1&&t>=this.x2)return!1;if(t<this.x1&&t<=this.x2)return!0;let n=this.x1+(e-this.y1)*(this.x2-this.x1)/(this.y2-this.y1);return t<=n}distSquare(t,e){return iY(this.x1,this.y1,this.x2,this.y2,t,e)}ptClose(t,e,n){if(this.x1<this.x2){if(t<this.x1-n||t>this.x2+n)return!1}else if(t<this.x2-n||t>this.x1+n)return!1;if(this.y1<this.y2){if(e<this.y1-n||e>this.y2+n)return!1}else if(e<this.y2-n||e>this.y1+n)return!1;return!0}}(f=A||(A={}))[f.POINT=1]="POINT",f[f.PARALLEL=2]="PARALLEL",f[f.COINCIDENT=3]="COINCIDENT",f[f.NONE=4]="NONE";class iX{constructor(t,e=0,n=0){this.state=t,this.x=e,this.y=n}}function i$(t,e){let n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),s=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(s){let e=n/s,r=i/s;return 0<=e&&e<=1&&0<=r&&r<=1?new iX(A.POINT,t.x1+e*(t.x2-t.x1),t.y1+e*(t.y2-t.y1)):new iX(A.NONE)}return new iX(0===n||0===i?A.COINCIDENT:A.PARALLEL)}function iq(t,e){let n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),s=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(s){let t=n/s,e=i/s;if(0<=t&&t<=1&&0<=e&&e<=1)return t}return Number.POSITIVE_INFINITY}function iJ(t,e,n){let i=new Set;return t.width<=0?(i.add(R.LEFT),i.add(R.RIGHT)):e<t.x?i.add(R.LEFT):e>t.x+t.width&&i.add(R.RIGHT),t.height<=0?(i.add(R.TOP),i.add(R.BOTTOM)):n<t.y?i.add(R.TOP):n>t.y+t.height&&i.add(R.BOTTOM),i}function iQ(t,e){let n=e.x1,i=e.y1,s=e.x2,r=e.y2,a=Array.from(iJ(t,s,r));if(0===a.length)return!0;let o=iJ(t,n,i);for(;0!==o.size;){for(let t of a)if(o.has(t))return!1;if(o.has(R.RIGHT)||o.has(R.LEFT)){let e=t.x;o.has(R.RIGHT)&&(e+=t.width),i+=(e-n)*(r-i)/(s-n),n=e}else{let e=t.y;o.has(R.BOTTOM)&&(e+=t.height),n+=(e-i)*(s-n)/(r-i),i=e}o=iJ(t,n,i)}return!0}(y=R||(R={}))[y.LEFT=0]="LEFT",y[y.TOP=1]="TOP",y[y.RIGHT=2]="RIGHT",y[y.BOTTOM=3]="BOTTOM";class i0{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get cx(){return this.x+this.width/2}get cy(){return this.y+this.height/2}get radius(){return Math.max(this.width,this.height)/2}static from(t){return new i0(t.x,t.y,t.width,t.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}clone(){return new i0(this.x,this.y,this.width,this.height)}add(t){let e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x2,t.x+t.width),s=Math.max(this.y2,t.y+t.height);this.x=e,this.y=n,this.width=i-e,this.height=s-n}addPoint(t){let e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x2,t.x),s=Math.max(this.y2,t.y);this.x=e,this.y=n,this.width=i-e,this.height=s-n}toString(){return`Rectangle[x=${this.x}, y=${this.y}, w=${this.width}, h=${this.height}]`}draw(t){t.rect(this.x,this.y,this.width,this.height)}containsPt(t,e){return t>=this.x&&t<=this.x2&&e>=this.y&&e<=this.y2}get area(){return this.width*this.height}intersects(t){return!(this.area<=0)&&!(t.width<=0)&&!(t.height<=0)&&t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x2&&t.y<this.y2}distSquare(t,e){if(this.containsPt(t,e))return 0;let n=iJ(this,t,e);return n.has(R.TOP)?n.has(R.LEFT)?iU(t,e,this.x,this.y):n.has(R.RIGHT)?iU(t,e,this.x2,this.y):(this.y-e)*(this.y-e):n.has(R.BOTTOM)?n.has(R.LEFT)?iU(t,e,this.x,this.y2):n.has(R.RIGHT)?iU(t,e,this.x2,this.y2):(e-this.y2)*(e-this.y2):n.has(R.LEFT)?(this.x-t)*(this.x-t):n.has(R.RIGHT)?(t-this.x2)*(t-this.x2):0}}class i1{constructor(t,e,n){this.cx=t,this.cy=e,this.radius=n}get x(){return this.cx-this.radius}get x2(){return this.cx+this.radius}get width(){return 2*this.radius}get y(){return this.cy-this.radius}get y2(){return this.cy+this.radius}get height(){return 2*this.radius}static from(t){return new i1(t.cx,t.cy,t.radius)}containsPt(t,e){return iU(this.cx,this.cy,t,e)<this.radius*this.radius}distSquare(t,e){let n=iU(this.cx,this.cy,t,e);if(n<this.radius*this.radius)return 0;let i=Math.sqrt(n)-this.radius;return i*i}draw(t){t.ellipse(this.cx,this.cy,this.radius,this.radius,0,0,2*Math.PI)}}class i2{constructor(t,e=0,n=0,i=0,s=0,r=10,a=10,o=new Float32Array(Math.max(0,r*a)).fill(0)){this.pixelGroup=t,this.i=e,this.j=n,this.pixelX=i,this.pixelY=s,this.width=r,this.height=a,this.area=o}createSub(t,e){return new i2(this.pixelGroup,t.x,t.y,e.x,e.y,t.width,t.height)}static fromPixelRegion(t,e){return new i2(e,0,0,t.x,t.y,Math.ceil(t.width/e),Math.ceil(t.height/e))}copy(t,e){return new i2(this.pixelGroup,this.scaleX(e.x),this.scaleY(e.y),e.x,e.y,t.width,t.height,t.area)}boundX(t){return t<this.i?this.i:t>=this.width?this.width-1:t}boundY(t){return t<this.j?this.j:t>=this.height?this.height-1:t}scaleX(t){return this.boundX(Math.floor((t-this.pixelX)/this.pixelGroup))}scaleY(t){return this.boundY(Math.floor((t-this.pixelY)/this.pixelGroup))}scale(t){let e=this.scaleX(t.x),n=this.scaleY(t.y),i=this.boundX(Math.ceil((t.x+t.width-this.pixelX)/this.pixelGroup)),s=this.boundY(Math.ceil((t.y+t.height-this.pixelY)/this.pixelGroup)),r=i-e,a=s-n;return new i0(e,n,r,a)}invertScaleX(t){return Math.round(t*this.pixelGroup+this.pixelX)}invertScaleY(t){return Math.round(t*this.pixelGroup+this.pixelY)}addPadding(t,e){let n=Math.ceil(e/this.pixelGroup),i=this.boundX(t.x-n),s=this.boundY(t.y-n),r=this.boundX(t.x2+n),a=this.boundY(t.y2+n),o=r-i,l=a-s;return new i0(i,s,o,l)}get(t,e){return t<0||e<0||t>=this.width||e>=this.height?Number.NaN:this.area[t+e*this.width]}inc(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]+=n)}set(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]=n)}incArea(t,e){if(t.width<=0||t.height<=0||0===e)return;let n=this.width,i=t.width,s=Math.max(0,t.i),r=Math.max(0,t.j),a=Math.min(t.i+t.width,n),o=Math.min(t.j+t.height,this.height);if(!(o<=0)&&!(a<=0)&&!(s>=n)&&!(o>=this.height))for(let l=r;l<o;l++){let r=(l-t.j)*i,o=l*n;for(let n=s;n<a;n++){let i=t.area[n-t.i+r];0!==i&&(this.area[n+o]+=e*i)}}}fill(t){this.area.fill(t)}fillArea(t,e){let n=t.x+t.y*this.width;for(let i=0;i<t.height;i++){let s=n+i*this.width;this.area.fill(e,s,s+t.width)}}fillHorizontalLine(t,e,n,i){let s=t+e*this.width;this.area.fill(i,s,s+n)}fillVerticalLine(t,e,n,i){let s=t+e*this.width;for(let t=0;t<n;t++)this.area[s+t*this.width]=i}clear(){this.area.fill(0)}toString(){let t="";for(let e=0;e<this.height;e++){let n=e*this.width;for(let e=0;e<this.width;e++){let i=this.area[n+e];t+=i.toFixed(1).padStart(6)+" "}t+="\n"}return t}draw(t,e=!0){if(this.width<=0||this.height<=0)return;t.save(),e&&t.translate(this.pixelX,this.pixelY);let n=this.area.reduce((t,e)=>Math.min(t,e),Number.POSITIVE_INFINITY),i=this.area.reduce((t,e)=>Math.max(t,e),Number.NEGATIVE_INFINITY),s=t=>(t-n)/(i-n);t.scale(this.pixelGroup,this.pixelGroup);for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){let i=this.area[e+n*this.width];t.fillStyle=`rgba(0, 0, 0, ${s(i)})`,t.fillRect(e,n,1,1)}t.restore()}drawThreshold(t,e,n=!0){if(!(this.width<=0)&&!(this.height<=0)){t.save(),n&&t.translate(this.pixelX,this.pixelY),t.scale(this.pixelGroup,this.pixelGroup);for(let n=0;n<this.width;n++)for(let i=0;i<this.height;i++){let s=this.area[n+i*this.width];t.fillStyle=s>e?"black":"white",t.fillRect(n,i,1,1)}t.restore()}}}function i3(t,e){let n=t=>({x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e});return Array.isArray(t)?t.map(n):n(t)}function i6(t,e,n){return i4(Object.assign(iK(t),{distSquare:(e,n)=>iY(t.x1,t.y1,t.x2,t.y2,e,n)}),e,n)}function i4(t,e,n){let i=i3(t,n),s=e.scale(i),r=e.createSub(s,i);return function(t,e,n,i){let s=n*n;for(let r=0;r<t.height;r++)for(let a=0;a<t.width;a++){let o=e.invertScaleX(t.i+a),l=e.invertScaleY(t.j+r),h=i(o,l);if(0===h){t.set(a,r,s);continue}if(h<s){let e=n-Math.sqrt(h);t.set(a,r,e*e)}}}(r,e,n,(e,n)=>t.distSquare(e,n)),r}function i8(t,e){return e.some(e=>e.containsPt(t.x,t.y))}function i9(t,e){return e.some(e=>{var n,i,s,r;return n=e.x1,i=e.y1,1e-6>iU(n,i,t.x,t.y)||(s=e.x2,r=e.y2,1e-6>iU(s,r,t.x,t.y))})}function i5(t,e){let n=Number.POSITIVE_INFINITY,i=null;for(let s of t){if(!iQ(s,e))continue;let t=function(t,e){let n=Number.POSITIVE_INFINITY,i=0;function s(t,s,r,a){let o=iq(e,new iZ(t,s,r,a));(o=Math.abs(o-.5))>=0&&o<=1&&(i++,o<n&&(n=o))}return(s(t.x,t.y,t.x2,t.y),s(t.x,t.y,t.x,t.y2),i>1)?n:(s(t.x,t.y2,t.x2,t.y2),i>1)?n:(s(t.x2,t.y,t.x2,t.y2),0===i)?-1:n}(s,e);t>=0&&t<n&&(i=s,n=t)}return i}function i7(t,e,n,i){let s=n.top,r=n.left,a=n.bottom,o=n.right;if(i){if(r.state===A.POINT){if(s.state===A.POINT)return{x:t.x-e,y:t.y-e};if(a.state===A.POINT)return{x:t.x-e,y:t.y2+e};let n=t.width*t.height,i=t.width*((r.y-t.y+(o.y-t.y))*.5);return i<.5*n?r.y>o.y?{x:t.x-e,y:t.y-e}:{x:t.x2+e,y:t.y-e}:r.y<o.y?{x:t.x-e,y:t.y2+e}:{x:t.x2+e,y:t.y2+e}}if(o.state===A.POINT){if(s.state===A.POINT)return{x:t.x2+e,y:t.y-e};if(a.state===A.POINT)return{x:t.x2+e,y:t.y2+e}}let n=t.height*t.width,i=t.height*((s.x-t.x+(o.x-t.x))*.5);return i<.5*n?s.x>a.x?{x:t.x-e,y:t.y-e}:{x:t.x-e,y:t.y2+e}:s.x<a.x?{x:t.x2+e,y:t.y-e}:{x:t.x2+e,y:t.y2+e}}if(r.state===A.POINT){if(s.state===A.POINT)return{x:t.x2+e,y:t.y2+e};if(a.state===A.POINT)return{x:t.x2+e,y:t.y-e};let n=t.height*t.width,i=t.width*((r.y-t.y+(o.y-t.y))*.5);return i<.5*n?r.y>o.y?{x:t.x2+e,y:t.y2+e}:{x:t.x-e,y:t.y2+e}:r.y<o.y?{x:t.x2+e,y:t.y-e}:{x:t.x-e,y:t.y-e}}if(o.state===A.POINT){if(s.state===A.POINT)return{x:t.x-e,y:t.y2+e};if(a.state===A.POINT)return{x:t.x-e,y:t.y-e}}let l=t.height*t.width,h=t.height*((s.x-t.x+(o.x-t.x))*.5);return h<.5*l?s.x>a.x?{x:t.x2+e,y:t.y2+e}:{x:t.x2+e,y:t.y-e}:s.x<a.x?{x:t.x-e,y:t.y2+e}:{x:t.x-e,y:t.y-e}}class st{constructor(t=[],e=!0){this.points=t,this.closed=e}get(t){let e=this.points.length;return t<0?this.closed?this.get(t+e):this.points[0]:t>=e?this.closed?this.get(t-e):this.points[e-1]:this.points[t]}get length(){return this.points.length}toString(t=1/0){let e=this.points;if(0===e.length)return"";let n="function"==typeof t?t:function(t){if(!Number.isFinite(t))return t=>t;if(0===t)return Math.round;let e=Math.pow(10,t);return t=>Math.round(t*e)/e}(t),i="M";for(let t of e)i+=`${n(t.x)},${n(t.y)} L`;return i=i.slice(0,-1),this.closed&&(i+=" Z"),i}draw(t){let e=this.points;if(0!==e.length){for(let n of(t.beginPath(),t.moveTo(e[0].x,e[0].y),e))t.lineTo(n.x,n.y);this.closed&&t.closePath()}}sample(t){return(function(t=8){return e=>{let n=t,i=e.length;if(n>1)for(i=Math.floor(e.length/n);i<3&&n>1;)n-=1,i=Math.floor(e.length/n);let s=[];for(let t=0,r=0;r<i;r++,t+=n)s.push(e.get(t));return new st(s)}})(t)(this)}simplify(t){return(function(t=0){return e=>{if(t<0||e.length<3)return e;let n=[],i=0,s=t*t;for(;i<e.length;){let t=i+1;for(;function(t,e,n,i){let s=t.closed?n<t.length:n<t.length-1;if(!s)return!1;let r=t.get(e),a=t.get(n+1);for(let s=e+1;s<=n;s++){let e=t.get(s),n=iY(r.x,r.y,a.x,a.y,e.x,e.y);if(n>i)return!1}return!0}(e,i,t,s);)t++;n.push(e.get(i)),i=t}return new st(n)}})(t)(this)}bSplines(t){return(function(t=6){function e(t,e,n){let i=0,s=0;for(let r=-2;r<=1;r++){let a=t.get(e+r),o=function(t,e){switch(t){case -2:return(((-e+3)*e-3)*e+1)/6;case -1:return((3*e-6)*e*e+4)/6;case 0:return(((-3*e+3)*e+3)*e+1)/6;case 1:return e*e*e/6;default:throw Error("unknown error")}}(r,n);i+=o*a.x,s+=o*a.y}return{x:i,y:s}}return n=>{if(n.length<3)return n;let i=[],s=n.closed,r=n.length+3-1+(s?0:2);i.push(e(n,2-(s?0:2),0));for(let a=2-(s?0:2);a<r;a++)for(let s=1;s<=t;s++)i.push(e(n,a,s/t));return new st(i)}})(t)(this)}apply(t){return t(this)}containsElements(t){let e=function(t){if(0===t.length)return null;let e=t[0],n=new i0(e.x,e.y,0,0);for(let e of t)n.addPoint(e);return n}(this.points);return!!e&&t.every(t=>e.containsPt(t.cx,t.cy)&&this.withinArea(t.cx,t.cy))}withinArea(t,e){if(0===this.length)return!1;let n=0,i=this.points[0],s=new iZ(i.x,i.y,i.x,i.y);for(let i=1;i<this.points.length;i++){let r=this.points[i];s.x1=s.x2,s.y1=s.y2,s.x2=r.x,s.y2=r.y,s.cuts(t,e)&&n++}return s.x1=s.x2,s.y1=s.y2,s.x2=i.x,s.y2=i.y,s.cuts(t,e)&&n++,n%2==1}}class se{constructor(t=0){this.count=0,this.arr=[],this.set=new Set,this.arr.length=t}add(t){this.set.add(`${t.x}x${t.y}`),this.arr[this.count++]=t}contains(t){return this.set.has(`${t.x}x${t.y}`)}isFirst(t){if(0===this.count)return!1;let e=this.arr[0];return null!=e&&e.x===t.x&&e.y===t.y}path(){return new st(this.arr.slice(0,this.count))}clear(){this.set.clear(),this.count=0}get(t){return this.arr[t]}get length(){return this.count}}let sn={maxRoutingIterations:100,maxMarchingIterations:20,pixelGroup:4,edgeR0:10,edgeR1:20,nodeR0:15,nodeR1:50,morphBuffer:10,threshold:1,memberInfluenceFactor:1,edgeInfluenceFactor:1,nonMemberInfluenceFactor:-.8,virtualEdges:!0};function si(t){return null!=t&&"number"==typeof t.radius}function ss(t,e){return si(t)===si(e)&&(si(t)?t.cx===e.cx&&t.cy===e.cy&&t.radius===e.radius:t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height)}(m=k||(k={}))[m.MEMBERS=0]="MEMBERS",m[m.NON_MEMBERS=1]="NON_MEMBERS",m[m.EDGES=2]="EDGES";class sr{constructor(t={}){this.dirty=new Set,this.members=[],this.nonMembers=[],this.virtualEdges=[],this.edges=[],this.activeRegion=new i0(0,0,0,0),this.potentialArea=new i2(1,0,0,0,0,0,0),this.o=Object.assign({},sn,t)}pushMember(...t){if(0!==t.length)for(let e of(this.dirty.add(k.MEMBERS),t))this.members.push({raw:e,obj:si(e)?i1.from(e):i0.from(e),area:null})}removeMember(t){let e=this.members.findIndex(e=>ss(e.raw,t));return!(e<0)&&(this.members.splice(e,1),this.dirty.add(k.MEMBERS),!0)}removeNonMember(t){let e=this.nonMembers.findIndex(e=>ss(e.raw,t));return!(e<0)&&(this.nonMembers.splice(e,1),this.dirty.add(k.NON_MEMBERS),!0)}removeEdge(t){let e=this.edges.findIndex(e=>e.obj.equals(t));return!(e<0)&&(this.edges.splice(e,1),this.dirty.add(k.NON_MEMBERS),!0)}pushNonMember(...t){if(0!==t.length)for(let e of(this.dirty.add(k.NON_MEMBERS),t))this.nonMembers.push({raw:e,obj:si(e)?i1.from(e):i0.from(e),area:null})}pushEdge(...t){if(0!==t.length)for(let e of(this.dirty.add(k.EDGES),t))this.edges.push({raw:e,obj:iZ.from(e),area:null})}update(){let t=this.dirty.has(k.MEMBERS),e=this.dirty.has(k.NON_MEMBERS),n=this.dirty.has(k.EDGES);this.dirty.clear();let i=this.members.map(t=>t.obj);if(this.o.virtualEdges&&(t||e)){let t=this.nonMembers.map(t=>t.obj),e=function(t,e,n,i){if(0===t.length)return[];let s=function(t){if(t.length<2)return t;let e=0,n=0;return t.forEach(t=>{e+=t.cx,n+=t.cy}),e/=t.length,n/=t.length,t.map(t=>{let i=e-t.cx,s=n-t.cy;return[t,i*i+s*s]}).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}(t);return s.map((t,r)=>{let a=s.slice(0,r);return function(t,e,n,i,s){let r;let a={x:e.cx,y:e.cy},o=(r=Number.POSITIVE_INFINITY,n.reduce((e,n)=>{let i=iU(a.x,a.y,n.cx,n.cy);if(i>r)return e;let s=new iZ(a.x,a.y,n.cx,n.cy),o=t.reduce((t,e)=>iQ(e,s)&&function(t,e){function n(t,n,i,s){let r=iq(e,new iZ(t,n,i,s));return(r=Math.abs(r-.5))>=0&&r<=1?1:0}let i=n(t.x,t.y,t.x2,t.y);return!!((i+=n(t.x,t.y,t.x,t.y2))>1||(i+=n(t.x,t.y2,t.x2,t.y2))>1)||(i+=n(t.x2,t.y,t.x2,t.y2))>0}(e,s)?t+1:t,0);return i*(o+1)*(o+1)<r&&(e=n,r=i*(o+1)*(o+1)),e},null));if(null==o)return[];let l=new iZ(a.x,a.y,o.cx,o.cy),h=function(t,e,n,i){let s=[],r=[];r.push(t);let a=!0;for(let t=0;t<n&&a;t++)for(a=!1;!a&&r.length>0;){let t=r.pop(),n=i5(e,t),o=n?function(t,e){let n=0,i=i$(t,new iZ(e.x,e.y,e.x2,e.y));n+=i.state===A.POINT?1:0;let s=i$(t,new iZ(e.x,e.y,e.x,e.y2));n+=s.state===A.POINT?1:0;let r=i$(t,new iZ(e.x,e.y2,e.x2,e.y2));n+=r.state===A.POINT?1:0;let a=i$(t,new iZ(e.x2,e.y,e.x2,e.y2));return{top:i,left:s,bottom:r,right:a,count:n+=a.state===A.POINT?1:0}}(t,n):null;if(!n||!o||2!==o.count){a||s.push(t);continue}let l=i,h=i7(n,l,o,!0),c=i9(h,r)||i9(h,s),d=i8(h,e);for(;!c&&d&&l>=1;)l/=1.5,c=i9(h=i7(n,l,o,!0),r)||i9(h,s),d=i8(h,e);if(!h||c||d||(r.push(new iZ(t.x1,t.y1,h.x,h.y)),r.push(new iZ(h.x,h.y,t.x2,t.y2)),a=!0),a)continue;let u=i9(h=i7(n,l=i,o,!1),r)||i9(h,s);for(d=i8(h,e);!u&&d&&l>=1;)l/=1.5,u=i9(h=i7(n,l,o,!1),r)||i9(h,s),d=i8(h,e);h&&!u&&(r.push(new iZ(t.x1,t.y1,h.x,h.y)),r.push(new iZ(h.x,h.y,t.x2,t.y2)),a=!0),a||s.push(t)}for(;r.length>0;)s.push(r.pop());return s}(l,t,i,s);return function(t,e){let n=[];for(;t.length>0;){let i=t.pop();if(0===t.length){n.push(i);break}let s=t.pop(),r=new iZ(i.x1,i.y1,s.x2,s.y2),a=i5(e,r);a?(n.push(i),t.push(s)):t.push(r)}return n}(h,t)}(e,t,a,n,i)}).flat()}(i,t,this.o.maxRoutingIterations,this.o.morphBuffer),s=new Map(this.virtualEdges.map(t=>[t.obj.toString(),t.area]));this.virtualEdges=e.map(t=>{var e;return{raw:t,obj:t,area:null!==(e=s.get(t.toString()))&&void 0!==e?e:null}}),n=!0}let s=!1;if(t||n){let t=this.virtualEdges.concat(this.edges).map(t=>t.obj),e=function(t,e){if(0===t.length)return new i0(0,0,0,0);let n=i0.from(t[0]);for(let e of t)n.add(e);for(let t of e)n.add(iK(t));return n}(i,t),n=Math.max(this.o.edgeR1,this.o.nodeR1)+this.o.morphBuffer,r=i0.from(i3(e,n));r.equals(this.activeRegion)||(s=!0,this.activeRegion=r)}if(s){let t=Math.ceil(this.activeRegion.width/this.o.pixelGroup),e=Math.ceil(this.activeRegion.height/this.o.pixelGroup);this.activeRegion.x!==this.potentialArea.pixelX||this.activeRegion.y!==this.potentialArea.pixelY?(this.potentialArea=i2.fromPixelRegion(this.activeRegion,this.o.pixelGroup),this.members.forEach(t=>t.area=null),this.nonMembers.forEach(t=>t.area=null),this.edges.forEach(t=>t.area=null),this.virtualEdges.forEach(t=>t.area=null)):(t!==this.potentialArea.width||e!==this.potentialArea.height)&&(this.potentialArea=i2.fromPixelRegion(this.activeRegion,this.o.pixelGroup))}let r=new Map,a=t=>{if(t.area){let e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof i0?"R":"C"}`;r.set(e,t.area)}},o=t=>{if(t.area)return;let e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof i0?"R":"C"}`;if(r.has(e)){let n=r.get(e);t.area=this.potentialArea.copy(n,{x:t.obj.x-this.o.nodeR1,y:t.obj.y-this.o.nodeR1});return}let n=t.obj instanceof i0?function(t,e,n){let i=e.scale(t),s=e.addPadding(i,n),r=e.createSub(s,{x:t.x-n,y:t.y-n}),a=i.x-s.x,o=i.y-s.y,l=s.x2-i.x2,h=s.y2-i.y2,c=s.width-a-l,d=s.height-o-h,u=n*n;r.fillArea({x:a,y:o,width:c+1,height:d+1},u);let p=[0],g=Math.max(o,a,l,h);{let s=e.invertScaleX(i.x+i.width/2);for(let r=1;r<g;r++){let a=e.invertScaleY(i.y-r),o=t.distSquare(s,a);if(o<u){let t=n-Math.sqrt(o);p.push(t*t)}else break}}let f=[],y=Math.max(a,l),m=Math.max(o,l);for(let s=1;s<y;s++){let r=e.invertScaleX(i.x-s),a=[];for(let s=1;s<m;s++){let o=e.invertScaleY(i.y-s),l=t.distSquare(r,o);if(l<u){let t=n-Math.sqrt(l);a.push(t*t)}else a.push(0)}f.push(a)}for(let t=1;t<Math.min(o,p.length);t++){let e=p[t];r.fillHorizontalLine(a,o-t,c+1,e)}for(let t=1;t<Math.min(h,p.length);t++){let e=p[t];r.fillHorizontalLine(a,o+d+t,c+1,e)}for(let t=1;t<Math.min(a,p.length);t++){let e=p[t];r.fillVerticalLine(a-t,o,d+1,e)}for(let t=1;t<Math.min(h,p.length);t++){let e=p[t];r.fillVerticalLine(a+c+t,o,d+1,e)}for(let t=1;t<a;t++){let e=f[t-1],n=a-t;for(let t=1;t<o;t++)r.set(n,o-t,e[t-1]);for(let t=1;t<h;t++)r.set(n,o+d+t,e[t-1])}for(let t=1;t<l;t++){let e=f[t-1],n=a+c+t;for(let t=1;t<o;t++)r.set(n,o-t,e[t-1]);for(let t=1;t<h;t++)r.set(n,o+d+t,e[t-1])}return r}(t.obj,this.potentialArea,this.o.nodeR1):i4(t.obj,this.potentialArea,this.o.nodeR1);t.area=n,r.set(e,n)};this.members.forEach(a),this.nonMembers.forEach(a),this.members.forEach(o),this.nonMembers.forEach(t=>{this.activeRegion.intersects(t.obj)?o(t):t.area=null}),this.edges.forEach(t=>{t.area||(t.area=i6(t.obj,this.potentialArea,this.o.edgeR1))}),this.virtualEdges.forEach(t=>{t.area||(t.area=i6(t.obj,this.potentialArea,this.o.edgeR1))})}drawMembers(t){for(let e of this.members)e.obj.draw(t)}drawNonMembers(t){for(let e of this.nonMembers)e.obj.draw(t)}drawEdges(t){for(let e of this.edges)e.obj.draw(t)}drawPotentialArea(t,e=!0){this.potentialArea.draw(t,e)}compute(){if(0===this.members.length)return new st([]);this.dirty.size>0&&this.update();let{o:t,potentialArea:e}=this,n=this.members.map(t=>t.area),i=this.virtualEdges.concat(this.edges).map(t=>t.area),s=this.nonMembers.filter(t=>null!=t.area).map(t=>t.area),r=this.members.map(t=>t.obj);return function(t,e,n,i,s,r={}){let a=Object.assign({},sn,r),o=a.threshold,l=a.memberInfluenceFactor,h=a.edgeInfluenceFactor,c=a.nonMemberInfluenceFactor,d=(a.nodeR0-a.nodeR1)*(a.nodeR0-a.nodeR1),u=(a.edgeR0-a.edgeR1)*(a.edgeR0-a.edgeR1);for(let r=0;r<a.maxMarchingIterations;r++){if(t.clear(),0!==l){let n=l/d;for(let i of e)t.incArea(i,n)}if(0!==h){let e=h/u;for(let i of n)t.incArea(i,e)}if(0!==c){let e=c/d;for(let n of i)t.incArea(n,e)}let p=function(t,e){let n=(Math.floor(t.width)+Math.floor(t.height))*2,i=new se(n);function s(n,i,s,r){let a=t.get(n,i);return Number.isNaN(a)?Number.NaN:a>e?s+r:s}function r(t,e){let n=0;return(n=s(t,e,0,1),n=s(t+1,e,n,2),n=s(t,e+1,n,4),Number.isNaN(n=s(t+1,e+1,n,8)))?-1:n}let a=1;for(let n=0;n<t.width;n++)for(let s=0;s<t.height;s++){if(t.get(n,s)<=e)continue;let o=r(n,s);if(!(o<0)&&15!==o&&function(e,n){let s=e,o=n,l=t.invertScaleX(s),h=t.invertScaleY(o);for(let e=0;e<t.width*t.height;e++){let e={x:l,y:h};if(i.contains(e)){if(i.isFirst(e))break}else i.add(e);let n=r(s,o);switch(n){case -1:return!0;case 0:case 3:case 2:case 7:a=2;break;case 12:case 14:case 4:a=3;break;case 6:a=0===a?3:2;break;case 1:case 13:case 5:a=0;break;case 9:a=2===a?0:1;break;case 10:case 8:case 11:a=1;break;default:return console.warn("Marching squares invalid state: "+n),!0}switch(a){case 0:o--,h-=t.pixelGroup;break;case 1:o++,h+=t.pixelGroup;break;case 3:s--,l-=t.pixelGroup;break;case 2:s++,l+=t.pixelGroup;break;default:return console.warn("Marching squares invalid state: "+n),!0}}return!0}(n,s))return i.path()}return null}(t,o);if(p&&s(p))return p;if(o*=.95,r<=.5*a.maxMarchingIterations)l*=1.2,h*=1.2;else if(0!==c&&i.length>0)c*=.8;else break}return new st([])}(e,n,i,s,t=>t.containsElements(r),t)}}class sa extends iV{bindEvents(){this.context.graph.on(O.AFTER_RENDER,this.drawBubbleSets),this.context.graph.on(O.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath)}init(){this.bubbleSets=new sr(this.options),this.members=new Map,this.avoidMembers=new Map}parseOptions(){let{type:t,key:e,members:n,avoidMembers:i,...s}=this.options,r=Object.keys(s).reduce((t,e)=>(e in sn?t.bubbleSetOptions[e]=s[e]:t.style[e]=s[e],t),{style:{},bubbleSetOptions:{}});return{type:t,key:e,members:n,avoidMembers:i,...r}}addMember(t){let e=Array.isArray(t)?t:[t];e.some(t=>this.options.avoidMembers.includes(t))&&(this.options.avoidMembers=this.options.avoidMembers.filter(t=>!e.includes(t))),this.options.members=[...new Set([...this.options.members,...e])],this.drawBubbleSets()}removeMember(t){let e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter(t=>!e.includes(t)),this.drawBubbleSets()}updateMember(t){this.options.members=tv(t)?t(this.options.members):t,this.drawBubbleSets()}getMember(){return this.options.members}addAvoidMember(t){let e=Array.isArray(t)?t:[t];e.some(t=>this.options.members.includes(t))&&(this.options.members=this.options.members.filter(t=>!e.includes(t))),this.options.avoidMembers=[...new Set([...this.options.avoidMembers,...e])],this.drawBubbleSets()}removeAvoidMember(t){let e=Array.isArray(t)?t:[t];this.options.avoidMembers.some(t=>e.includes(t))&&(this.options.avoidMembers=this.options.avoidMembers.filter(t=>!e.includes(t)),this.drawBubbleSets())}updateAvoidMember(t){this.options.avoidMembers=Array.isArray(t)?t:[t],this.drawBubbleSets()}getAvoidMember(){return this.options.avoidMembers}destroy(){this.context.graph.off(O.AFTER_RENDER,this.drawBubbleSets),this.context.graph.off(O.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath),this.shape.destroy(),super.destroy()}constructor(t,e){super(t,tr({},sa.defaultOptions,e)),this.members=new Map,this.avoidMembers=new Map,this.bubbleSetOptions={},this.drawBubbleSets=()=>{let{style:t,bubbleSetOptions:e}=this.parseOptions();W(this.bubbleSetOptions,e)||this.init(),this.bubbleSetOptions={...e};let n={...t,d:this.getPath()};this.shape?this.shape.update(n):(this.shape=new eG({style:n}),this.context.canvas.appendChild(this.shape))},this.updateBubbleSetsPath=t=>{if(!this.shape)return;let e=ta(t.data);[...this.options.members,...this.options.avoidMembers].includes(e)&&this.shape.update({...this.parseOptions().style,d:this.getPath(e)})},this.getPath=t=>{let{graph:e}=this.context,n=this.options.members,i=[...this.members.keys()],s=this.options.avoidMembers,r=[...this.avoidMembers.keys()];if(!t&&W(n,i)&&W(s,r))return this.path;let{enter:a=[],exit:o=[]}=tg(i,n,t=>t),{enter:l=[],exit:h=[]}=tg(r,s,t=>t);t&&(o.push(t),a.push(t));let c=(t,n,i)=>{t.forEach(t=>{let s=i?this.members:this.avoidMembers;if(n){let n;"edge"===e.getElementType(t)?([n]=sl(e,t),this.bubbleSets.pushEdge(n)):([n]=so(e,t),this.bubbleSets[i?"pushMember":"pushNonMember"](n)),s.set(t,n)}else{let n=s.get(t);n&&("edge"===e.getElementType(t)?this.bubbleSets.removeEdge(n):this.bubbleSets[i?"removeMember":"removeNonMember"](n),s.delete(t))}})};c(o,!1,!0),c(a,!0,!0),c(h,!1,!1),c(l,!0,!1);let d=this.bubbleSets.compute(),u=d.sample(8).simplify(0).bSplines().simplify(0);return this.path=eV(u.points.map(tq)),this.path},this.bindEvents(),this.bubbleSets=new sr(this.options)}}sa.defaultOptions={members:[],avoidMembers:[],fill:"lightblue",fillOpacity:.2,stroke:"blue",strokeOpacity:.2,...sn};let so=(t,e)=>{let n=Array.isArray(e)?e:[e];return n.map(e=>{let n=t.getElementRenderBounds(e);return new i0(n.min[0],n.min[1],tS(n),tC(n))})},sl=(t,e)=>{let n=Array.isArray(e)?e:[e];return n.map(e=>{let n=t.getEdgeData(e),i=t.getElementPosition(n.source),s=t.getElementPosition(n.target);return iZ.from({x1:i[0],y1:i[1],x2:s[0],y2:s[1]})})};class sh extends iV{initElement(){this.$element=iH("contextmenu",!1);let{className:t}=this.options;t&&this.$element.classList.add(t);let e=this.context.canvas.getContainer();e.appendChild(this.$element),iW("g6-contextmenu-css","style",{},"\n  .g6-contextmenu {\n    font-size: 12px;\n    background-color: rgba(255, 255, 255, 0.96);\n    border-radius: 4px;\n    overflow: hidden;\n    box-shadow: rgba(0, 0, 0, 0.12) 0px 6px 12px 0px;\n    transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s;\n  }\n\n  .g6-contextmenu-ul {\n    max-width: 256px;\n    min-width: 96px;\n    list-style: none;\n    padding: 0;\n    margin: 0;\n  }\n\n  .g6-contextmenu-li {\n    padding: 8px 12px;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .g6-contextmenu-li:hover {\n    background-color: #f5f5f5;\n    cursor: pointer;\n  }\n",document.head)}async show(t){let{enable:e,offset:n}=this.options;if("function"==typeof e&&!e(t)||!e){this.hide();return}let i=await this.getDOMContent(t);i instanceof HTMLElement?(this.$element.innerHTML="",this.$element.appendChild(i)):this.$element.innerHTML=i;let s=this.context.graph.getCanvas().getContainer().getBoundingClientRect();this.$element.style.left="".concat(t.client.x-s.left+n[0],"px"),this.$element.style.top="".concat(t.client.y-s.top+n[1],"px"),this.$element.style.display="block",this.targetElement=t.target}hide(){this.$element.style.display="none",this.targetElement=null}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy(),this.$element.remove()}async getDOMContent(t){let{getContent:e,getItems:n}=this.options;if(n){var i;return i=await n(t),'\n    <ul class="g6-contextmenu-ul">\n      '.concat(i.map(t=>'<li  class="g6-contextmenu-li" value="'.concat(t.value,'">').concat(t.name,"</li>")).join(""),"\n    </ul>\n  ")}return await e(t)}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.on("canvas:".concat(e),this.onTriggerEvent),t.on("node:".concat(e),this.onTriggerEvent),t.on("edge:".concat(e),this.onTriggerEvent),t.on("combo:".concat(e),this.onTriggerEvent),document.addEventListener("click",this.onMenuItemClick)}unbindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.off("canvas:".concat(e),this.onTriggerEvent),t.off("node:".concat(e),this.onTriggerEvent),t.off("edge:".concat(e),this.onTriggerEvent),t.off("combo:".concat(e),this.onTriggerEvent),document.removeEventListener("click",this.onMenuItemClick)}constructor(t,e){super(t,Object.assign({},sh.defaultOptions,e)),this.targetElement=null,this.onTriggerEvent=t=>{var e;null===(e=t.preventDefault)||void 0===e||e.call(t),this.show(t)},this.onMenuItemClick=t=>{let{onClick:e,trigger:n}=this.options;if(t.target instanceof HTMLElement&&t.target.className.includes("g6-contextmenu-li")){let n=t.target.getAttribute("value");null==e||e(n,t.target,this.targetElement),this.hide()}"click"!==n&&this.hide()},this.initElement(),this.update(e)}}sh.defaultOptions={trigger:"contextmenu",offset:[4,4],loadingContent:'<div class="g6-contextmenu-loading">Loading...</div>',getContent:()=>"It is a empty context menu.",enable:()=>!0};let sc={fill:"#fff",fillOpacity:1,lineWidth:1,stroke:"#000",strokeOpacity:.8};class sd extends iV{get canvas(){return this.context.canvas.getLayer("transient")}get isLensOn(){return this.lens&&!this.lens.destroyed}getElementStyle(t,e){let n="node"===t?this.options.nodeStyle:this.options.edgeStyle;return"function"==typeof n?n(e):n}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}bindEvents(){let{graph:t}=this.context,{trigger:e,scaleRByWheel:n}=this.options,i=t.getCanvas().getLayer();if(["click","drag"].includes(e)&&i.addEventListener(w.CLICK,this.onEdgeFilter),"pointermove"===e?i.addEventListener(w.POINTER_MOVE,this.onEdgeFilter):"drag"===e&&(i.addEventListener(w.DRAG_START,this.onDragStart),i.addEventListener(w.DRAG,this.onDrag),i.addEventListener(w.DRAG_END,this.onDragEnd)),n){var s;null===(s=this.graphDom)||void 0===s||s.addEventListener(w.WHEEL,this.scaleRByWheel,{passive:!1})}}unbindEvents(){let{graph:t}=this.context,{trigger:e,scaleRByWheel:n}=this.options,i=t.getCanvas().getLayer();if(["click","drag"].includes(e)&&i.removeEventListener(w.CLICK,this.onEdgeFilter),"pointermove"===e?i.removeEventListener(w.POINTER_MOVE,this.onEdgeFilter):"drag"===e&&(i.removeEventListener(w.DRAG_START,this.onDragStart),i.removeEventListener(w.DRAG,this.onDrag),i.removeEventListener(w.DRAG_END,this.onDragEnd)),n){var s;null===(s=this.graphDom)||void 0===s||s.removeEventListener(w.WHEEL,this.scaleRByWheel)}}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),this.isLensOn&&this.lens.destroy(),this.shapes.forEach((t,e)=>{t.destroy(),this.shapes.delete(e)}),super.destroy()}constructor(t,e){super(t,Object.assign({},sd.defaultOptions,e)),this.shapes=new Map,this.r=this.options.r,this.onEdgeFilter=t=>{if("drag"===this.options.trigger&&this.isLensOn)return;let e=tq(t.canvas);this.renderLens(e),this.renderFocusElements()},this.renderLens=t=>{let[e,n]=t,i={size:2*this.r,x:e,y:n};if(this.isLensOn)this.lens.update(i);else{let t=Object.assign({},sc,this.options.style,i);this.lens=new e0({style:t})}this.canvas.appendChild(this.lens)},this.getFilterData=()=>{let{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;let{nodes:i,edges:s,combos:r}=n;return{nodes:i.filter(e=>t(ta(e),"node")),edges:s.filter(e=>t(ta(e),"edge")),combos:r.filter(e=>t(ta(e),"combo"))}},this.getFocusElements=t=>{let{nodes:e,edges:n}=this.getFilterData(),i=e.filter(e=>tj(tX(e),t)<this.r),s=i.map(t=>ta(t)),r=n.filter(t=>{let{source:e,target:n}=t,i=s.includes(e),r=s.includes(n);switch(this.options.nodeType){case"both":return i&&r;case"either":return i!==r;case"source":return i&&!r;case"target":return!i&&r;default:return!1}});return{nodes:i,edges:r}},this.renderFocusElements=()=>{let{element:t,graph:e}=this.context;if(!this.isLensOn)return;let n=this.lens.getCenter(),{nodes:i,edges:s}=this.getFocusElements(n),r=new Set,{nodeStyle:a,edgeStyle:o}=this.options,l=n=>{let i=ta(n);r.add(i);let s=t.getElement(i);if(!s)return;let a=this.shapes.get(i)||s.cloneNode();a.setPosition(s.getPosition()),a.id=s.id,this.shapes.has(i)?Object.entries(s.attributes).forEach(t=>{let[e,n]=t;a.style[e]!==n&&(a.style[e]=n)}):(this.canvas.appendChild(a),this.shapes.set(i,a));let o=e.getElementType(i),l=this.getElementStyle(o,n);a.update(l)};i.forEach(l),s.forEach(l),this.shapes.forEach((t,e)=>{r.has(e)||(t.destroy(),this.shapes.delete(e))})},this.scaleRByWheel=t=>{var e;this.options.preventDefault&&t.preventDefault();let{clientX:n,clientY:i,deltaX:s,deltaY:r}=t,{graph:a,canvas:o}=this.context,l=a.getCanvasByClient([n,i]),h=null===(e=this.lens)||void 0===e?void 0:e.getCenter();if(!this.isLensOn||tj(l,h)>this.r)return;let{maxR:c,minR:d}=this.options,u=Math.min(...o.getSize())/2;this.r=Math.max(d||0,Math.min(c||u,this.r*(s+r>0?1/.95:.95))),this.renderLens(h),this.renderFocusElements()},this.isLensDragging=!1,this.onDragStart=t=>{var e;let n=tq(t.canvas),i=null===(e=this.lens)||void 0===e?void 0:e.getCenter();!this.isLensOn||tj(n,i)>this.r||(this.isLensDragging=!0)},this.onDrag=t=>{if(!this.isLensDragging)return;let e=tq(t.canvas);this.renderLens(e),this.renderFocusElements()},this.onDragEnd=()=>{this.isLensDragging=!1},this.bindEvents()}}sd.defaultOptions={trigger:"pointermove",r:60,nodeType:"both",filter:()=>!0,style:{lineWidth:2},nodeStyle:{label:!1},edgeStyle:{label:!0},scaleRByWheel:!0,preventDefault:!0};class su extends iV{bindEvents(){this.unbindEvents(),this.shortcut.unbindAll();let{request:t=[],exit:e=[]}=this.options.trigger;this.shortcut.bind(t,this.request),this.shortcut.bind(e,this.exit),["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach(t=>{document.addEventListener(t,this.onFullscreenChange,!1)})}unbindEvents(){this.shortcut.unbindAll(),["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach(t=>{document.removeEventListener(t,this.onFullscreenChange,!1)})}setGraphSize(){let t,e,n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];n?(t=window.screen.width,e=window.screen.height,this.graphSize=this.context.graph.getSize()):[t,e]=this.graphSize,this.context.graph.setSize(t,e),this.context.graph.render()}request(){!document.fullscreenElement&&(document.fullscreenEnabled||Reflect.get(document,"webkitFullscreenEnabled")||Reflect.get(document,"mozFullscreenEnabled")||Reflect.get(document,"msFullscreenEnabled"))&&this.$el.requestFullscreen().catch(t=>{q.warn("Error attempting to enable full-screen: ".concat(t.message," (").concat(t.name,")"))})}exit(){document.fullscreenElement&&document.exitFullscreen()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.exit(),this.style.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},su.defaultOptions,e)),this.$el=this.context.canvas.getContainer(),this.graphSize=[0,0],this.onFullscreenChange=()=>{var t,e,n,i;let s=!!document.fullscreenElement;this.options.autoFit&&this.setGraphSize(s),s?null===(e=(t=this.options).onEnter)||void 0===e||e.call(t):null===(i=(n=this.options).onExit)||void 0===i||i.call(n)},this.shortcut=new t9(t.graph),this.bindEvents(),this.style=document.createElement("style"),document.head.appendChild(this.style),this.style.innerHTML="\n      :not(:root):fullscreen::backdrop {\n        background: transparent;\n      }\n    "}}su.defaultOptions={trigger:{},autoFit:!0};class sp extends iV{update(t){super.update(t),this.updateStyle()}bindEvents(){let{graph:t}=this.context;t.on(O.AFTER_TRANSFORM,this.onTransform)}updateStyle(){let{size:t,stroke:e,lineWidth:n,border:i,borderLineWidth:s,borderStroke:r,borderStyle:a}=this.options;Object.assign(this.$element.style,{border:i?"".concat(s,"px ").concat(a," ").concat(r):"none",backgroundImage:"linear-gradient(".concat(e," ").concat(n,"px, transparent ").concat(n,"px), linear-gradient(90deg, ").concat(e," ").concat(n,"px, transparent ").concat(n,"px)"),backgroundSize:"".concat(t,"px ").concat(t,"px")})}updateOffset(t){var e,n;this.offset=(e=tL(this.offset,t),n=this.options.size,e.map(t=>t%n)),this.$element.style.backgroundPosition="".concat(this.offset[0],"px ").concat(this.offset[1],"px")}destroy(){this.context.graph.off(O.AFTER_TRANSFORM,this.onTransform),this.$element.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},sp.defaultOptions,e)),this.$element=iH("grid-line"),this.offset=[0,0],this.onTransform=t=>{if(!this.options.follow)return;let{data:{translate:e}}=t;e&&this.updateOffset(e)};let n=this.context.canvas.getContainer();!function(t,e){let n=t.firstChild;n?t.insertBefore(e,n):t.appendChild(e)}(n,this.$element),this.updateStyle(),this.bindEvents()}}sp.defaultOptions={border:!0,borderLineWidth:1,borderStroke:"#eee",borderStyle:"solid",lineWidth:1,size:20,stroke:"#eee"};var sg=n(90494);function sf(t){let e={Added:new Map,Updated:new Map,Removed:new Map};return t.forEach(t=>{let{type:n,value:i}=t,s=ta(i);if("NodeAdded"===n||"EdgeAdded"===n||"ComboAdded"===n)e.Added.set(s,t);else if("NodeUpdated"===n||"EdgeUpdated"===n||"ComboUpdated"===n){if(e.Added.has(s))e.Added.set(s,{type:n.replace("Updated","Added"),value:i});else if(e.Updated.has(s)){let{original:t}=e.Updated.get(s);e.Updated.set(s,{type:n,value:i,original:t})}else e.Removed.has(s)||e.Updated.set(s,t)}else("NodeRemoved"===n||"EdgeRemoved"===n||"ComboRemoved"===n)&&(e.Added.has(s)?e.Added.delete(s):(e.Updated.has(s)&&e.Updated.delete(s),e.Removed.set(s,t)))}),[...Array.from(e.Added.values()),...Array.from(e.Updated.values()),...Array.from(e.Removed.values())]}function sy(t){let{NodeAdded:e=[],NodeUpdated:n=[],NodeRemoved:i=[],EdgeAdded:s=[],EdgeUpdated:r=[],EdgeRemoved:a=[],ComboAdded:o=[],ComboUpdated:l=[],ComboRemoved:h=[]}=eD(t,t=>t.type);return{add:{nodes:e,edges:s,combos:o},update:{nodes:n,edges:r,combos:l},remove:{nodes:i,edges:a,combos:h}}}class sm extends iV{canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){let t=this.undoStack.pop();if(t){var e,n,i,s;this.executeCommand(t);let r=null===(n=(e=this.options).beforeAddCommand)||void 0===n?void 0:n.call(e,t,!1);if(!1===r)return;this.redoStack.push(t),null===(s=(i=this.options).afterAddCommand)||void 0===s||s.call(i,t,!1),this.notify(D.UNDO,t)}return this}redo(){let t=this.redoStack.pop();return t&&(this.executeCommand(t,!1),this.undoStackPush(t),this.notify(D.REDO,t)),this}undoAndCancel(){let t=this.undoStack.pop();return t&&(this.executeCommand(t,!1),this.redoStack=[],this.notify(D.CANCEL,t)),this}undoStackPush(t){var e,n,i,s;let{stackSize:r}=this.options;0!==r&&this.undoStack.length>=r&&this.undoStack.shift();let a=null===(n=(e=this.options).beforeAddCommand)||void 0===n?void 0:n.call(e,t,!0);!1!==a&&(this.undoStack.push(t),null===(s=(i=this.options).afterAddCommand)||void 0===s||s.call(i,t,!0))}clear(){this.undoStack=[],this.redoStack=[],this.batchChanges=null,this.batchAnimation=!1,this.notify(D.CLEAR,null)}notify(t,e){this.emitter.emit(t,{cmd:e}),this.emitter.emit(D.CHANGE,{cmd:e})}on(t,e){this.emitter.on(t,e)}destroy(){let{graph:t}=this.context;t.off(O.AFTER_DRAW,this.addCommand),t.off(O.BATCH_START,this.initBatchCommand),t.off(O.BATCH_END,this.addCommand),this.emitter.off(),super.destroy(),this.undoStack=[],this.redoStack=[]}constructor(t,e){var n;super(t,Object.assign({},sm.defaultOptions,e)),n=this,this.batchChanges=null,this.batchAnimation=!1,this.undoStack=[],this.redoStack=[],this.freezed=!1,this.executeCommand=function(t){var e,i,s;let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];n.freezed=!0,null===(i=(e=n.options).executeCommand)||void 0===i||i.call(e,t);let a=r?t.original:t.current;n.context.graph.addData(a.add),n.context.graph.updateData(a.update),n.context.graph.removeData(to(a.remove,!1)),null===(s=n.context.element)||void 0===s||s.draw({silence:!0,animation:t.animation}),n.freezed=!1},this.addCommand=t=>{if(!this.freezed){if(t.type===O.AFTER_DRAW){var e;let{dataChanges:n=[],animation:i=!0}=t.data;if(null===(e=this.context.batch)||void 0===e?void 0:e.isBatching){if(!this.batchChanges)return;this.batchChanges.push(n),this.batchAnimation&&(this.batchAnimation=i);return}this.batchChanges=[n],this.batchAnimation=i}this.undoStackPush(function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i={animation:e,current:{add:{},update:{},remove:{}},original:{add:{},update:{},remove:{}}},{add:s,update:r,remove:a}=sy(sf(t));return["nodes","edges","combos"].forEach(t=>{r[t]&&r[t].forEach(e=>{var s,r;let a={...e.value},o={...e.original};if(n){let t=n.graph.getElementType(ta(e.original)),i="edge"===t?"stroke":"fill",s=n.element.getElementComputedStyle(t,e.original);o={...e.original,style:{[i]:s[i],...e.original.style}}}(function t(e,n){for(let i in e)V(e[i])&&!Array.isArray(e[i])&&null!==e[i]?(n[i]||(n[i]={}),t(e[i],n[i])):void 0===n[i]&&(n[i]=te(i))})(a,o),(s=i.current.update)[t]||(s[t]=[]),i.current.update[t].push(a),(r=i.original.update)[t]||(r[t]=[]),i.original.update[t].push(o)}),s[t]&&s[t].forEach(e=>{var n,s;let r={...e.value};(n=i.current.add)[t]||(n[t]=[]),i.current.add[t].push(r),(s=i.original.remove)[t]||(s[t]=[]),i.original.remove[t].push(r)}),a[t]&&a[t].forEach(e=>{var n,s;let r={...e.value};(n=i.current.remove)[t]||(n[t]=[]),i.current.remove[t].push(r),(s=i.original.add)[t]||(s[t]=[]),i.original.add[t].push(r)})}),i}(this.batchChanges.flat(),this.batchAnimation,this.context)),this.notify(D.ADD,this.undoStack[this.undoStack.length-1])}},this.initBatchCommand=t=>{let{initiate:e}=t.data;if(this.batchAnimation=!1,e)this.batchChanges=[];else{let t=this.undoStack.pop();t||(this.batchChanges=null)}},this.emitter=new sg.Z;let{graph:i}=this.context;i.on(O.AFTER_DRAW,this.addCommand),i.on(O.BATCH_START,this.initBatchCommand),i.on(O.BATCH_END,this.addCommand)}}sm.defaultOptions={stackSize:0};var sv=n(1344),sb=n.n(sv);let sE=(t,e,n)=>{if("sharp"===n)return[["M",t[0]-e,t[1]-e],["L",t[0]+e,t[1]-e],["L",t[0]+e,t[1]+e],["L",t[0]-e,t[1]+e],["Z"]];let i=[e,e,0,0,0];return[["M",t[0],t[1]-e],["A",...i,t[0],t[1]+e],["A",...i,t[0],t[1]-e]]},sx=(t,e,n)=>{let i=[e,e,0,0,0],s="sharp"===n?tL(t[0],tF(tH(tI(t[0],t[1])),e)):t[0],r="sharp"===n?tL(t[1],tF(tH(tI(t[1],t[0])),e)):t[1],a=tF(tH(tV(tI(s,r),!1)),e),o=tF(a,-1),l=tL(s,a),h=tL(r,a),c=tL(r,o),d=tL(s,o);return"sharp"===n?[["M",l[0],l[1]],["L",h[0],h[1]],["L",c[0],c[1]],["L",d[0],d[1]],["Z"]]:[["M",l[0],l[1]],["L",h[0],h[1]],["A",...i,c[0],c[1]],["L",d[0],d[1]],["A",...i,l[0],l[1]]]},sw=(t,e)=>{let n=t6(t).map((n,i)=>{let s=(i-2+t.length)%t.length,r=(i-1+t.length)%t.length,a=(i+1)%t.length,o=t[s],l=t[r],h=t[a],c=tI(o,l),d=tI(l,n),u=tI(n,h),p=(t,e)=>tW(t,e,!0)<Math.PI,g=p(c,d),f=p(d,u),y=t=>tF(tH(tV(t,!1)),e),m=y(d);return[{p:tG(g?tL(l,y(c)):tL(l,m)),concave:g&&l},{p:tG(f?tL(n,y(u)):tL(n,m)),concave:f&&n}]}),i=[e,e,0,0,0],s=n.findIndex((t,e)=>!n[(e-1+n.length)%n.length][0].concave&&!n[(e-1+n.length)%n.length][1].concave&&!t[0].concave&&!t[0].concave&&!t[1].concave),r=n.slice(s).concat(n.slice(0,s)),a=[];return r.flatMap((t,e)=>{let s=[],o=r[n.length-1];return 0===e&&s.push(["M",...o[1].p]),t[0].concave?a.push(t[0].p,t[1].p):s.push(["A",...i,...t[0].p]),t[1].concave?a.unshift(t[1].p):s.push(["L",...t[1].p]),3===a.length&&(s.pop(),s.push(["C",...a.flat()]),a=[]),s})},sS=(t,e)=>{let n=t6(t).map((e,n)=>{let i=t[(n+1)%t.length];return{p:e,v:tH(tI(i,e))}});return n.forEach((i,s)=>{let r=s>0?s-1:t.length-1,a=n[r].v,o=tH(tL(a,tF(i.v,tW(a,i.v,!0)<Math.PI?1:-1)));i.p=tL(i.p,tF(o,e))}),eV(n.map(t=>t.p))},sC=(t,e)=>{let n=t.map((n,i)=>{let s=t[0===i?t.length-1:i-1],r=tY(tF(tH(tV(tI(s,n),!1)),e));return[tL(s,r),tL(n,r)]}),i=n.flat(),s=i.map((t,e)=>{if(e%2==0)return null;let n=[i[(e-1)%i.length],i[e%i.length]],s=[i[(e+1)%i.length],i[(e+2)%i.length]];return tK(n,s,!0)}).filter(Boolean);return s.map((t,e)=>[0===e?"M":"L",t[0],t[1]]).concat([["Z"]])};class sO extends iV{bindEvents(){this.context.graph.on(O.AFTER_RENDER,this.drawHull),this.context.graph.on(O.AFTER_ELEMENT_UPDATE,this.updateHullPath)}getHullStyle(t){let{members:e,padding:n,corner:i,...s}=this.options;return{...s,d:this.getHullPath(t)}}getPadding(){let{graph:t}=this.context,e=this.hullMemberIds.reduce((e,n)=>{let{halfExtents:i}=t.getElementRenderBounds(n),s=Math.max(i[0],i[1]);return Math.max(e,s)},0);return e+this.options.padding}addMember(t){let e=Array.isArray(t)?t:[t];this.options.members=[...new Set([...this.options.members,...e])],this.shape.update({d:this.getHullPath()})}removeMember(t){let e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter(t=>!e.includes(t)),e.some(t=>this.hullMemberIds.includes(t))&&this.shape.update({d:this.getHullPath()})}updateMember(t){this.options.members=tv(t)?t(this.options.members):t,this.shape.update(this.getHullStyle(!0))}getMember(){return this.options.members}destroy(){this.context.graph.off(O.AFTER_DRAW,this.drawHull),this.shape.destroy(),this.hullMemberIds=[],super.destroy()}constructor(t,e){var n;super(t,Object.assign({},sO.defaultOptions,e)),n=this,this.hullMemberIds=[],this.drawHull=()=>{if(this.shape){let t=!W(this.optionsCache,this.options);this.shape.update(this.getHullStyle(t))}else this.shape=new eG({style:this.getHullStyle()}),this.context.canvas.appendChild(this.shape);this.optionsCache={...this.options}},this.updateHullPath=t=>{this.shape&&this.options.members.includes(ta(t.data))&&this.shape.update({d:this.getHullPath(!0)})},this.getHullPath=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{graph:e}=n.context,i=n.getMember();if(0===i.length)return"";let s=i.map(t=>e.getNodeData(t)),r=sb()(s.map(tX),n.options.concavity).slice(1).reverse(),a=r.flatMap(t=>s.filter(e=>W(tX(e),t)).map(ta));return W(a,n.hullMemberIds)&&!t||(n.hullMemberIds=a,n.path=function(t,e,n){if(1===t.length)return sE(t[0],e,n);if(2===t.length)return sx(t,e,n);switch(n){case"smooth":return sS(t,e);case"sharp":return sC(t,e);default:return sw(t,e)}}(r,n.getPadding(),n.options.corner)),n.path},this.bindEvents()}}sO.defaultOptions={members:[],padding:10,corner:"rounded",concavity:1/0,fill:"lightblue",fillOpacity:.2,labelOpacity:1,stroke:"blue",strokeOpacity:.2};var sD=n(64493),sT=n(29392);class sM extends iV{update(t){super.update(t),this.clear(),this.createElement()}clear(){var t;null===(t=this.element)||void 0===t||t.destroy(),this.element=null,this.draw=!1}updateElement(){if(!this.element)return;let t=this.element.getChildByIndex(0);t.update({itemMarkerOpacity:t=>{let{id:e}=t;return!this.selectedItems.length||this.selectedItems.includes(e)?1:.5},itemLabelOpacity:t=>{let{id:e}=t;return!this.selectedItems.length||this.selectedItems.includes(e)?1:.5}})}destroy(){this.clear(),this.context.graph.off(O.AFTER_DRAW,this.createElement),super.destroy()}constructor(t,e){super(t,Object.assign({},sM.defaultOptions,e)),this.typePrefix="__data__",this.element=null,this.draw=!1,this.fieldMap={node:new Map,edge:new Map,combo:new Map},this.selectedItems=[],this.bindEvents=()=>{let{graph:t}=this.context;t.on(O.AFTER_DRAW,this.createElement)},this.changeState=(t,e)=>{let{graph:n}=this.context,{typePrefix:i}=this,s=eo(t,[i,"id"]),r=eo(t,[i,"style","labelText"]),[a]=s.split("__"),o=this.fieldMap[a].get(r)||[];n.setElementState(Object.fromEntries(null==o?void 0:o.map(t=>[t,e])))},this.click=t=>{if("hover"===this.options.trigger)return;let e=eo(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?(this.selectedItems=this.selectedItems.filter(t=>t!==e),this.changeState(t,[])):(this.selectedItems.push(e),this.changeState(t,"selected"))},this.mouseleave=t=>{"click"!==this.options.trigger&&(this.selectedItems=[],this.changeState(t,[]))},this.mouseenter=t=>{if("click"===this.options.trigger)return;let e=eo(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?this.selectedItems=this.selectedItems.filter(t=>t!==e):(this.selectedItems.push(e),this.changeState(t,"active"))},this.setFieldMap=(t,e,n)=>{if(!t)return;let i=this.fieldMap[n];if(i){if(i.has(t)){let n=i.get(t);n&&(n.push(e),i.set(t,n))}else i.set(t,[e])}},this.getEvents=()=>({mouseenter:this.mouseenter,mouseleave:this.mouseleave,click:this.click}),this.getMarkerData=(t,e)=>{if(!t)return[];let{model:n,element:i,graph:s}=this.context,{nodes:r,edges:a,combos:o}=n.getData(),l={},h=e=>tv(t)?t(e):t,c={node:"circle",edge:"line",combo:"rect"},d={circle:"circle",ellipse:"circle",image:"bowtie",rect:"square",star:"cross",triangle:"triangle",diamond:"diamond",cubic:"dot",line:"hyphen",polyline:"hyphen",quadratic:"hv","cubic-horizontal":"hyphen","cubic-vertical":"line"},u=(t,e)=>{let n=null==i?void 0:i.getElementComputedStyle(t,e);return n},p=(t,e)=>{t.forEach(t=>{let{id:n}=t,s=eo(t,["data",h(t)]),r=(null==i?void 0:i.getElementType(e,t))||"circle",a=u(e,t),o=("edge"===e?null==a?void 0:a.stroke:null==a?void 0:a.fill)||"#1783ff";n&&s&&s.replace(/\s+/g,"")&&(this.setFieldMap(s,n,e),l[s]||(l[s]={id:"".concat(e,"__").concat(n),label:s,marker:d[r]||c[e],elementType:e,lineWidth:1,stroke:o,fill:o}))})};switch(e){case"node":p(r,"node");break;case"edge":p(a,"edge");break;case"combo":p(o,"combo");break;default:return[]}return Object.values(l)},this.layout=t=>{let{flexDirection:e,alignItems:n,justifyContent:i}={flexDirection:"row",alignItems:"flex-end",justifyContent:"center"},s={top:["row","flex-start","center"],bottom:["row","flex-end","center"],left:["column","flex-start","center"],right:["column","flex-end","center"]};return t in s&&([e,n,i]=s[t]),{display:"flex",flexDirection:e,justifyContent:i,alignItems:n}},this.createElement=()=>{if(this.draw){this.updateElement();return}let{canvas:t}=this.context,[e,n]=t.getSize(),{width:i=e,height:s=n,nodeField:r,edgeField:a,comboField:o,trigger:l,position:h,...c}=this.options,d=this.getMarkerData(r,"node"),u=this.getMarkerData(a,"edge"),p=this.getMarkerData(o,"combo"),g=[...d,...p,...u],f=this.layout(h),y=new sD.A({style:{width:i,height:s,...f}}),m=Object.assign({width:i,height:s,data:g,itemMarkerLineWidth:t=>{let{lineWidth:e}=t;return e},itemMarker:t=>{let{marker:e}=t;return e},itemMarkerStroke:t=>{let{stroke:e}=t;return e},itemMarkerFill:t=>{let{fill:e}=t;return e},gridCol:d.length},c,this.getEvents()),v=new sT.W({className:"legend",style:m});y.appendChild(v),t.appendChild(y),this.element=y,this.draw=!0},this.bindEvents()}}sM.defaultOptions={position:"bottom",trigger:"hover",orientation:"horizontal",layout:"flex",itemSpacing:4,rowPadding:10,colPadding:10,itemMarkerSize:16,itemLabelFontSize:16};var sA=n(74736),sR=function(t,e,n){var i,s,r,a,o=0;n||(n={});var l=function(){o=!1===n.leading?0:Date.now(),i=null,a=t.apply(s,r),i||(s=r=null)},h=function(){var h=Date.now();o||!1!==n.leading||(o=h);var c=e-(h-o);return s=this,r=arguments,c<=0||c>e?(i&&(clearTimeout(i),i=null),o=h,a=t.apply(s,r),i||(s=r=null)):i||!1===n.trailing||(i=setTimeout(l,c)),a};return h.cancel=function(){clearTimeout(i),o=0,i=s=r=null},h};class sk extends iV{bindEvents(){let{graph:t}=this.context;t.on(O.AFTER_DRAW,this.onDraw),t.on(O.AFTER_RENDER,this.onRender),t.on(O.AFTER_TRANSFORM,this.onTransform)}unbindEvents(){let{graph:t}=this.context;t.off(O.AFTER_DRAW,this.onDraw),t.off(O.AFTER_RENDER,this.onRender),t.off(O.AFTER_TRANSFORM,this.onTransform)}renderMinimap(){let t=this.getElements(),e=this.initCanvas();this.setShapes(e,t)}getElements(){let{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;let{nodes:i,edges:s,combos:r}=n;return{nodes:i.filter(e=>t(ta(e),"node")),edges:s.filter(e=>t(ta(e),"edge")),combos:r.filter(e=>t(ta(e),"combo"))}}setShapes(t,e){let{nodes:n,edges:i,combos:s}=e,{shape:r}=this.options,{element:a}=this.context;if("key"===r){let e=new Set,r=n=>{let i=ta(n);e.add(i);let s=a.getElement(i);if(!s)return;let r=s.getShape("key"),o=this.shapes.get(i)||r.cloneNode();o.setPosition(r.getPosition()),s.style.zIndex&&(o.style.zIndex=s.style.zIndex),o.id=s.id,this.shapes.has(i)?Object.entries(r.attributes).forEach(t=>{let[e,n]=t;o.style[e]!==n&&(o.style[e]=n)}):(t.appendChild(o),this.shapes.set(i,o))};i.forEach(r),s.forEach(r),n.forEach(r),this.shapes.forEach((n,i)=>{e.has(i)||(t.removeChild(n),this.shapes.delete(i))});return}let o=(t,e)=>{let n=a.getElement(t),i=n.getPosition();return e.setPosition(i),e};t.removeChildren(),i.forEach(e=>t.appendChild(r(ta(e),"edge"))),s.forEach(e=>{t.appendChild(o(ta(e),r(ta(e),"combo")))}),n.forEach(e=>{t.appendChild(o(ta(e),r(ta(e),"node")))})}calculatePosition(){let{position:t,size:[e,n]}=this.options,{canvas:i}=this.context,[s,r]=i.getSize(),[a,o]=tZ(t);return[a*(s-e),o*(r-n)]}createContainer(){let{container:t,className:e,size:[n,i],containerStyle:s}=this.options;if(t)return"string"==typeof t?document.querySelector(t):t;let r=document.createElement("div");r.classList.add("g6-minimap"),e&&r.classList.add(e);let[a,o]=this.calculatePosition();return Object.assign(r.style,{position:"absolute",left:a+"px",top:o+"px",width:n+"px",height:i+"px",...s}),this.context.canvas.getContainer().appendChild(r)}initCanvas(){let{renderer:t,size:[e,n]}=this.options;if(this.canvas)this.canvas.resize(e,n),t&&this.canvas.setRenderer(t);else{let i=document.createElement("div"),s=this.createContainer();this.container=s,s.appendChild(i),this.canvas=new N.Xz({width:e,height:n,container:i,renderer:t||new sA.Th})}return this.setCamera(),this.canvas}createLandmark(t,e,n){let i="".concat(t.join(","),"-").concat(e.join(","),"-").concat(n);if(this.landmarkMap.has(i))return this.landmarkMap.get(i);let s=this.canvas.getCamera(),r=s.createLandmark(i,{position:t,focalPoint:e,zoom:n});return this.landmarkMap.set(i,r),r}setCamera(){var t;let{canvas:e}=this.context,n=null===(t=this.canvas)||void 0===t?void 0:t.getCamera();if(!n)return;let{size:[i,s],padding:r}=this.options,[a,o,l,h]=tw(r),{min:c,max:d,center:u}=e.getBounds("elements"),p=d[0]-c[0],g=d[1]-c[1],f=this.createLandmark(u,u,Math.min((i-h-o)/p,(s-a-l)/g));n.gotoLandmark(f,0)}get maskBBox(){let{canvas:t}=this.context,e=t.getSize(),n=t.getCanvasByViewport([0,0]),i=t.getCanvasByViewport(e),s=this.canvas.canvas2Viewport(tJ(n)),r=this.canvas.canvas2Viewport(tJ(i)),a=r.x-s.x,o=r.y-s.y;return[s.x,s.y,a,o]}calculateMaskBBox(){let{size:[t,e]}=this.options,[n,i,s,r]=this.maskBBox;return n<0&&(s=sP(s+n,t),n=0),i<0&&(r=sP(r+i,e),i=0),n+s>t&&(s=sN(t-n,0)),i+r>e&&(r=sN(e-i,0)),[sP(n,t),sP(i,e),sN(s,0),sN(r,0)]}renderMask(){let{maskStyle:t}=this.options;this.mask||(this.mask=document.createElement("div"),this.mask.addEventListener("pointerdown",this.onMaskDragStart)),this.container.appendChild(this.mask),Object.assign(this.mask.style,{...t,cursor:"move",position:"absolute",pointerEvents:"auto"}),this.updateMask()}updateMask(){if(!this.mask)return;let[t,e,n,i]=this.calculateMaskBBox();Object.assign(this.mask.style,{top:e+"px",left:t+"px",width:n+"px",height:i+"px"})}destroy(){var t;this.unbindEvents(),this.canvas.destroy(),null===(t=this.mask)||void 0===t||t.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},sk.defaultOptions,e)),this.onDraw=t=>{var e;null!=t&&null!==(e=t.data)&&void 0!==e&&e.render||this.onRender()},this.onRender=sR(()=>{this.renderMinimap(),this.renderMask()},32,{leading:!0}),this.shapes=new Map,this.landmarkMap=new Map,this.mask=null,this.isMaskDragging=!1,this.onMaskDragStart=t=>{this.mask&&(this.isMaskDragging=!0,this.mask.setPointerCapture(t.pointerId),this.mask.addEventListener("pointermove",this.onMaskDrag),this.mask.addEventListener("pointerup",this.onMaskDragEnd),this.mask.addEventListener("pointercancel",this.onMaskDragEnd))},this.onMaskDrag=t=>{if(!this.mask||!this.isMaskDragging)return;let{size:[e,n]}=this.options,{movementX:i,movementY:s}=t,{left:r,top:a,width:o,height:l}=this.mask.style,[,,h,c]=this.maskBBox,d=parseInt(r)+i,u=parseInt(a)+s,p=parseInt(o),g=parseInt(l);d<0&&(d=0),u<0&&(u=0),d+p>e&&(d=sN(e-p,0)),u+g>n&&(u=sN(n-g,0)),p<h&&(i>0?(d=sN(d-i,0),p=sP(p+i,e)):i<0&&(p=sP(p-i,e))),g<c&&(s>0?(u=sN(u-s,0),g=sP(g+s,n)):s<0&&(g=sP(g-s,n))),Object.assign(this.mask.style,{left:d+"px",top:u+"px",width:p+"px",height:g+"px"});let f=parseInt(r)-d,y=parseInt(a)-u;if(0===f&&0===y)return;let m=this.context.canvas.getCamera().getZoom(),v=this.canvas.getCamera().getZoom(),b=m/v;this.context.graph.translateBy([f*b,y*b],!1)},this.onMaskDragEnd=t=>{this.mask&&(this.isMaskDragging=!1,this.mask.releasePointerCapture(t.pointerId),this.mask.removeEventListener("pointermove",this.onMaskDrag),this.mask.removeEventListener("pointerup",this.onMaskDragEnd),this.mask.removeEventListener("pointercancel",this.onMaskDragEnd))},this.onTransform=sR(()=>{this.isMaskDragging||(this.updateMask(),this.setCamera())},32,{leading:!0}),this.bindEvents()}}sk.defaultOptions={size:[240,160],shape:"key",padding:10,position:"right-bottom",maskStyle:{border:"1px solid #ddd",background:"rgba(0, 0, 0, 0.1)"},containerStyle:{border:"1px solid #ddd",background:"#fff"}};let sP=(t,e)=>Math.min(t,e),sN=(t,e)=>Math.max(t,e),sL={x1:0,y1:0,x2:0,y2:0,visibility:"hidden"};class sI extends iV{getNodes(){var t;let{filter:e}=this.options,n=(null===(t=this.context.element)||void 0===t?void 0:t.getNodes())||[],i=n.filter(t=>{var e;return"hidden"!==eo(t,["style","visibility"])&&(null===(e=this.context.viewport)||void 0===e?void 0:e.isInViewport(t.getRenderBounds()))});return e?i.filter(t=>e(t)):i}hideSnapline(){this.horizontalLine.style.visibility="hidden",this.verticalLine.style.visibility="hidden"}getLineWidth(t){let{lineWidth:e}=this.options["".concat(t,"LineStyle")];return+(e||sL.lineWidth||1)/this.context.graph.getZoom()}updateSnapline(t){let{verticalX:e,verticalMinY:n,verticalMaxY:i,horizontalY:s,horizontalMinX:r,horizontalMaxX:a}=t,[o,l]=this.context.canvas.getSize(),{offset:h}=this.options;null!==s?Object.assign(this.horizontalLine.style,{x1:h===1/0?0:r-h,y1:s,x2:h===1/0?o:a+h,y2:s,visibility:"visible",lineWidth:this.getLineWidth("horizontal")}):this.horizontalLine.style.visibility="hidden",null!==e?Object.assign(this.verticalLine.style,{x1:e,y1:h===1/0?0:n-h,x2:e,y2:h===1/0?l:i+h,visibility:"visible",lineWidth:this.getLineWidth("vertical")}):this.verticalLine.style.visibility="hidden"}getDelta(t){let e=this.context.graph.getZoom();return t_([t.dx,t.dy],e)}async bindEvents(){let{graph:t}=this.context;t.on(T.DRAG_START,this.onDragStart),t.on(T.DRAG,this.onDrag),t.on(T.DRAG_END,this.onDragEnd)}unbindEvents(){let{graph:t}=this.context;t.off(T.DRAG_START,this.onDragStart),t.off(T.DRAG,this.onDrag),t.off(T.DRAG_END,this.onDragEnd)}destroyElements(){var t,e;null===(t=this.horizontalLine)||void 0===t||t.destroy(),null===(e=this.verticalLine)||void 0===e||e.destroy()}destroy(){this.destroyElements(),this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},sI.defaultOptions,e)),this.initSnapline=()=>{let t=this.context.canvas.getLayer("transient");this.horizontalLine||(this.horizontalLine=t.appendChild(new N.x1({style:{...sL,...this.options.horizontalLineStyle}}))),this.verticalLine||(this.verticalLine=t.appendChild(new N.x1({style:{...sL,...this.options.verticalLineStyle}})))},this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!0,this.autoSnapToLine=async(t,e,n)=>{let{verticalX:i,horizontalY:s}=n,{tolerance:r}=this.options,{min:[a,o],max:[l,h],center:[c,d]}=e,u=0,p=0;null!==i&&(sB(l,i)<r&&(u=i-l),sB(a,i)<r&&(u=i-a),sB(c,i)<r&&(u=i-c),0!==u&&(this.isVerticalSticking=!0)),null!==s&&(sB(h,s)<r&&(p=s-h),sB(o,s)<r&&(p=s-o),sB(d,s)<r&&(p=s-d),0!==p&&(this.isHorizontalSticking=!0)),(0!==u||0!==p)&&await this.context.graph.translateElementBy({[t]:[u,p]},!1)},this.enableSnap=t=>{let{target:e}=t;if(this.isHorizontalSticking||this.isVerticalSticking){let[n,i]=this.getDelta(t);if(this.isHorizontalSticking&&this.isVerticalSticking&&.5>=Math.abs(n)&&.5>=Math.abs(i))return this.context.graph.translateElementBy({[e.id]:[-n,-i]},!1),!1;if(this.isHorizontalSticking&&.5>=Math.abs(i))return this.context.graph.translateElementBy({[e.id]:[0,-i]},!1),!1;if(this.isVerticalSticking&&.5>=Math.abs(n))return this.context.graph.translateElementBy({[e.id]:[-n,0]},!1),!1;this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!1,setTimeout(()=>{this.enableStick=!0},200)}return this.enableStick},this.calcSnaplineMetadata=(t,e)=>{let{tolerance:n,shape:i}=this.options,{min:[s,r],max:[a,o],center:[l,h]}=e,c=null,d=null,u=null,p=null,g=null,f=null;return this.getNodes().some(e=>{if(W(t.id,e.id))return!1;let y=s_(e,i).getRenderBounds(),{min:[m,v],max:[b,E],center:[x,w]}=y;return null===c&&(sB(x,l)<n?c=x:sB(m,s)<n?c=m:sB(m,a)<n?c=m:sB(b,a)<n?c=b:sB(b,s)<n&&(c=b),null!==c&&(d=Math.min(v,r),u=Math.max(E,o))),null===p&&(sB(w,h)<n?p=w:sB(v,r)<n?p=v:sB(v,o)<n?p=v:sB(E,o)<n?p=E:sB(E,r)<n&&(p=E),null!==p&&(g=Math.min(m,s),f=Math.max(b,a))),null!==c&&null!==p}),{verticalX:c,verticalMinY:d,verticalMaxY:u,horizontalY:p,horizontalMinX:g,horizontalMaxX:f}},this.onDragStart=()=>{this.initSnapline()},this.onDrag=async t=>{let{target:e}=t;if(this.options.autoSnap){let e=this.enableSnap(t);if(!e)return}let n=s_(e,this.options.shape).getRenderBounds(),i=this.calcSnaplineMetadata(e,n);this.hideSnapline(),(null!==i.verticalX||null!==i.horizontalY)&&this.updateSnapline(i),this.options.autoSnap&&await this.autoSnapToLine(e.id,n,i)},this.onDragEnd=()=>{this.hideSnapline()},this.bindEvents()}}sI.defaultOptions={tolerance:5,offset:20,autoSnap:!0,shape:"key",verticalLineStyle:{stroke:"#1783FF"},horizontalLineStyle:{stroke:"#1783FF"},filter:()=>!0};let sB=(t,e)=>Math.abs(t-e),s_=(t,e)=>"function"==typeof e?e(t):t.getShape(e);var sF=n(97582),sj=n(12267),sz=n(5951),sH=n(8126),sW=n(43629),sV=n(33016);function sG(t,e){var n={YYYY:t.getFullYear(),MM:t.getMonth()+1,DD:t.getDate(),HH:t.getHours(),mm:t.getMinutes(),ss:t.getSeconds()},i=e;return Object.keys(n).forEach(function(t){var e=n[t];i=i.replace(t,"YYYY"===t?"".concat(e):"".concat(e).padStart(2,"0"))}),i}var sY=n(73321),sU=n(92896),sK=n(62191),sZ=n(24886),sX=n(27840),s$=function(t,e){if(t){if((0,sZ.Z)(t))for(var n=0,i=t.length;n<i&&!1!==e(t[n],n);n++);else if((0,sX.Z)(t)){for(var s in t)if(t.hasOwnProperty(s)&&!1===e(t[s],s))break}}},sq=n(101),sJ=function(t,e,n){if(!(0,sZ.Z)(t)&&!(0,sq.Z)(t))return t;var i=n;return s$(t,function(t,n){i=e(i,t,n)}),i},sQ=n(54015),s0=n(34819),s1=n(75494),s2=n(62059),s3=function(t){function e(n){var i=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;return i.hoverColor="#f5f5f5",i.selectedColor="#e6f7ff",i.background=i.appendChild(new N.UL({})),i.label=i.background.appendChild(new N.ZA({})),i}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,sK.j)(this.style.padding)},enumerable:!1,configurable:!0}),e.prototype.renderLabel=function(){var t=this.style,e=t.label,n=t.value,i=(0,sV.zs)(this.attributes,"label");(0,sQ.Ys)(this.label).maybeAppend(".label",function(){return(0,s1.S)(e)}).attr("className","label").styles(i),this.label.attr("__data__",n)},e.prototype.renderBackground=function(){var t=this.label.getBBox(),e=(0,sF.CR)(this.padding,4),n=e[0],i=e[1],s=e[2],r=e[3],a=t.width,o=t.height,l=o+n+s,h=(0,sV.zs)(this.attributes,"background"),c=this.style,d=c.width,u=c.height,p=c.selected;this.background.attr((0,sF.pi)((0,sF.pi)({},h),{width:Math.max(a+r+i,void 0===d?0:d),height:Math.max(l,void 0===u?0:u),fill:p?this.selectedColor:"#fff"})),this.label.attr({transform:"translate(".concat(r,", ").concat((l-o)/2,")")})},e.prototype.render=function(){this.renderLabel(),this.renderBackground()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("pointerenter",function(){t.style.selected||t.background.attr("fill",t.hoverColor)}),this.addEventListener("pointerleave",function(){t.style.selected||t.background.attr("fill",t.style.backgroundFill)});var e=this;this.addEventListener("click",function(){var n=t.style,i=n.label,s=n.value,r=n.onClick;null==r||r(s,{label:i,value:s},e)})},e.defaultOptions={style:{value:"",label:"",cursor:"pointer"}},e}(sz.w),s6=function(t){function e(n){var i,s,r=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;r.currentValue=null===(i=e.defaultOptions.style)||void 0===i?void 0:i.defaultValue,r.isPointerInSelect=!1,r.select=r.appendChild(new N.UL({className:"select",style:{cursor:"pointer",width:0,height:0}})),r.dropdown=r.appendChild(new N.UL({className:"dropdown"}));var a=r.style.defaultValue;return a&&(null===(s=r.style.options)||void 0===s?void 0:s.some(function(t){return t.value===a}))&&(r.currentValue=a),r}return(0,sF.ZT)(e,t),e.prototype.setValue=function(t){this.currentValue=t,this.render()},e.prototype.getValue=function(){return this.currentValue},Object.defineProperty(e.prototype,"dropdownPadding",{get:function(){return(0,sK.j)(this.style.dropdownPadding)},enumerable:!1,configurable:!0}),e.prototype.renderSelect=function(){var t,e=this,n=this.style,i=n.x,s=n.y,r=n.width,a=n.height,o=n.bordered,l=n.showDropdownIcon,h=(0,sV.zs)(this.attributes,"select"),c=(0,sV.zs)(this.attributes,"placeholder");this.select.attr((0,sF.pi)((0,sF.pi)({x:i,y:s,width:r,height:a},h),{fill:"#fff",strokeWidth:o?1:0}));var d=this.dropdownPadding;l&&(0,sQ.Ys)(this.select).maybeAppend(".dropdown-icon","path").style("d","M-5,-3.5 L0,3.5 L5,-3.5").style("transform","translate(".concat(i+r-10-d[1]-d[3],", ").concat(s+a/2,")")).style("lineWidth",1).style("stroke",this.select.style.stroke);var u=null===(t=this.style.options)||void 0===t?void 0:t.find(function(t){return t.value===e.currentValue}),p=(0,sF.pi)({x:i+d[3]},c);(0,sQ.Ys)(this.select).selectAll(".placeholder").data(u?[]:[1]).join(function(t){return t.append("text").attr("className","placeholder").styles(p).style("y",function(){return s+(a-this.getBBox().height)/2})},function(t){return t.styles(p)},function(t){return t.remove()});var g=(0,sV.zs)(this.attributes,"optionLabel"),f=(0,sF.pi)({x:i+d[3]},g);(0,sQ.Ys)(this.select).selectAll(".value").data(u?[u]:[]).join(function(t){return t.append(function(t){return(0,s1.S)(t.label)}).attr("className","value").styles(f).style("y",function(){return s+(a-this.getBBox().height)/2})},function(t){return t.styles(f)},function(t){return t.remove()})},e.prototype.renderDropdown=function(){var t,e,n=this,i=this.style,s=i.x,r=i.y,a=i.width,o=i.height,l=i.options,h=i.onSelect,c=i.open,d=(0,sV.zs)(this.attributes,"dropdown"),u=(0,sV.zs)(this.attributes,"option"),p=this.dropdownPadding;(0,sQ.Ys)(this.dropdown).maybeAppend(".dropdown-container","g").attr("className","dropdown-container").selectAll(".dropdown-item").data(l,function(t){return t.value}).join(function(t){return t.append(function(t){return new s3({className:"dropdown-item",style:(0,sF.pi)((0,sF.pi)((0,sF.pi)({},t),u),{width:a-p[1]-p[3],selected:t.value===n.currentValue,onClick:function(t,e,i){n.setValue(t),null==h||h(t,e,i),n.dispatchEvent(new N.Aw("change",{detail:{value:t,option:e,item:i}})),(0,s2.Cp)(n.dropdown)}})})}).each(function(t,e){var n,i=(null===(n=this.parentNode)||void 0===n?void 0:n.children).reduce(function(t,n,i){return i<e&&(t+=n.getBBox().height),t},0);this.attr("transform","translate(".concat(p[3],", ").concat(p[0]+i,")"))})},function(t){return t.update(function(t){return{selected:t.value===n.currentValue}})},function(t){return t.remove()});var g=null===(e=null===(t=this.dropdown.getElementsByClassName("dropdown-container"))||void 0===t?void 0:t[0])||void 0===e?void 0:e.getBBox(),f=d.spacing;this.dropdown.attr((0,sF.pi)({transform:"translate(".concat(s,", ").concat(r+o+f,")"),width:g.width+p[1]+p[3],height:g.height+p[0]+p[2]},d)),c||(0,s2.Cp)(this.dropdown)},e.prototype.render=function(){this.renderSelect(),this.renderDropdown()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("click",function(t){t.stopPropagation()}),this.select.addEventListener("click",function(){"visible"===t.dropdown.style.visibility?(0,s2.Cp)(t.dropdown):(0,s2.$Z)(t.dropdown)}),this.addEventListener("pointerenter",function(){t.isPointerInSelect=!0}),this.addEventListener("pointerleave",function(){t.isPointerInSelect=!1}),null==document||document.addEventListener("click",function(){t.isPointerInSelect||(0,s2.Cp)(t.dropdown)})},e.defaultOptions={style:{x:0,y:0,width:140,height:32,options:[],bordered:!0,defaultValue:"",selectRadius:8,selectStroke:"#d9d9d9",showDropdownIcon:!0,placeholderText:"",placeholderFontSize:12,placeholderTextBaseline:"top",placeholderFill:"#c2c2c2",dropdownFill:"#fff",dropdownStroke:"#d9d9d9",dropdownRadius:8,dropdownShadowBlur:4,dropdownShadowColor:"rgba(0, 0, 0, 0.08)",dropdownPadding:8,dropdownSpacing:10,optionPadding:[8,12],optionFontSize:12,optionTextBaseline:"top",optionBackgroundFill:"#fff",optionBackgroundRadius:4,optionLabelFontSize:12,optionLabelTextBaseline:"top"}},e}(sz.w),s4=function(t){function e(n){var i=t.call(this,(0,sH.n)({},{style:{backgroundOpacity:e.backgroundOpacities.default}},e.defaultOptions,n))||this;return i.showBackground=!0,i.background=i.appendChild(new N.UL({})),i.icon=i.appendChild(new N.ZA({})),i}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"BaseIcon"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return Math.log10(this.attributes.size)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,sK.j)(this.attributes.size/5)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconSize",{get:function(){var t=this.attributes.size,e=(0,sF.CR)(this.padding,4),n=e[0],i=e[1],s=e[2];return Math.max(t-Math.max(e[3]+i,n+s),2*this.lineWidth+1)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.size,s=i/2,r=(0,sV.zs)(this.attributes,"background");this.background.attr((0,sF.pi)({x:e-s,y:n-s,width:i,height:i},r))},e.prototype.showIndicator=function(){if(this.label){var t=this.attributes.size,e=this.background.getBBox(),n=e.x,i=e.y;this.indicator.update({x:n+t/2,y:i-5,labelText:this.label,visibility:"visible"})}},e.prototype.hideIndicator=function(){this.indicator.update({visibility:"hidden"})},e.prototype.connectedCallback=function(){t.prototype.connectedCallback.call(this);var e,n=this.attributes.size,i=this.background.getBBox(),s=i.x,r=i.y,a=null===(e=this.ownerDocument)||void 0===e?void 0:e.defaultView;a&&(this.indicator=a.appendChild(new s0.z({style:{x:s+n/2,y:r-n/2,visibility:"hidden",position:"top",radius:3,zIndex:100}})))},e.prototype.disconnectedCallback=function(){this.indicator.destroy()},e.prototype.render=function(){this.renderIcon(),this.showBackground&&this.renderBackground()},e.prototype.bindEvents=function(){var t=this,n=this.attributes.onClick;if(this.addEventListener("click",function(){null==n||n(t)}),this.showBackground){var i=function(){return t.background.attr({opacity:e.backgroundOpacities.default})};this.addEventListener("pointerenter",function(){t.background.attr({opacity:e.backgroundOpacities.hover}),t.showIndicator()}),this.addEventListener("pointerleave",function(){i(),t.hideIndicator()}),this.addEventListener("pointerdown",function(){t.background.attr({opacity:e.backgroundOpacities.active})}),this.addEventListener("pointerup",function(){i()})}},e.tag="IconBase",e.defaultOptions={style:{x:0,y:0,size:10,color:"#565758",backgroundRadius:4,backgroundFill:"#e2e2e2"}},e.backgroundOpacities={default:0,hover:.8,active:1},e}(sz.w),s8=function(t,e){return void 0===e&&(e="#565758"),new N.y$({style:{fill:e,d:"M ".concat(t,",").concat(t," L -").concat(t,",0 L ").concat(t,",-").concat(t," Z"),transformOrigin:"center"}})},s9=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),e.prototype.arcPath=function(t,e,n){var i=(0,sF.CR)([n,n],2),s=i[0],r=i[1],a=function(i){return[t+n*Math.cos(i),e+n*Math.sin(i)]},o=(0,sF.CR)(a(-5/4*Math.PI),2),l=o[0],h=o[1],c=(0,sF.CR)(a(1/4*Math.PI),2),d=c[0],u=c[1];return"M".concat(l,",").concat(h,",A").concat(s,",").concat(r,",0,1,1,").concat(d,",").concat(u)},Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=this.lineWidth,a=r+.5;(0,sQ.Ys)(this.icon).maybeAppend(".reset","path").styles({stroke:i,lineWidth:r,d:this.arcPath(e,n,s/2-r),markerStart:s8(a,i)})},e}(s4),s5=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=s/2,a=s/2/1.7320508075688772;(0,sQ.Ys)(this.icon).maybeAppend(".backward","polygon").styles({points:[[e,n],[e,n-a],[e-r,n],[e,n+a],[e,n],[e+r,n-a],[e+r,n+a],[e,n]],fill:i})},e}(s4),s7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=s/2,a=s/2/1.7320508075688772;(0,sQ.Ys)(this.icon).maybeAppend(".forward","polygon").styles({points:[[e,n],[e,n-a],[e+r,n],[e,n+a],[e,n],[e-r,n-a],[e-r,n+a],[e,n]],fill:i})},e}(s4),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=s/3*1.3856406460551018;(0,sQ.Ys)(this.icon).maybeAppend(".play","polygon").styles({points:[[e+r,n],[e-r/2,n-s/2*.8],[e-r/2,n+s/2*.8],[e+r,n]],fill:i})},e}(s4),re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=s/3;(0,sQ.Ys)(this.icon).maybeAppend(".pause","polygon").styles({points:[[e-r,n-s/2],[e-r,n+s/2],[e-r/2,n+s/2],[e-r/2,n-s/2],[e-r,n-s/2],[e+r/2,n-s/2],[e+r/2,n+s/2],[e+r,n+s/2],[e+r,n-s/2]],fill:i})},e}(s4),rn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=this.lineWidth;(0,sQ.Ys)(this.icon).maybeAppend(".left-line","line").styles({x1:e-s/2,y1:n-s/2,x2:e-s/2,y2:n+s/2,stroke:i,lineWidth:r}),(0,sQ.Ys)(this.icon).maybeAppend(".right-line","line").styles({x1:e+s/2,y1:n-s/2,x2:e+s/2,y2:n+s/2,stroke:i,lineWidth:r}),(0,sQ.Ys)(this.icon).maybeAppend(".left-arrow","line").styles({x1:e,y1:n,x2:e-s/2+2*r,y2:n,stroke:i,lineWidth:r,markerEnd:s8(2*r,i)}),(0,sQ.Ys)(this.icon).maybeAppend(".right-arrow","line").styles({x1:e,y1:n,x2:e+s/2-2*r,y2:n,stroke:i,lineWidth:r,markerEnd:s8(2*r,i)})},e}(s4),ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=this.lineWidth;(0,sQ.Ys)(this.icon).maybeAppend(".line","line").styles({x1:e,y1:n-s/2,x2:e,y2:n+s/2,stroke:i,lineWidth:r}),(0,sQ.Ys)(this.icon).maybeAppend(".left-arrow","line").styles({x1:e-s/2-2*r,y1:n,x2:e-2*r,y2:n,stroke:i,lineWidth:r,markerEnd:s8(2*r,i)}),(0,sQ.Ys)(this.icon).maybeAppend(".right-arrow","line").styles({x1:e+s/2+2*r,y1:n,x2:e+2*r,y2:n,stroke:i,lineWidth:r,markerEnd:s8(2*r,i)})},e}(s4),rs=function(t){return[[-t/2,-t/2],[-t/2,t/2],[t/2,t/2]]},rr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=this.lineWidth,a=(s-2*r-r)/4,o=(s-2*r-r)/2,l=(0,sF.CR)([e-s/2+r,n+s/2-2*r],2),h=l[0],c=l[1];(0,sQ.Ys)(this.icon).maybeAppend(".coordinate","polyline").styles({points:rs(s).map(function(t){var i=(0,sF.CR)(t,2);return[i[0]+e,i[1]+n]}),stroke:i,lineWidth:r}),(0,sQ.Ys)(this.icon).maybeAppend(".line","polyline").styles({points:[[h,c],[h+a,c-o],[h+2*a,c],[h+4*a,c-2*o]],stroke:i,lineWidth:r})},e}(s4),ra=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return[1,4,2,4,3]},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.data,e=this.attributes,n=e.x,i=e.y,s=e.color,r=this.iconSize,a=this.lineWidth,o=(r-a)/t.length,l=(r-2*a)/4,h=(0,sF.CR)([n-r/2+2*a,i+r/2-a],2),c=h[0],d=h[1];(0,sQ.Ys)(this.icon).maybeAppend(".coordinate","polyline").styles({points:rs(r).map(function(t){var e=(0,sF.CR)(t,2);return[e[0]+n,e[1]+i]}),stroke:s,lineWidth:a}),(0,sQ.Ys)(this.icon).maybeAppend(".bars","g").selectAll(".column").data(this.data.map(function(t,e){return{value:t,index:e}})).join(function(t){return t.append("line").attr("className","column").style("x1",function(t){return c+o*t.index}).style("y1",d).style("x2",function(t){return c+o*t.index}).style("y2",function(t){return d-l*t.value}).styles({y1:d,stroke:s,lineWidth:a})})},e}(s4),ro=function(t){function e(e){var n=t.call(this,(0,sH.n)({},{style:{color:"#d8d9d9"}},e))||this;return n.showBackground=!1,n}return(0,sF.ZT)(e,t),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,r=this.lineWidth;(0,sQ.Ys)(this.icon).maybeAppend(".split","line").styles({x1:e,y1:n-s/2,x2:e,y2:n+s/2,stroke:i,lineWidth:r})},e}(s4),rl=function(t){function e(){var e=t.apply(this,(0,sF.ev)([],(0,sF.CR)(arguments),!1))||this;return e.showBackground=!1,e}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,sK.j)(0)},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t,e,n=this.iconSize,i=this.attributes,s=i.x,r=i.y,a=i.speed,o=(t=this.attributes,e=["x","y","transform","transformOrigin","width","height","size","color","speed"],sJ(t,function(t,n,i){return e.includes(i)||(t[i]=n),t},{})),l=(0,sj.Z)(n,20,1/0),h=(0,sF.pi)((0,sF.pi)({},o),{x:s-l/2,y:r-10,width:l,height:20,defaultValue:void 0===a?1:a,bordered:!1,showDropdownIcon:!1,selectRadius:2,dropdownPadding:this.padding,dropdownRadius:2,dropdownSpacing:n/5,placeholderFontSize:n/2,optionPadding:0,optionLabelFontSize:n/2,optionBackgroundRadius:1,options:[{label:"1x",value:1},{label:"1.5x",value:1.5},{label:"2x",value:2}]});(0,sQ.Ys)(this.icon).maybeAppend(".speed",function(){return new s6({style:h})}).attr("className","speed").each(function(){this.update(h)})},e.tag="SpeedSelect",e}(s4),rh=function(t){function e(e){var n=t.call(this,e)||this;return n.icon=n.appendChild(new N.ZA({})),n.currentType=n.attributes.type,n}return(0,sF.ZT)(e,t),e.prototype.getType=function(){return this.currentType},e.prototype.render=function(){var t=this,e=this.attributes,n=(e.onChange,(0,sF._T)(e,["onChange"]));(0,sQ.Ys)(this.icon).selectAll(".icon").data([this.currentType]).join(function(e){return e.append(function(e){var n,i=null===(n=t.toggles.find(function(t){return(0,sF.CR)(t,1)[0]===e}))||void 0===n?void 0:n[1];if(!i)throw Error("Invalid type: ".concat(e));return new i({})}).attr("className","icon").styles(n,!1).update({})},function(t){return t.styles({restStyles:n}).update({})},function(t){return t.remove()})},e.prototype.bindEvents=function(){var t=this,e=this.attributes.onChange;this.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();var i=(t.toggles.findIndex(function(e){return(0,sF.CR)(e,1)[0]===t.currentType})+1)%t.toggles.length,s=t.toggles[i][0];null==e||e(t.currentType),t.currentType=s,t.render()})},e.tag="ToggleIcon",e}(sz.w),rc=function(t){function e(e){var n=t.call(this,(0,sH.n)({},{style:{type:"play"}},e))||this;return n.toggles=[["play",rt],["pause",re]],n}return(0,sF.ZT)(e,t),e}(rh),rd=function(t){function e(e){var n=t.call(this,(0,sH.n)({},{style:{type:"range"}},e))||this;return n.toggles=[["range",rn],["value",ri]],n}return(0,sF.ZT)(e,t),e}(rh),ru=function(t){function e(e){var n=t.call(this,(0,sH.n)({},{style:{type:"column"}},e))||this;return n.toggles=[["line",rr],["column",ra]],n}return(0,sF.ZT)(e,t),e}(rh),rp={reset:s9,speed:rl,backward:s5,playPause:rc,forward:s7,selectionType:rd,chartType:ru,split:ro},rg=function(t){function e(n){var i=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;return i.background=i.appendChild(new N.UL({})),i.functions=i.appendChild(new N.ZA({})),i}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,sK.j)(this.attributes.padding)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.style,e=t.x,n=t.y,i=t.width,s=t.height,r=(0,sV.zs)(this.attributes,"background");this.background.attr((0,sF.pi)({x:e,y:n,width:i,height:s},r))},e.prototype.renderFunctions=function(){var t,e=this,n=this.attributes,i=n.functions,s=n.iconSize,r=n.iconSpacing,a=n.x,o=n.y,l=n.width,h=n.height,c=n.align,d=(0,sF.CR)(this.padding,4),u=d[1],p=d[3],g=i.reduce(function(t,e){return t.length&&e.length?t.concat.apply(t,(0,sF.ev)(["split"],(0,sF.CR)(e),!1)):t.concat.apply(t,(0,sF.ev)([],(0,sF.CR)(e),!1))},[]),f=g.length*(s+r)-r,y={left:p+s/2,center:(l-f)/2+s/2,right:l-f-p-u+s/2}[c]||0;null===(t=this.speedSelect)||void 0===t||t.destroy(),this.functions.removeChildren(),g.forEach(function(t,n){var i,l=rp[t],c={x:a+n*(s+r)+y,y:o+h/2,size:s};if(l===rl?(c.speed=e.attributes.speed,c.onSelect=function(n){return e.handleFunctionChange(t,{value:n})}):[rc,rd,ru].includes(l)?(c.onChange=function(n){return e.handleFunctionChange(t,{value:n})},l===rc&&(c.type="play"===e.attributes.state?"pause":"play"),l===rd&&(c.type="range"===e.attributes.selectionType?"value":"range"),l===ru&&(c.type="line"===e.attributes.chartType?"column":"line")):c.onClick=function(){return e.handleFunctionChange(t,{value:t})},l===rl){var d=null===(i=e.ownerDocument)||void 0===i?void 0:i.defaultView;d&&(e.speedSelect=new l({style:(0,sF.pi)((0,sF.pi)({},c),{zIndex:100})}),d.appendChild(e.speedSelect))}else e.functions.appendChild(new l({style:c}))})},e.prototype.disconnectedCallback=function(){var e;t.prototype.disconnectedCallback.call(this),null===(e=this.speedSelect)||void 0===e||e.destroy()},e.prototype.render=function(){this.renderBackground(),this.renderFunctions()},e.prototype.handleFunctionChange=function(t,e){var n=this.attributes.onChange;null==n||n(t,e)},e.defaultOptions={style:{x:0,y:0,width:300,height:40,padding:0,align:"center",iconSize:25,iconSpacing:0,speed:1,state:"pause",chartType:"line",selectionType:"range",backgroundFill:"#fbfdff",backgroundStroke:"#ebedf0",functions:[["reset","speed"],["backward","playPause","forward"],["selectionType","chartType"]]}},e}(sz.w),rf=function(t){function e(n){var i=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;return i.bindEvents(),i}return(0,sF.ZT)(e,t),e.prototype.bindEvents=function(){var t=this;this.addEventListener("mouseenter",function(){t.attr("lineWidth",Math.ceil(+(t.style.r||0)/2))}),this.addEventListener("mouseleave",function(){t.attr("lineWidth",0)})},e.defaultOptions={style:{r:5,fill:"#3f7cf7",lineWidth:0,stroke:"#3f7cf7",strokeOpacity:.5,cursor:"pointer"}},e}(N.Cd),ry=function(t){function e(n){return t.call(this,(0,sH.n)({},e.defaultOptions,n))||this}return(0,sF.ZT)(e,t),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,s=t.height,r=(0,sV.zs)(this.attributes,"background");(0,sQ.Ys)(this).maybeAppend("background","rect").attr("className","background").styles((0,sF.pi)({x:e-i/2,y:n-s/2,width:i,height:s},r))},e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.iconSize,s=(0,sV.zs)(this.attributes,"icon"),r=i/2;(0,sQ.Ys)(this).maybeAppend("icon-left-line","line").attr("className","icon-left-line").styles((0,sF.pi)({x1:e-1,y1:n-r,x2:e-1,y2:n+r},s)),(0,sQ.Ys)(this).maybeAppend("icon-right-line","line").attr("className","icon-right-line").styles((0,sF.pi)({x1:e+1,y1:n-r,x2:e+1,y2:n+r},s))},e.prototype.renderBorder=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,s=t.height,r=t.type,a=(0,sV.zs)(this.attributes,"border"),o="start"===r?+i/2:-i/2;(0,sQ.Ys)(this).maybeAppend("border","line").attr("className","border").styles((0,sF.pi)({x1:o+e,y1:n-s/2,x2:o+e,y2:n+s/2},a))},e.prototype.render=function(){this.renderBackground(),this.renderIcon(),this.renderBorder()},e.defaultOptions={style:{x:0,y:0,width:10,height:50,iconSize:10,type:"start",backgroundFill:"#fff",backgroundFillOpacity:.5,iconStroke:"#9a9a9a",iconLineWidth:1,borderStroke:"#e8e8e8",borderLineWidth:1}},e}(sz.w);function rm(t){var e=String(Math.floor(t/3600)).padStart(2,"0"),n=String(Math.floor(t%3600/60)).padStart(2,"0"),i=String(Math.floor(t%60)).padStart(2,"0");return t<3600?"".concat(n,":").concat(i):"".concat(e,":").concat(n,":").concat(i)}var rv=function(t){function e(n){var i=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;i.axis=i.appendChild(new sY.R({style:{type:"linear",startPos:[0,0],endPos:[0,0],data:[],showArrow:!1,animate:!1}})),i.timeline=i.appendChild(new sU.i({style:{onChange:function(t){i.handleSliderChange(t)}}})),i.controller=i.appendChild(new rg({})),i.states={},i.handleSliderChange=function(t){var e,n=Array.isArray(e=i.states.values)?(0,sF.ev)([],(0,sF.CR)(e),!1):e;i.setBySliderValues(t),i.dispatchOnChange(n)};var s=i.attributes,r=s.selectionType,a=s.chartType,o=s.speed,l=s.state,h=s.playMode,c=s.values;return i.states={chartType:a,playMode:h,selectionType:r,speed:o,state:l},i.setByTimebarValues(c),i}return(0,sF.ZT)(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this.attributes.data.sort(function(t,e){return t.time<e.time?-1:t.time>e.time?1:0})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"space",{get:function(){var t,e=this.attributes,n=e.x,i=e.y,s=e.width,r=e.height,a=e.type,o=e.controllerHeight,l=(0,sj.Z)(+r-o,0,+r),h=new sW.b(n,i+ +r-o,+s,o),c=0;"chart"===a?(c=35,t=new sW.b(n,i+l-c,+s,c)):t=new sW.b;var d="time"===a?10:l;return{axisBBox:t,controllerBBox:h,timelineBBox:new sW.b(n,i+("time"===a?l:l-d),+s,d-c)}},enumerable:!1,configurable:!0}),e.prototype.setBySliderValues=function(t){var e,n,i=this.data,s=(0,sF.CR)(Array.isArray(t)?t:[0,t],2),r=s[0],a=s[1],o=i.length,l=i[Math.floor(r*o)],h=i[Math.ceil(a*o)-(Array.isArray(t)?0:1)];this.states.values=[null!==(e=null==l?void 0:l.time)&&void 0!==e?e:i[0].time,null!==(n=null==h?void 0:h.time)&&void 0!==n?n:1/0]},e.prototype.setByTimebarValues=function(t){var e,n,i,s=this.data,r=(0,sF.CR)(Array.isArray(t)?t:[void 0,t],2),a=r[0],o=r[1],l=s.find(function(t){return t.time===a}),h=s.find(function(t){return t.time===o});this.states.values=[null!==(e=null==l?void 0:l.time)&&void 0!==e?e:null===(n=s[0])||void 0===n?void 0:n.time,null!==(i=null==h?void 0:h.time)&&void 0!==i?i:1/0]},e.prototype.setByIndex=function(t){var e,n,i,s,r=this.data,a=(0,sF.CR)(t,2),o=a[0],l=a[1];this.states.values=[null!==(n=null===(e=r[o])||void 0===e?void 0:e.time)&&void 0!==n?n:r[0].time,null!==(s=null===(i=this.data[l])||void 0===i?void 0:i.time)&&void 0!==s?s:1/0]},Object.defineProperty(e.prototype,"sliderValues",{get:function(){var t,e=this.states,n=e.values,i=e.selectionType,s=(0,sF.CR)(Array.isArray(n)?n:[void 0,n],2),r=s[0],a=s[1],o=this.data,l=o.length,h="value"===i;return[(t=o.findIndex(function(t){return t.time===r}),h?0:t>-1?t/l:0),function(){if(a===1/0)return 1;var t=o.findIndex(function(t){return t.time===a});return t>-1?t/l:h?.5:1}()]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){var t=this.states,e=t.values,n=t.selectionType,i=(0,sF.CR)(Array.isArray(e)?e:[this.data[0].time,e],2),s=i[0],r=i[1];return"value"===n?r:[s,r]},enumerable:!1,configurable:!0}),e.prototype.getDatumByRatio=function(t){var e=this.data,n=e.length;return e[Math.floor(t*(n-1))]},Object.defineProperty(e.prototype,"chartHandleIconShape",{get:function(){var t=this.states.selectionType,e=this.space.timelineBBox.height;return"range"===t?function(t){return new ry({style:{type:t,height:e,iconSize:e/6}})}:function(){return new N.x1({style:{x1:0,y1:-e/2,x2:0,y2:e/2,lineWidth:2,stroke:"#c8c8c8"}})}},enumerable:!1,configurable:!0}),e.prototype.getChartStyle=function(t){var e=this,n=t.x,i=t.y,s=t.width,r=t.height,a=this.states,o=a.selectionType,l=a.chartType,h=this.data,c=this.attributes,d=c.type,u=c.labelFormatter,p=(0,sV.zs)(this.attributes,"chart"),g=(p.type,(0,sF._T)(p,["type"])),f="range"===o;if("time"===d)return(0,sF.pi)({handleIconShape:function(){return new rf({})},selectionFill:"#2e7ff8",selectionFillOpacity:1,showLabelOnInteraction:!0,handleLabelDy:f?-15:0,autoFitLabel:f,handleSpacing:f?-15:0,trackFill:"#edeeef",trackLength:s,trackOpacity:.5,trackRadius:r/2,trackSize:r/2,type:o,values:this.sliderValues,formatter:function(t){if(u)return u(t);var n=e.getDatumByRatio(t).time;return"number"==typeof n?rm(n):sG(n,"YYYY-MM-DD HH:mm:ss")},transform:"translate(".concat(n,", ").concat(i,")"),zIndex:1},g);var y=h.map(function(t){return t.value});return(0,sF.pi)({handleIconOffset:"range"===o?5:0,handleIconShape:this.chartHandleIconShape,selectionFill:"#fff",selectionFillOpacity:.5,selectionType:"invert",sparklineSpacing:.1,sparklineColumnLineWidth:0,sparklineColor:"#d4e5fd",sparklineAreaOpacity:1,sparklineAreaLineWidth:0,sparklineData:y,sparklineType:l,sparklineScale:.8,trackLength:s,trackSize:r,type:o,values:this.sliderValues,transform:"translate(".concat(n,", ").concat(i,")"),zIndex:1},g)},e.prototype.renderChart=function(t){void 0===t&&(t=this.space.timelineBBox),this.timeline.update(this.getChartStyle(t))},e.prototype.updateSelection=function(){this.timeline.setValues(this.sliderValues,!0),this.handleSliderChange(this.sliderValues)},e.prototype.getAxisStyle=function(t){var e=this.data,n=this.attributes,i=n.interval,s=n.labelFormatter,r=(0,sV.zs)(this.attributes,"axis"),a=t.x,o=t.y,l=t.width,h=(0,sF.ev)((0,sF.ev)([],(0,sF.CR)(e),!1),[{time:0}],!1).map(function(t,e,n){var i=t.time;return{label:"".concat(i),value:e/(n.length-1),time:i}});return(0,sF.pi)({startPos:[a,o],endPos:[a+l,o],data:h,labelFilter:function(t,e){return e<h.length-1},labelFormatter:function(t){var e=t.time;return s?s(e):"number"==typeof e?rm(e):function(t,e){var n=new Date(t);switch(e){case"half-hour":case"hour":case"four-hour":if([0,6,12,18].includes(n.getHours())&&0===n.getMinutes())return sG(n,"HH:mm\nYYYY-MM-DD");return sG(n,"HH:mm");case"half-day":if(12>n.getHours())return"AM\n".concat(sG(n,"YYYY-MM-DD"));return"PM";case"day":if([1,10,20].includes(n.getDate()))return sG(n,"DD\nYYYY-MM");return sG(n,"DD");case"week":if(7>=n.getDate())return sG(n,"DD\nYYYY-MM");return sG(n,"DD");case"month":if([0,6].includes(n.getMonth()))return sG(n,"MM\nYYYY");return sG(n,"MM");case"season":if([0].includes(n.getMonth()))return sG(n,"MM\nYYYY");return sG(n,"MM");case"year":return sG(n,"YYYY");default:return sG(n,"YYYY-MM-DD HH:mm")}}(e,i)}},r)},e.prototype.renderAxis=function(t){void 0===t&&(t=this.space.axisBBox),"chart"===this.attributes.type&&this.axis.update(this.getAxisStyle(t))},e.prototype.renderController=function(t){void 0===t&&(t=this.space.controllerBBox);var e=this.attributes.type,n=this.states,i=n.state,s=n.speed,r=n.selectionType,a=n.chartType,o=(0,sV.zs)(this.attributes,"controller"),l=this,h=(0,sF.pi)((0,sF.pi)((0,sF.pi)({},t),{iconSize:20,speed:s,state:i,selectionType:r,chartType:a,onChange:function(t,e){var n=e.value;switch(t){case"reset":l.internalReset();break;case"speed":l.handleSpeedChange(n);break;case"backward":l.internalBackward();break;case"playPause":"play"===n?l.internalPlay():l.internalPause();break;case"forward":l.internalForward();break;case"selectionType":l.handleSelectionTypeChange(n);break;case"chartType":l.handleChartTypeChange(n)}}}),o);"time"===e&&(h.functions=[["reset","speed"],["backward","playPause","forward"],["selectionType"]]),this.controller.update(h)},e.prototype.dispatchOnChange=function(t){var e=this.data,n=this.attributes.onChange,i=this.states,s=i.values,r=i.selectionType,a=(0,sF.CR)(s,2),o=a[0],l=a[1],h=l===1/0?e.at(-1).time:l,c="range"===r?[o,h]:h;(!t||(Array.isArray(t)?!Array.isArray(c)||t[0]!==c[0]||t[1]!==c[1]&&t[1]!==1/0&&c[1]!==1/0:Array.isArray(c)||t!==c))&&null!=n&&n("range"===r?[o,h]:h)},e.prototype.internalReset=function(t){var e,n,i=this.states.selectionType;this.internalPause(),this.setBySliderValues("range"===i?[0,1]:[0,0]),this.renderController(),this.updateSelection(),t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onReset)||void 0===n||n.call(e),this.dispatchOnChange())},e.prototype.reset=function(){this.internalReset()},e.prototype.moveSelection=function(t,e){var n,i,s,r,a,o,l=this.data,h=l.length,c=this.states,d=c.values,u=c.selectionType,p=c.playMode,g=(0,sF.CR)(d,2),f=g[0],y=g[1],m=l.findIndex(function(t){return t.time===f}),v=l.findIndex(function(t){return t.time===y});-1===v&&(v=h);var b="backward"===t?-1:1;"range"===u?"acc"===p?(o=[m,v+b],-1===b&&m===v&&(o=[m,h])):o=[m+b,v+b]:o=[m,v+b];var E=(n=o,s=(i=(0,sF.CR)(n.sort(function(t,e){return t-e}),2))[0],r=i[1],a=function(t){return(0,sj.Z)(t,0,h)},r>h?"value"===u?[0,0]:"acc"===p?[a(s),a(s)]:[0,a(r-s)]:s<0?"acc"===p?[0,a(r)]:[a(s+h-r),h]:[a(s),a(r)]);return this.setByIndex(E),this.updateSelection(),E},e.prototype.internalBackward=function(t){var e,n,i=this.moveSelection("backward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onBackward)||void 0===n||n.call(e),this.dispatchOnChange()),i},e.prototype.backward=function(){this.internalBackward()},e.prototype.internalPlay=function(t){var e,n,i=this,s=this.data,r=this.attributes.loop,a=this.states.speed,o=void 0===a?1:a;this.playInterval=window.setInterval(function(){i.internalForward()[1]!==s.length||r||(i.internalPause(),i.renderController())},1e3/o),this.states.state="play",t||null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPlay)||void 0===n||n.call(e)},e.prototype.play=function(){this.internalPlay()},e.prototype.internalPause=function(t){var e,n;clearInterval(this.playInterval),this.states.state="pause",t||null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPause)||void 0===n||n.call(e)},e.prototype.pause=function(){this.internalPause()},e.prototype.internalForward=function(t){var e,n,i=this.moveSelection("forward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onForward)||void 0===n||n.call(e),this.dispatchOnChange()),i},e.prototype.forward=function(){this.internalForward()},e.prototype.handleSpeedChange=function(t){var e,n;this.states.speed=t,"play"===this.states.state&&(this.internalPause(!0),this.internalPlay(!0)),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSpeedChange)||void 0===n||n.call(e,t)},e.prototype.handleSelectionTypeChange=function(t){var e,n;this.states.selectionType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSelectionTypeChange)||void 0===n||n.call(e,t)},e.prototype.handleChartTypeChange=function(t){var e,n;this.states.chartType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onChartTypeChange)||void 0===n||n.call(e,t)},e.prototype.render=function(){var t=this.space,e=t.axisBBox,n=t.controllerBBox,i=t.timelineBBox;this.renderController(n),this.renderAxis(e),this.renderChart(i),"play"===this.states.state&&this.internalPlay()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.internalPause(!0)},e.defaultOptions={style:{x:0,y:0,axisLabelFill:"#6e6e6e",axisLabelTextAlign:"left",axisLabelTextBaseline:"top",axisLabelTransform:"translate(5, -12)",axisLineLineWidth:1,axisLineStroke:"#cacdd1",axisTickLength:15,axisTickLineWidth:1,axisTickStroke:"#cacdd1",chartShowLabel:!1,chartType:"line",controllerAlign:"center",controllerHeight:40,data:[],interval:"day",loop:!1,playMode:"acc",selectionType:"range",type:"time"}},e}(sz.w);let rb=["timestamp","time","date","datetime"];class rE extends iV{get padding(){return tw(this.options.padding)}play(){var t;null===(t=this.timebar)||void 0===t||t.play()}pause(){var t;null===(t=this.timebar)||void 0===t||t.pause()}forward(){var t;null===(t=this.timebar)||void 0===t||t.forward()}backward(){var t;null===(t=this.timebar)||void 0===t||t.backward()}reset(){var t;null===(t=this.timebar)||void 0===t||t.reset()}update(t){super.update(t),this.backup(),Object.keys(t).forEach(t=>{"position"===t?this.upsertWrapper():this.upsertTimebar()})}backup(){this.originalData=rx(this.context.graph.getData())}upsertTimebar(){let{canvas:t}=this.context,{onChange:e,timebarType:n,data:i,x:s,y:r,width:a,height:o,mode:l,...h}=this.options,c=t.getSize(),[d]=this.padding;this.upsertCanvas().ready.then(()=>{let t={x:c[0]/2-a/2,y:d,onChange:t=>{let n=(ti(t)?t:[t,t]).map(t=>z(t,"Date")?t.getTime():t);"modify"===this.options.mode?this.filterElements(n):this.hiddenElements(n),null==e||e(n)},...h,data:i.map(t=>el(t)?{time:t,value:0}:t),width:a,height:o,type:n};if(this.timebar)this.timebar.update(t);else{var s;this.timebar=new rv({style:t}),null===(s=this.canvas)||void 0===s||s.appendChild(this.timebar)}})}upsertWrapper(){var t;if(!this.wrapper){let t=document.createElement("div");t.style.position="absolute",this.wrapper=t}let{x:e,y:n,className:i,position:s}=this.options;return i&&(this.wrapper.className=i),el(e)||el(n)?Object.assign(this.wrapper.style,{left:"".concat(null!=e?e:0,"px"),top:"".concat(null!=n?n:0,"px")}):Object.assign(this.wrapper.style,{["top"===s?"bottom":"top"]:"unset",["top"===s?"top":"bottom"]:"0px"}),null===(t=this.context.canvas.getContainer())||void 0===t||t.appendChild(this.wrapper),this.wrapper}upsertCanvas(){var t,e;let n=this.upsertWrapper();if(this.canvas)return this.canvas;let{height:i}=this.options,[s]=this.context.canvas.getSize(),[r,,a]=this.padding;return this.canvas=new N.Xz({container:n,width:s,height:i+r+a,renderer:(null===(e=(t=this.context.options).renderer)||void 0===e?void 0:e.call(t,"main"))||new sA.Th,supportsMutipleCanvasesInOneContainer:!0}),this.canvas}async filterElements(t){var e;if(!this.originalData)return;let{elementTypes:n,getTime:i}=this.options,{graph:s,element:r}=this.context,a=rx(this.originalData);n.forEach(e=>{let n="".concat(e,"s");a[n]=(this.originalData[n]||[]).filter(e=>{let n=i(e);return!!rw(n,t)})});let o=[...a.nodes,...a.combos].map(t=>ta(t));a.edges=a.edges.filter(t=>{let e=t.source,n=t.target;return o.includes(e)&&o.includes(n)}),s.setData(a),await (null===(e=r.draw({animation:!1,silence:!0}))||void 0===e?void 0:e.finished)}hiddenElements(t){let{graph:e}=this.context,{elementTypes:n,getTime:i}=this.options,s=[],r=[];n.forEach(e=>{var n;let a=(null===(n=this.originalData)||void 0===n?void 0:n["".concat(e,"s")])||[];a.forEach(e=>{let n=ta(e),a=i(e);rw(a,t)?r.push(n):s.push(n)})}),e.hideElement(s,!1),e.showElement(r,!1)}destroy(){var t,e,n;let{graph:i}=this.context;this.originalData&&i.setData({...this.originalData}),null===(t=this.timebar)||void 0===t||t.destroy(),null===(e=this.canvas)||void 0===e||e.destroy(),null===(n=this.wrapper)||void 0===n||n.remove(),this.originalData=void 0,this.wrapper=void 0,this.timebar=void 0,this.canvas=void 0,super.destroy()}constructor(t,e){super(t,Object.assign({},rE.defaultOptions,e)),this.backup(),this.upsertTimebar()}}rE.defaultOptions={position:"bottom",enable:!0,timebarType:"time",className:"g6-timebar",width:450,height:60,zIndex:3,elementTypes:["node"],padding:10,mode:"modify",getTime:t=>rS(t,rb,void 0),loop:!1};let rx=t=>{let{nodes:e=[],edges:n=[],combos:i=[]}=t;return{nodes:[...e],edges:[...n],combos:[...i]}},rw=(t,e)=>{if(el(e))return t===e;let[n,i]=e;return t>=n&&t<=i},rS=(t,e,n)=>{for(let n=0;n<e.length;n++){var i;let s=e[n],r=null===(i=t.data)||void 0===i?void 0:i[s];if(r)return r}return n};class rC extends iV{async update(t){super.update(t);let{className:e,position:n,style:i}=this.options;this.$element.className="g6-toolbar ".concat(e||""),Object.assign(this.$element.style,i,function(t){let e={top:"unset",right:"unset",bottom:"unset",left:"unset"},n=t.split("-");return n.forEach(t=>{e[t]="8px"}),e.flexDirection=t.startsWith("top")||t.startsWith("bottom")?"row":"column",e}(n)),this.$element.innerHTML=await this.getDOMContent()}destroy(){this.$element.removeEventListener("click",this.onToolbarItemClick),this.$element.remove(),super.destroy()}async getDOMContent(){let t=await this.options.getItems();return t.map(t=>'\n          <div class="g6-toolbar-item" value="'.concat(t.value,'">\n            <svg aria-hidden="true" focusable="false">\n              <use xlink:href="#').concat(t.id,'"></use>\n            </svg>\n          </div>')).join("")}constructor(t,e){super(t,Object.assign({},rC.defaultOptions,e)),this.$element=iH("toolbar",!1),this.onToolbarItemClick=t=>{let{onClick:e}=this.options;if(t.target instanceof Element&&t.target.className.includes("g6-toolbar-item")){let n=t.target.getAttribute("value");null==e||e(n,t.target)}};let n=this.context.canvas.getContainer();this.$element.style.display="flex",n.appendChild(this.$element),iW("g6-toolbar-css","style",{},"\n  .g6-toolbar {\n    position: absolute;\n    z-index: 100;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.1);\n    opacity: 0.65;\n  }\n  .g6-toolbar .g6-toolbar-item {\n    display: inline-block;\n    width: 16px;\n    height: 16px;\n    padding: 4px;\n    cursor: pointer;\n    box-sizing: content-box;\n  }\n\n  .g6-toolbar .g6-toolbar-item:hover {\n    background-color: #f0f0f0;\n  }\n\n  .g6-toolbar .g6-toolbar-item svg {\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n  }\n",document.head),iW("g6-toolbar-svgicon","div",{display:"none"},'\n  <svg>\n    <symbol id="zoom-in" viewBox="64 64 896 896">\n      <path d="M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="zoom-out" viewBox="64 64 896 896">\n      <path d="M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="edit" viewBox="64 64 896 896">\n      <path d="M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"></path>\n    </symbol>\n    <symbol id="delete" viewBox="64 64 896 896">\n      <path d="M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"></path>\n    </symbol>\n    <symbol id="redo" viewBox="64 64 896 896">\n      <path d="M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"></path>\n    </symbol>\n    <symbol id="undo" viewBox="64 64 896 896">\n      <path d="M511.4 124C290.5 124.3 112 303 112 523.9c0 128 60.2 242 153.8 315.2l-37.5 48c-4.1 5.3-.3 13 6.3 12.9l167-.8c5.2 0 9-4.9 7.7-9.9L369.8 727a8 8 0 00-14.1-3L315 776.1c-10.2-8-20-16.7-29.3-26a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-7.5 7.5-15.3 14.5-23.4 21.2a7.93 7.93 0 00-1.2 11.1l39.4 50.5c2.8 3.5 7.9 4.1 11.4 1.3C854.5 760.8 912 649.1 912 523.9c0-221.1-179.4-400.2-400.6-399.9z"></path>\n    </symbol>\n    <symbol id="export" viewBox="64 64 896 896">\n      <path d="M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"></path>\n    </symbol>\n    <symbol id="auto-fit" viewBox="64 64 896 896">\n      <path d="M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"></path>\n      <path d="M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"></path>\n    </symbol>\n    <symbol id="reset" viewBox="64 64 896 896">\n      <path d="M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"></path>\n    </symbol>\n    <symbol id="exit-fullscreen" viewBox="0 0 1024 1024">\n      <path d="M418.13333333 361.43786666c0 0.2048-0.13653333 0.4096-0.13653334 0.68266667C417.99679999 362.32533333 418.13333333 362.53013333 418.13333333 362.73493333 418.13333333 371.54133333 414.44693333 379.392 408.78079999 385.39946666 408.43946666 385.7408 408.30293333 386.21866666 408.02986666 386.49173333c-1.09226667 1.09226667-2.59413333 1.77493333-3.82293333 2.73066667C398.40426666 393.65973333 391.64586666 396.8 383.93173333 396.8 383.72693333 396.8 383.59039999 396.73173333 383.38559999 396.73173333S382.97599999 396.8 382.77119999 396.8L112.29866666 396.8C92.50133333 396.8 76.79999999 381.50826666 76.79999999 362.66666666 76.66346666 343.89333333 92.63786666 328.53333333 112.16213333 328.53333333l189.44 0L87.44959999 114.51733333C73.59146666 100.59093333 73.25013333 78.5408 86.63039999 65.29706666c13.17546667-13.44853333 35.36213333-12.97066667 49.152 0.88746667l214.08426667 214.08426667L349.86666666 90.89706666C349.79839999 71.23626666 365.22666666 55.46666666 383.99999999 55.46666666 402.77333333 55.33013333 418.13333333 71.30453333 418.13333333 90.8288L418.13333333 361.43786666zM928.90453333 328.53333333l-189.44 0 214.15253333-214.08426667c13.85813333-13.9264 14.19946667-35.90826667 0.88746667-49.22026666-13.17546667-13.44853333-35.36213333-12.97066667-49.152 0.88746666l-214.08426667 214.08426667L691.26826666 90.89706666C691.26826666 71.23626666 675.83999999 55.46666666 657.06666666 55.46666666 638.29333333 55.33013333 622.93333333 71.30453333 622.93333333 90.8288l0 270.60906666c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 362.32533333 622.93333333 362.53013333 622.93333333 362.73493333 622.93333333 371.54133333 626.61973333 379.392 632.28586666 385.39946666c0.34133333 0.34133333 0.47786667 0.8192 0.8192 1.09226667 1.09226667 1.09226667 2.59413333 1.77493333 3.8912 2.73066667C642.66239999 393.65973333 649.42079999 396.8 657.13493333 396.8c0.2048 0 0.34133333-0.06826667 0.54613333-0.06826667S658.09066666 396.8 658.29546666 396.8l270.5408 0C948.56533333 396.8 964.26666666 381.50826666 964.26666666 362.66666666 964.40319999 343.89333333 948.42879999 328.53333333 928.90453333 328.53333333zM418.13333333 635.73333333c0-8.8064-3.6864-16.5888-9.35253334-22.66453333C408.43946666 612.72746666 408.30293333 612.2496 408.02986666 611.90826666 406.86933333 610.88426666 405.43573333 610.2016 404.20693333 609.24586666 398.47253333 604.80853333 391.64586666 601.6 383.93173333 601.6 383.72693333 601.6 383.59039999 601.73653333 383.38559999 601.73653333S382.97599999 601.6 382.77119999 601.6L112.29866666 601.6C92.50133333 601.6 76.79999999 616.96 76.79999999 635.73333333 76.66346666 654.50666666 92.63786666 669.86666666 112.16213333 669.86666666l189.44 0-214.15253334 214.15253334c-13.85813333 13.85813333-14.19946667 35.84-0.88746666 49.22026666 13.17546667 13.44853333 35.36213333 12.9024 49.152-0.95573333l214.08426666-214.08426667 0 189.37173334c0 19.59253333 15.42826667 35.49866667 34.2016 35.36213333C402.77333333 943.2064 418.13333333 927.232 418.13333333 907.5712L418.13333333 637.09866666c0-0.27306667-0.13653333-0.47786667-0.13653334-0.68266666C417.99679999 636.14293333 418.13333333 635.93813333 418.13333333 635.73333333zM739.46453333 669.86666666l189.44 0c19.456 0 35.49866667-15.36 35.36213333-34.13333333C964.26666666 616.96 948.56533333 601.6 928.76799999 601.6L658.29546666 601.6C658.09066666 601.6 657.88586666 601.73653333 657.68106666 601.73653333S657.33973333 601.6 657.13493333 601.6C649.42079999 601.6 642.59413333 604.80853333 636.85973333 609.24586666 635.63093333 610.2016 634.19733333 610.88426666 633.03679999 611.90826666 632.76373333 612.2496 632.62719999 612.72746666 632.28586666 613.0688 626.61973333 619.14453333 622.93333333 626.92693333 622.93333333 635.73333333c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 636.6208 622.93333333 636.8256 622.93333333 637.09866666l0 270.5408C622.93333333 927.232 638.29333333 943.2064 657.06666666 942.93333333c18.77333333 0.13653333 34.2016-15.70133333 34.2016-35.36213333l0-189.37173334 214.08426667 214.08426667c13.78986667 13.85813333 35.90826667 14.40426667 49.152 0.95573333 13.312-13.312 12.97066667-35.36213333-0.88746667-49.22026666L739.46453333 669.86666666z"  ></path></symbol>\n    <symbol id="request-fullscreen" viewBox="0 0 1024 1024">\n      <path d="M69.818182 87.598545v273.128728a34.909091 34.909091 0 0 0 69.818182 0V163.653818l221.928727 222.021818a33.512727 33.512727 0 0 0 47.383273-47.383272L186.926545 116.363636h197.073455a34.909091 34.909091 0 0 0 0-69.818181H110.871273C85.364364 46.545455 69.818182 59.671273 69.818182 87.598545zM938.542545 46.545455H665.413818a34.909091 34.909091 0 0 0 0 69.818181h197.073455L640.465455 338.292364a33.512727 33.512727 0 0 0 47.383272 47.383272l221.928728-222.021818v197.073455a34.909091 34.909091 0 0 0 69.818181 0V87.598545c0-27.927273-15.453091-41.053091-40.96-41.05309z m-827.671272 907.636363h273.128727a34.909091 34.909091 0 0 0 0-69.818182H186.926545l222.021819-221.928727a33.512727 33.512727 0 0 0-47.383273-47.383273L139.636364 837.073455V640a34.909091 34.909091 0 0 0-69.818182 0v273.128727c0 27.927273 15.546182 41.053091 41.053091 41.053091z m868.724363-41.053091V640a34.909091 34.909091 0 0 0-69.818181 0v197.073455L687.941818 615.051636a33.512727 33.512727 0 0 0-47.383273 47.383273L862.487273 884.363636H665.413818a34.909091 34.909091 0 0 0 0 69.818182h273.128727c25.6 0 41.053091-13.125818 41.053091-41.053091z"  ></path></symbol>\n  </svg>\n'),this.$element.addEventListener("click",this.onToolbarItemClick),this.update(e)}}rC.defaultOptions={position:"top-left"};var rO=n(68787);class rD extends iV{getEvents(){return"click"===this.options.trigger?{"node:click":this.onClick,"edge:click":this.onClick,"combo:click":this.onClick,"canvas:click":this.onPointerLeave,contextmenu:this.onPointerLeave,drag:this.onPointerLeave}:{"node:pointerenter":this.onPointerEnter,"node:pointermove":this.onPointerMove,"canvas:pointermove":this.onCanvasMove,"edge:pointerenter":this.onPointerEnter,"edge:pointermove":this.onPointerMove,"combo:pointerenter":this.onPointerEnter,"combo:pointermove":this.onPointerMove,contextmenu:this.onPointerLeave,"node:drag":this.onPointerLeave}}update(t){if(this.unbindEvents(),super.update(t),this.tooltipElement){var e;null===(e=this.container)||void 0===e||e.removeChild(this.tooltipElement.HTMLTooltipElement)}this.tooltipElement=this.initTooltip(),this.bindEvents()}render(){let{canvas:t}=this.context,e=t.getContainer();e&&(this.container=e,this.tooltipElement=this.initTooltip())}unbindEvents(){let{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach(n=>{t.off(n,e[n])})}bindEvents(){let{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach(n=>{t.on(n,e[n])})}destroy(){if(this.unbindEvents(),this.tooltipElement){var t;null===(t=this.container)||void 0===t||t.removeChild(this.tooltipElement.HTMLTooltipElement)}super.destroy()}constructor(t,e){super(t,Object.assign({},rD.defaultOptions,e)),this.currentTarget=null,this.tooltipElement=null,this.container=null,this.isEnable=t=>{let{enable:e}=this.options;return"function"==typeof e?e(t):e},this.onClick=t=>{let{target:{id:e}}=t;this.currentTarget===e?(this.currentTarget=null,this.hide(t)):(this.currentTarget=e,this.show(t))},this.onPointerMove=t=>{let{target:e}=t;this.currentTarget&&e.id!==this.currentTarget&&this.show(t)},this.onPointerLeave=t=>{this.hide(t),this.currentTarget=null},this.onCanvasMove=t=>{this.hide(t),this.currentTarget=null},this.onPointerEnter=t=>{this.show(t)},this.showById=t=>{this.show({target:{id:t}})},this.getElementData=(t,e)=>{let{model:n}=this.context;switch(e){case"node":return n.getNodeData([t]);case"edge":return n.getEdgeData([t]);case"combo":return n.getComboData([t]);default:return[]}},this.show=t=>{let e,n;let{client:i,target:{id:s}}=t;if(ie(t.target)||!this.tooltipElement||!this.isEnable(t))return;let r=this.context.graph.getElementType(s),{getContent:a,title:o}=this.options;this.currentTarget=s;let l=this.getElementData(s,r);if(i)e=i.x,n=i.y;else{let t=eo(l,"0.style",{x:0,y:0});e=t.x,n=t.y}let h={};if(a)h.content=a(t,l);else{let t=this.context.graph.getElementRenderStyle(s),e="node"===r?t.fill:t.stroke;h={title:o||r,data:l.map(t=>({name:"ID",value:t.id||"".concat(t.source," -> ").concat(t.target),color:e}))}}this.tooltipElement.update({x:e,y:n,style:{".tooltip":{visibility:"visible"}},...h})},this.hide=t=>{if(!t){var e;null===(e=this.tooltipElement)||void 0===e||e.hide();return}if(!this.tooltipElement||!this.isEnable(t))return;let{client:{x:n,y:i}}=t;this.tooltipElement.hide(n,i)},this.initTooltip=()=>{var t;let{canvas:e}=this.context,{center:n}=e.getBounds(),i=e.getContainer(),{top:s,left:r}=i.getBoundingClientRect(),{style:a,position:o,enterable:l,container:h={x:-r,y:-s},title:c,offset:d}=this.options,[u,p]=n,[g,f]=e.getSize(),y=new rO.u({className:"tooltip",style:{x:u,y:p,container:h,title:c,bounding:{x:0,y:0,width:g,height:f},position:o,enterable:l,offset:d,style:a}});return null===(t=this.container)||void 0===t||t.appendChild(y.HTMLTooltipElement),y},this.render(),this.bindEvents()}}function rT(t,e){i||(i=document.createElement("canvas")),i.width=t,i.height=e;let n=i.getContext("2d");return n.clearRect(0,0,t,e),i}async function rM(t,e,n,i){let s=rT(t,e),r=s.getContext("2d"),{rotate:a,opacity:o,textFill:l,textFontSize:h,textFontFamily:c,textFontVariant:d,textFontWeight:u,textAlign:p,textBaseline:g}=i;return r.textAlign=p,r.textBaseline=g,r.translate(t/2,e/2),r.font="".concat(h,"px ").concat(c," ").concat(d," ").concat(u),a&&r.rotate(a),o&&(r.globalAlpha=o),l&&(r.fillStyle=l,r.fillText("".concat(n),0,0)),s.toDataURL()}async function rA(t,e,n,i){let s=rT(t,e),r=s.getContext("2d"),{rotate:a,opacity:o}=i;a&&r.rotate(a),o&&(r.globalAlpha=o);let l=new Image;return l.crossOrigin="anonymous",l.src=n,new Promise(n=>{l.onload=function(){let i=t>l.width?(t-l.width)/2:0,a=e>l.height?(e-l.height)/2:0;r.drawImage(l,0,0,l.width,l.height,i,a,t-2*i,e-2*a),n(s.toDataURL())}})}rD.defaultOptions={trigger:"hover",position:"top-right",enterable:!1,enable:!0,offset:[10,10],style:{".tooltip":{visibility:"hidden"}}};class rR extends iV{async update(t){super.update(t);let{width:e,height:n,text:i,imageURL:s,...r}=this.options;Object.keys(r).forEach(e=>{e.startsWith("background")&&(this.$element.style[e]=t[e])});let a=s?await rA(e,n,s,r):await rM(e,n,i,r);this.$element.style.backgroundImage="url(".concat(a,")")}destroy(){super.destroy(),this.$element.remove()}constructor(t,e){super(t,Object.assign({},rR.defaultOptions,e)),this.$element=iH("watermark");let n=this.context.canvas.getContainer();n.appendChild(this.$element),this.update(e)}}rR.defaultOptions={width:200,height:100,opacity:.2,rotate:Math.PI/12,text:"",textFill:"#000",textFontSize:16,textAlign:"center",textBaseline:"middle",backgroundRepeat:"repeat"};let rk=["#7E92B5","#F4664A","#FFBE3A"],rP={type:"group",color:["#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]},rN={type:"group",color:["#99ADD1","#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]};function rL(t){let{bgColor:e,textColor:n,nodeColor:i,nodeColorDisabled:s,nodeStroke:r,nodeHaloStrokeOpacityActive:a=.15,nodeHaloStrokeOpacitySelected:o=.25,nodeOpacityDisabled:l=.06,nodeIconOpacityInactive:h=.85,nodeOpacityInactive:c=.25,nodeBadgePalette:d=rk,nodePaletteOptions:u=rP,edgeColor:p,edgeColorDisabled:g,edgePaletteOptions:f=rN,comboColor:y,comboColorDisabled:m,comboStroke:v,comboStrokeDisabled:b,edgeColorInactive:E}=t;return{background:e,node:{palette:u,style:{donutOpacity:1,badgeBackgroundOpacity:1,badgeFill:"#fff",badgeFontSize:8,badgePadding:[0,4],badgePalette:d,fill:i,fillOpacity:1,halo:!1,iconFill:"#fff",iconOpacity:1,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelFill:n,labelFillOpacity:.85,labelLineHeight:16,labelPadding:[0,2],labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelOffsetY:2,lineWidth:0,portFill:i,portLineWidth:1,portStroke:r,portStrokeOpacity:.65,size:32,stroke:r,strokeOpacity:1,zIndex:2},state:{selected:{halo:!0,haloLineWidth:24,haloStrokeOpacity:o,labelFontSize:12,labelFontWeight:"bold",lineWidth:4,stroke:r},active:{halo:!0,haloLineWidth:12,haloStrokeOpacity:a},highlight:{labelFontWeight:"bold",lineWidth:4,stroke:r,strokeOpacity:.85},inactive:{badgeBackgroundOpacity:c,donutOpacity:c,fillOpacity:c,iconOpacity:h,labelFill:n,labelFillOpacity:c,strokeOpacity:c},disabled:{badgeBackgroundOpacity:.25,donutOpacity:l,fill:s,fillOpacity:l,iconFill:s,iconOpacity:.25,labelFill:n,labelFillOpacity:.25,strokeOpacity:l}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"node-expand",collapse:"node-collapse",update:[{fields:["x","y","fill","stroke"]}],translate:[{fields:["x","y"]}]}},edge:{palette:f,style:{badgeBackgroundFill:p,badgeFill:"#fff",badgeFontSize:8,badgeOffsetX:10,fillOpacity:1,halo:!1,haloLineWidth:12,haloStrokeOpacity:1,increasedLineWidthForHitTesting:2,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[4,4,4,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelPlacement:"center",labelTextBaseline:"middle",lineWidth:1,stroke:p,strokeOpacity:1,zIndex:1},state:{selected:{halo:!0,haloStrokeOpacity:.25,labelFontSize:14,labelFontWeight:"bold",lineWidth:3},active:{halo:!0,haloStrokeOpacity:.15},highlight:{labelFontWeight:"bold",lineWidth:3},inactive:{stroke:E,fillOpacity:.08,labelOpacity:.25,strokeOpacity:.08,badgeBackgroundOpacity:.25},disabled:{stroke:g,fillOpacity:.45,strokeOpacity:.45,labelOpacity:.25,badgeBackgroundOpacity:.45}},animation:{enter:"fade",exit:"fade",expand:"path-in",collapse:"path-out",show:"fade",hide:"fade",update:[{fields:["sourceNode","targetNode"]},{fields:["stroke"],shape:"key"}],translate:[{fields:["sourceNode","targetNode"]}]}},combo:{style:{collapsedMarkerFill:e,collapsedMarkerFontSize:12,collapsedMarkerFillOpacity:1,collapsedSize:32,collapsedFillOpacity:1,fill:y,halo:!1,haloLineWidth:12,haloStroke:v,haloStrokeOpacity:.25,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[2,4,2,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,lineDash:0,lineWidth:1,fillOpacity:.04,strokeOpacity:1,padding:10,stroke:v},state:{selected:{halo:!0,labelFontSize:14,labelFontWeight:700,lineWidth:4},active:{halo:!0},highlight:{labelFontWeight:700,lineWidth:4},inactive:{fillOpacity:.65,labelOpacity:.25,strokeOpacity:.65},disabled:{fill:m,fillOpacity:.25,labelOpacity:.25,stroke:b,strokeOpacity:.25}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"combo-expand",collapse:"combo-collapse",update:[{fields:["x","y"]},{fields:["fill","stroke","lineWidth"],shape:"key"}],translate:[{fields:["x","y"]}]}}}}let rI=rL({bgColor:"#000000",comboColor:"#fdfdfd",comboColorDisabled:"#d0e4ff",comboStroke:"#99add1",comboStrokeDisabled:"#969696",edgeColor:"#637088",edgeColorDisabled:"#637088",edgeColorInactive:"#D0E4FF",edgePaletteOptions:{type:"group",color:["#637088","#0F55A6","#008383","#9C5D38","#8B53A6","#4E40A6","#8F6608","#3E801D","#A65383","#175E75","#0F8248"]},nodeColor:"#1783ff",nodeColorDisabled:"#D0E4FF",nodeHaloStrokeOpacityActive:.25,nodeHaloStrokeOpacitySelected:.45,nodeIconOpacityInactive:.45,nodeOpacityDisabled:.25,nodeOpacityInactive:.45,nodeStroke:"#d0e4ff",textColor:"#ffffff"}),rB=rL({bgColor:"#ffffff",comboColor:"#99ADD1",comboColorDisabled:"#f0f0f0",comboStroke:"#99add1",comboStrokeDisabled:"#d9d9d9",edgeColor:"#99add1",edgeColorDisabled:"#d9d9d9",edgeColorInactive:"#1B324F",nodeColor:"#1783ff",nodeColorDisabled:"#1B324F",nodeHaloStrokeOpacityActive:.15,nodeHaloStrokeOpacitySelected:.25,nodeIconOpacityInactive:.85,nodeOpacityDisabled:.06,nodeOpacityInactive:.25,nodeStroke:"#000000",textColor:"#000000"});class r_ extends ty{beforeDraw(t,e){return t}}function rF(t,e,n,i,s){let r=ta(i),a="".concat(n,"s"),o=s?i:t.add[a].get(r)||t.update[a].get(r)||t.remove[a].get(r)||i;Object.entries(t).forEach(t=>{let[n,i]=t;e===n?i[a].set(r,o):i[a].delete(r)})}let rj=(t,e,n,i)=>{let s="".concat(n,"s"),r=ta(i);t.add[s].has(r)||t.update[s].has(r)||t[e][s].set(ta(i),i)};class rz{constructor(t){this.type=t}}class rH extends rz{constructor(t,e){super(t),this.data=e}}class rW extends rz{constructor(t,e,n,i){super(t),this.animationType=e,this.animation=n,this.data=i}}class rV extends rz{constructor(t,e,n){super(t),this.elementType=e,this.data=n}}class rG extends rz{constructor(t,e){super(t),this.data=e}}function rY(t,e){t.emit(e.type,e)}class rU{getTasks(){let t=[...this.tasks];return this.tasks=[],t}add(t,e){this.tasks.push([t,e])}animate(t,e,n){var i,s,r;null==e||null===(i=e.before)||void 0===i||i.call(e);let a=this.getTasks().map(e=>{var i,s,r;let[a,o]=e,{element:l,elementType:h,stage:c}=a,d=function(t,e,n,i){var s,r;let{animation:a}=t,o=null==t?void 0:null===(s=t[e])||void 0===s?void 0:s.animation;if(!1===o)return[];let l=null==o?void 0:o[n];if(!1===l||!1===a||!1===i)return[];let h=null===(r=J(t)[e])||void 0===r?void 0:r.animation,c=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(function(t){if("string"==typeof t){let e=X(M.ANIMATION,t);return e||(q.warn("The animation of ".concat(t," is not registered.")),[])}return t})(t).map(t=>({...Y,...V(a)&&a,...t,...V(i)&&i}))};if(l)return c(l);if(!h)return[];let d=h[n];return!1===d?[]:c(d)}(this.context.options,h,c,t);null==o||null===(i=o.before)||void 0===i||i.call(o);let u=tc(l,this.inferStyle(a,n),d);return u?(null==o||null===(r=o.beforeAnimate)||void 0===r||r.call(o,u),u.finished.then(()=>{var t,e;null==o||null===(t=o.afterAnimate)||void 0===t||t.call(o,u),null==o||null===(e=o.after)||void 0===e||e.call(o),this.animations.delete(u)})):null==o||null===(s=o.after)||void 0===s||s.call(o),u}).filter(Boolean);a.forEach(t=>this.animations.add(t));let o=Q(a);return o?(null==e||null===(r=e.beforeAnimate)||void 0===r||r.call(e,o),o.finished.then(()=>{var t,n;null==e||null===(t=e.afterAnimate)||void 0===t||t.call(e,o),null==e||null===(n=e.after)||void 0===n||n.call(e),this.release()})):null==e||null===(s=e.after)||void 0===s||s.call(e),o}inferStyle(t,e){var n;let{element:i,elementType:s,stage:r,originalStyle:a,modifiedStyle:o}=t,l={...a},h={...o},c=()=>null!==(n=ex(i,"opacity"))&&void 0!==n?n:te("opacity");if("enter"===r)Object.assign(l,{opacity:0});else if("exit"===r)Object.assign(h,{opacity:0});else if("show"===r)Object.assign(l,{opacity:0}),Object.assign(h,{opacity:c()});else if("hide"===r)Object.assign(l,{opacity:c()}),Object.assign(h,{opacity:0});else if("collapse"===r){let{collapse:t}=e||{},{target:n,descendants:r,position:a}=t;if("node"===s){if(r.includes(i.id)){let[t,e,n]=a;Object.assign(h,{x:t,y:e,z:n})}}else if("combo"===s){if(i.id===n||r.includes(i.id)){let[t,e]=a;Object.assign(h,{x:t,y:e,childrenNode:l.childrenNode})}}else"edge"===s&&Object.assign(h,{sourceNode:l.sourceNode,targetNode:l.targetNode})}else if("expand"===r){let{expand:t}=e||{},{target:n,descendants:r,position:a}=t;if("node"===s){if(i.id===n||r.includes(i.id)){let[t,e,n]=a;Object.assign(l,{x:t,y:e,z:n})}}else if("combo"===s){if(i.id===n||r.includes(i.id)){let[t,e,n]=a;Object.assign(l,{x:t,y:e,z:n,childrenNode:h.childrenNode})}}else"edge"===s&&Object.assign(l,{sourceNode:h.sourceNode,targetNode:h.targetNode})}return[l,h]}stop(){this.animations.forEach(t=>t.cancel())}clear(){this.tasks=[]}release(){var t,e;let{canvas:n}=this.context,i=null===(t=n.document)||void 0===t?void 0:null===(e=t.timeline)||void 0===e?void 0:e.animationsWithPromises;i&&(n.document.timeline.animationsWithPromises=i.filter(t=>"finished"!==t.playState))}destroy(){this.stop(),this.animations.clear(),this.tasks=[]}constructor(t){this.tasks=[],this.animations=new Set,this.context=t}}class rK{emit(t){let{graph:e}=this.context;e.emit(t.type,t)}startBatch(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.batchCount++,1===this.batchCount&&this.emit(new rH(O.BATCH_START,{initiate:t}))}endBatch(){this.batchCount--,0===this.batchCount&&this.emit(new rH(O.BATCH_END))}get isBatching(){return this.batchCount>0}destroy(){this.context=null}constructor(t){this.batchCount=0,this.context=t}}class rZ extends tf{setBehaviors(t){this.setExtensions(t)}forwardEvents(){let t=this.context.canvas.getContainer();t&&[S.KEY_DOWN,S.KEY_UP].forEach(e=>{t.addEventListener(e,this.forwardContainerEvents)});let e=this.context.canvas.document;e&&[w.CLICK,w.DBLCLICK,w.POINTER_OVER,w.POINTER_LEAVE,w.POINTER_ENTER,w.POINTER_MOVE,w.POINTER_OUT,w.POINTER_DOWN,w.POINTER_UP,w.CONTEXT_MENU,w.DRAG_START,w.DRAG,w.DRAG_END,w.DRAG_ENTER,w.DRAG_OVER,w.DRAG_LEAVE,w.DROP,w.WHEEL].forEach(t=>{e.addEventListener(t,this.forwardCanvasEvents)})}destroy(){let t=this.context.canvas.getContainer();t&&[S.KEY_DOWN,S.KEY_UP].forEach(e=>{t.removeEventListener(e,this.forwardContainerEvents)}),this.context.canvas.document.removeAllEventListeners(),super.destroy()}constructor(t){super(t),this.currentTarget=null,this.currentTargetType=null,this.category="behavior",this.forwardCanvasEvents=t=>{let{target:e}=t,n=function(t){if(!t)return null;if(t instanceof N.BB)return{type:"canvas",element:t};let e=t;for(;e;){if(nq(e))return{type:"node",element:e};if(nJ(e))return{type:"edge",element:e};if(nQ(e))return{type:"combo",element:e};e=e.parentElement}return null}(e);if(!n)return;let{graph:i,canvas:s}=this.context,{type:r,element:a}=n;if("destroyed"in a&&(ie(a)||a.destroyed))return;let{type:o,detail:l,button:h}=t,c={...t,target:a,targetType:r,originalTarget:e};o===w.POINTER_MOVE&&(this.currentTarget!==a&&(this.currentTarget&&i.emit("".concat(this.currentTargetType,":").concat(w.POINTER_LEAVE),{...c,type:w.POINTER_LEAVE,target:this.currentTarget}),a&&(Object.assign(c,{type:w.POINTER_ENTER}),i.emit("".concat(r,":").concat(w.POINTER_ENTER),c))),this.currentTarget=a,this.currentTargetType=r),o===w.CLICK&&2===h||(i.emit("".concat(r,":").concat(o),c),i.emit(o,c)),o===w.CLICK&&2===l&&(Object.assign(c,{type:w.DBLCLICK}),i.emit("".concat(r,":").concat(w.DBLCLICK),c),i.emit(w.DBLCLICK,c)),o===w.POINTER_DOWN&&2===h&&(Object.assign(c,{type:w.CONTEXT_MENU,preventDefault:()=>{var t;null===(t=s.getContainer())||void 0===t||t.addEventListener(w.CONTEXT_MENU,t=>t.preventDefault(),{once:!0})}}),i.emit("".concat(r,":").concat(w.CONTEXT_MENU),c),i.emit(w.CONTEXT_MENU,c))},this.forwardContainerEvents=t=>{this.context.graph.emit(t.type,t)},this.forwardEvents(),this.setBehaviors(this.context.options.behaviors||[])}}var rX=n(14378);let r$=["background","main","label","transient"];class rq{getConfig(){return this.config}getLayer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.extends.layers[t]}getLayers(){return this.extends.layers}getRenderer(t){return this.extends.renderers[t]}getCamera(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getCamera()}getRoot(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getRoot()}getContextService(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getContextService()}setCursor(t){this.config.cursor=t,this.getLayer().setCursor(t)}get document(){return this.getLayer().document}get context(){return this.getLayer().context}get ready(){return Promise.all(Object.entries(this.getLayers()).map(t=>{let[,e]=t;return e.ready}))}resize(t,e){Object.assign(this.extends.config,{width:t,height:e}),Object.values(this.getLayers()).forEach(n=>{let i=n.getCamera(),s=i.getPosition(),r=i.getFocalPoint();n.resize(t,e),i.setPosition(s),i.setFocalPoint(r)})}getBounds(t){return tM(Object.values(this.getLayers()).map(e=>{let n=t?e.getRoot().childNodes.find(e=>e.classList.includes(t)):e.getRoot();return n}).filter(t=>(null==t?void 0:t.childNodes.length)>0).map(t=>t.getBounds()))}getContainer(){let t=this.extends.config.container;return"string"==typeof t?document.getElementById(t):t}getSize(){return[this.extends.config.width||0,this.extends.config.height||0]}appendChild(t,e){var n;let i=(null===(n=t.style)||void 0===n?void 0:n.$layer)||"main";return this.getLayer(i).appendChild(t,e)}setRenderer(t){if(t===this.extends.renderer)return;let e=rJ(t);this.extends.renderers=e,Object.entries(e).forEach(t=>{let[e,n]=t;return this.getLayer(e).setRenderer(n)}),rQ(this.getLayers())}getCanvasByViewport(t){return tq(this.getLayer().viewport2Canvas(tJ(t)))}getViewportByCanvas(t){return tq(this.getLayer().canvas2Viewport(tJ(t)))}getViewportByClient(t){return tq(this.getLayer().client2Viewport(tJ(t)))}getClientByViewport(t){return tq(this.getLayer().viewport2Client(tJ(t)))}getClientByCanvas(t){return this.getClientByViewport(this.getViewportByCanvas(t))}getCanvasByClient(t){let e=this.getLayer(),n=e.client2Viewport(tJ(t));return tq(e.viewport2Canvas(n))}async toDataURL(){var t,e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=window.devicePixelRatio||1,{mode:s="viewport",...r}=n,[a,o,l,h]=[0,0,0,0];if("viewport"===s)[l,h]=this.getSize();else if("overall"===s){let t=this.getBounds(),e=tO(t);[a,o]=t.min,[l,h]=e}let c=((t=document.createElement("div")).innerHTML='<div id="virtual-image"></div>',(e=t.childNodes[0])&&t.contains(e)&&t.removeChild(e),e),d=new N.Xz({width:l,height:h,renderer:new sA.Th,devicePixelRatio:i,container:c,background:this.extends.config.background});await d.ready,d.appendChild(this.getLayer("background").getRoot().cloneNode(!0)),d.appendChild(this.getRoot().cloneNode(!0));let u=this.getLayer("label").getRoot().cloneNode(!0),p=d.viewport2Canvas({x:0,y:0}),g=this.getCanvasByViewport([0,0]);u.translate([g[0]-p.x,g[1]-p.y]),u.scale(1/this.getCamera().getZoom()),d.appendChild(u),d.appendChild(this.getLayer("transient").getRoot().cloneNode(!0));let f=this.getCamera(),y=d.getCamera();if("viewport"===s)y.setZoom(f.getZoom()),y.setPosition(f.getPosition()),y.setFocalPoint(f.getFocalPoint());else if("overall"===s){let[t,e,n]=y.getPosition(),[i,s,r]=y.getFocalPoint();y.setPosition([t+a,e+o,n]),y.setFocalPoint([i+a,s+o,r])}let m=d.getContextService();return new Promise(t=>{d.addEventListener(N.$6.RERENDER,async()=>{await new Promise(t=>setTimeout(t,300));let e=await m.toDataURL(r);t(e)})})}destroy(){Object.values(this.getLayers()).forEach(t=>{let e=t.getCamera();e.cancelLandmarkAnimation(),t.destroy()})}constructor(t){this.config=t;let{renderer:e,background:n,cursor:i,...s}=t,r=rJ(e),a=Object.fromEntries(r$.map(t=>{let e=new N.Xz({...s,supportsMutipleCanvasesInOneContainer:!0,renderer:r[t],background:"background"===t?n:void 0});return[t,e]}));rQ(a),this.extends={config:t,renderer:e,renderers:r,layers:a}}}function rJ(t){return Object.fromEntries(r$.map(e=>{let n=(null==t?void 0:t(e))||new sA.Th;return"main"===e?n.registerPlugin(new rX.S({isDocumentDraggable:!0,isDocumentDroppable:!0,dragstartDistanceThreshold:10,dragstartTimeThreshold:100})):n.unregisterPlugin(n.getPlugin("dom-interaction")),[e,n]}))}function rQ(t){Object.entries(t).forEach(t=>{let[e,n]=t,i=n.getContextService().getDomElement();i.style.position="absolute",i.style.outline="none",i.tabIndex=1,"main"!==e&&(i.style.pointerEvents="none")})}function r0(t,e){let{data:n,style:i,...s}=t,{data:r,style:a,...o}=e,l={...s,...o};return(n||r)&&Object.assign(l,{data:{...n,...r}}),(i||a)&&Object.assign(l,{style:{...i,...a}}),l}function r1(t){let{data:e,style:n,...i}=t;return e&&(i.data={...e}),n&&(i.style={...n}),i}function r2(t){let{id:e=ta(t),style:n,data:i,...s}=t,r={...t,style:{...n},data:{...i}};return"source"in t&&"target"in t?{id:e,data:r,...s}:{id:e,data:r}}function r3(t){return t.data}class r6{pushChange(t){if(this.isTraceless)return;let{type:e}=t;if(e===v.NodeUpdated||e===v.EdgeUpdated||e===v.ComboUpdated){let{value:n,original:i}=t;this.changes.push({value:r1(n),original:r1(i),type:e})}else this.changes.push({value:r1(t.value),type:e})}getChanges(){return this.changes}clearChanges(){this.changes=[]}batch(t){this.batchCount++,this.model.batch(t),this.batchCount--}silence(t){this.isTraceless=!0,t(),this.isTraceless=!1}isCombo(t){return this.comboIds.has(t)||this.latestRemovedComboIds.has(t)}getData(){return{nodes:this.getNodeData(),edges:this.getEdgeData(),combos:this.getComboData()}}getNodeData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=r3(n);return this.isCombo(ta(i))||(void 0===t?e.push(i):t.includes(ta(i))&&e.push(i)),e},[])}getEdgeDatum(t){return r3(this.model.getEdge(t))}getEdgeData(t){return this.model.getAllEdges().reduce((e,n)=>{let i=r3(n);return void 0===t?e.push(i):t.includes(ta(i))&&e.push(i),e},[])}getComboData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=r3(n);return this.isCombo(ta(i))&&(void 0===t?e.push(i):t.includes(ta(i))&&e.push(i)),e},[])}getAncestorsData(t,e){let{model:n}=this;return n.hasNode(t)&&n.hasTreeStructure(e)?n.getAncestors(t,e).map(r3):[]}getDescendantsData(t){let e=this.getElementDataById(t),n=[];return ee(e,t=>{t!==e&&n.push(t)},t=>this.getChildrenData(ta(t)),"TB"),n}getParentData(t,e){let{model:n}=this;if(!e){q.warn("The hierarchy structure key is not specified");return}if(!n.hasNode(t)||!n.hasTreeStructure(e))return;let i=n.getParent(t,e);return i?r3(i):void 0}getChildrenData(t){let e="node"===this.getElementType(t)?K:U,{model:n}=this;return n.hasNode(t)&&n.hasTreeStructure(e)?n.getChildren(t,e).map(r3):[]}getElementsDataByType(t){return"node"===t?this.getNodeData():"edge"===t?this.getEdgeData():"combo"===t?this.getComboData():[]}getElementDataById(t){let e=this.getElementType(t);return"edge"===e?this.getEdgeDatum(t):this.getNodeLikeDatum(t)}getNodeLikeDatum(t){let e=this.model.getNode(t);return r3(e)}getNodeLikeData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=r3(n);return t?t.includes(ta(i))&&e.push(i):e.push(i),e},[])}getElementDataByState(t,e){let n=this.getElementsDataByType(t);return n.filter(t=>{var n;return null===(n=t.states)||void 0===n?void 0:n.includes(e)})}getElementState(t){var e;return(null===(e=this.getElementDataById(t))||void 0===e?void 0:e.states)||[]}hasNode(t){return this.model.hasNode(t)&&!this.isCombo(t)}hasEdge(t){return this.model.hasEdge(t)}hasCombo(t){return this.model.hasNode(t)&&this.isCombo(t)}getRelatedEdgesData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";return this.model.getRelatedEdges(t,e).map(r3)}getNeighborNodesData(t){return this.model.getNeighbors(t).map(r3)}setData(t){let{nodes:e=[],edges:n=[],combos:i=[]}=t,{nodes:s,edges:r,combos:a}=this.getData(),o=tg(s,e,t=>ta(t)),l=tg(r,n,t=>ta(t)),h=tg(a,i,t=>ta(t));this.batch(()=>{this.addData({nodes:o.enter,edges:l.enter,combos:h.enter}),this.updateData({nodes:o.update,edges:l.update,combos:h.update}),this.removeData({nodes:o.exit.map(ta),edges:l.exit.map(ta),combos:h.exit.map(ta)})})}addData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.addComboData(i),this.addNodeData(e),this.addEdgeData(n)})}addNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&(this.model.addNodes(t.map(t=>(this.pushChange({value:t,type:v.NodeAdded}),r2(t)))),this.updateNodeLikeHierarchy(t))}addEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&this.model.addEdges(t.map(t=>(this.pushChange({value:t,type:v.EdgeAdded}),r2(t))))}addComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;e.hasTreeStructure(U)||e.attachTreeStructure(U),e.addNodes(t.map(t=>(this.comboIds.add(ta(t)),this.pushChange({value:t,type:v.ComboAdded}),r2(t)))),this.updateNodeLikeHierarchy(t)}addChildrenData(t,e){let n=this.getNodeLikeDatum(t),i=e.map(ta);this.addNodeData(e),this.updateNodeData([{id:t,children:[...n.children||[],...i]}]),this.addEdgeData(i.map(e=>({source:t,target:e})))}updateNodeLikeHierarchy(t){if(!this.enableUpdateNodeLikeHierarchy)return;let{model:e}=this;t.forEach(t=>{let n=ta(t);e.attachTreeStructure(U),this.setParent(n,t.combo,U);let i=t.children;if(void 0!==i){e.attachTreeStructure(K);let t=i.filter(t=>e.hasNode(t));t.forEach(t=>this.setParent(t,n,K)),t.length!==i.length&&this.updateNodeData([{id:n,children:t}])}})}preventUpdateNodeLikeHierarchy(t){this.enableUpdateNodeLikeHierarchy=!1,t(),this.enableUpdateNodeLikeHierarchy=!0}updateData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.updateNodeData(e),this.updateComboData(i),this.updateEdgeData(n)})}updateNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;this.batch(()=>{let n=[];t.forEach(t=>{let i=ta(t),s=r3(e.getNode(i));if(W(s,t))return;let r=r0(s,t);this.pushChange({value:r,original:s,type:v.NodeUpdated}),e.mergeNodeData(i,r),n.push(r)}),this.updateNodeLikeHierarchy(n)})}refreshData(){let{nodes:t,edges:e,combos:n}=this.getData();t.forEach(t=>{this.pushChange({value:t,original:t,type:v.NodeUpdated})}),e.forEach(t=>{this.pushChange({value:t,original:t,type:v.EdgeUpdated})}),n.forEach(t=>{this.pushChange({value:t,original:t,type:v.ComboUpdated})})}syncNodeDatum(t){let{model:e}=this,n=ta(t),i=r3(e.getNode(n)),s=r0(i,t);e.mergeNodeData(n,s)}updateEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;this.batch(()=>{t.forEach(t=>{let n=ta(t),i=r3(e.getEdge(n));if(W(i,t))return;t.source&&i.source!==t.source&&e.updateEdgeSource(n,t.source),t.target&&i.target!==t.target&&e.updateEdgeTarget(n,t.target);let s=r0(i,t);this.pushChange({value:s,original:i,type:v.EdgeUpdated}),e.mergeEdgeData(n,s)})})}updateComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;e.batch(()=>{let n=[];t.forEach(t=>{let i=ta(t),s=r3(e.getNode(i));if(W(s,t))return;let r=r0(s,t);this.pushChange({value:r,original:s,type:v.ComboUpdated}),e.mergeNodeData(i,r),n.push(r)}),this.updateNodeLikeHierarchy(n)})}setParent(t,e,n){let i=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(t===e)return;let s=this.getNodeLikeDatum(t).combo;if(s!==e&&n===U){let n={id:t,combo:e};this.isCombo(t)?this.syncComboDatum(n):this.syncNodeDatum(n)}this.model.setParent(t,e,n),i&&n===U&&(function(t,e){void 0===e&&(e=new Map);var n=[];if(Array.isArray(t))for(var i=0,s=t.length;i<s;i++){var r=t[i];e.has(r)||(n.push(r),e.set(r,!0))}return n})([s,e]).forEach(t=>{void 0!==t&&this.refreshComboData(t)})}refreshComboData(t){let e=this.getComboData([t])[0],n=this.getAncestorsData(t,U);e&&this.pushChange({value:e,original:e,type:v.ComboUpdated}),n.forEach(t=>{this.pushChange({value:t,original:t,type:v.ComboUpdated})})}syncComboDatum(t){let{model:e}=this,n=ta(t);if(!e.hasNode(n))return;let i=r3(e.getNode(n)),s=r0(i,t);e.mergeNodeData(n,s)}getElementPosition(t){let e=this.getElementDataById(t);return tX(e)}translateNodeLikeBy(t,e){this.isCombo(t)?this.translateComboBy(t,e):this.translateNodeBy(t,e)}translateNodeLikeTo(t,e){this.isCombo(t)?this.translateComboTo(t,e):this.translateNodeTo(t,e)}translateNodeBy(t,e){let n=this.getElementPosition(t),i=tL(n,[...e,0].slice(0,3));this.translateNodeTo(t,i)}translateNodeTo(t,e){let[n=0,i=0,s=0]=e;this.preventUpdateNodeLikeHierarchy(()=>{this.updateNodeData([{id:t,style:{x:n,y:i,z:s}}])})}translateComboBy(t,e){let[n=0,i=0,s=0]=e;if([n,i,s].some(isNaN)||[n,i,s].every(t=>0===t))return;let r=this.getComboData([t])[0];r&&ee(r,t=>{let e=ta(t),[r,a,o]=tX(t),l=r0(t,{style:{x:r+n,y:a+i,z:o+s}});this.pushChange({value:l,original:t,type:this.isCombo(e)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(e,l)},t=>this.getChildrenData(ta(t)),"BT")}translateComboTo(t,e){var n;if(e.some(isNaN))return;let[i=0,s=0,r=0]=e,a=null===(n=this.getComboData([t]))||void 0===n?void 0:n[0];if(!a)return;let[o,l,h]=tX(a),c=i-o,d=s-l,u=r-h;ee(a,t=>{let e=ta(t),[n,i,s]=tX(t),r=r0(t,{style:{x:n+c,y:i+d,z:s+u}});this.pushChange({value:r,original:t,type:this.isCombo(e)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(e,r)},t=>this.getChildrenData(ta(t)),"BT")}removeData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.removeEdgeData(n),this.removeNodeData(e),this.removeComboData(i),this.latestRemovedComboIds=new Set(i)})}removeNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&this.batch(()=>{t.forEach(t=>{this.removeEdgeData(this.getRelatedEdgesData(t).map(ta)),this.pushChange({value:this.getNodeData([t])[0],type:v.NodeRemoved}),this.removeNodeLikeHierarchy(t)}),this.model.removeNodes(t)})}removeEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&(t.forEach(t=>this.pushChange({value:this.getEdgeData([t])[0],type:v.EdgeRemoved})),this.model.removeEdges(t))}removeComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&this.batch(()=>{t.forEach(t=>{this.pushChange({value:this.getComboData([t])[0],type:v.ComboRemoved}),this.removeNodeLikeHierarchy(t),this.comboIds.delete(t)}),this.model.removeNodes(t)})}removeNodeLikeHierarchy(t){if(this.model.hasTreeStructure(U)){let e=this.getNodeLikeDatum(t).combo;this.setParent(t,void 0,U,!1),this.model.getChildren(t,U).forEach(t=>{let n=r3(t),i=ta(n);this.setParent(ta(n),e,U,!1);let s=r0(n,{id:ta(n),combo:e});this.pushChange({value:s,original:n,type:this.isCombo(i)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(ta(n),s)}),ne(e)||this.refreshComboData(e)}}getElementType(t){if(this.model.hasNode(t))return this.isCombo(t)?"combo":"node";if(this.model.hasEdge(t))return"edge";throw Error($("Unknown element type of id: ".concat(t)))}destroy(){let{model:t}=this,e=t.getAllNodes(),n=t.getAllEdges();t.removeEdges(n.map(t=>t.id)),t.removeNodes(e.map(t=>t.id)),this.context={}}constructor(){this.latestRemovedComboIds=new Set,this.comboIds=new Set,this.changes=[],this.batchCount=0,this.isTraceless=!1,this.enableUpdateNodeLikeHierarchy=!0,this.model=new ic.k}}class r4{init(){if(!this.container){let{canvas:t}=this.context;this.container=t.appendChild(new N.ZA({className:"elements"}))}}emit(t,e){e.silence||rY(this.context.graph,t)}forEachElementData(t){et.forEach(e=>{let n=this.context.model.getElementsDataByType(e);t(e,n)})}getElementType(t,e){var n;let{options:i,graph:s}=this.context,r=(null===(n=i[t])||void 0===n?void 0:n.type)||e.type;return r?"string"==typeof r?r:r.call(s,e):"edge"===t?"line":"circle"}getTheme(t){return J(this.context.options)[t]||{}}getThemeStyle(t){return this.getTheme(t).style||{}}getThemeStateStyle(t,e){let{state:n={}}=this.getTheme(t);return Object.assign({},...e.map(t=>n[t]||{}))}computePaletteStyle(){let{options:t}=this.context;this.paletteStyle={},this.forEachElementData((e,n)=>{var i,s;let r=Object.assign({},eT(null===(i=this.getTheme(e))||void 0===i?void 0:i.palette),eT(null===(s=t[e])||void 0===s?void 0:s.palette));(null==r?void 0:r.field)&&Object.assign(this.paletteStyle,function(t,e){if(!e)return{};let{type:n,color:i,field:s,invert:r}=e,a=t=>{let e="string"==typeof i?X("palette",i):i;if("function"==typeof e){let n={};return t.forEach(t=>{let[i,s]=t;n[i]=e(r?1-s:s)}),n}if(Array.isArray(e)){let n=r?[...e].reverse():e,i={};return t.forEach(t=>{let[s,r]=t;i[s]=n[r%e.length]}),i}return{}},o=(t,e)=>{var n;return"string"==typeof t?null===(n=e.data)||void 0===n?void 0:n[t]:null==t?void 0:t(e)};if("group"===n){let e=eD(t,t=>{if(!s)return"default";let e=o(s,t);return e?String(e):"default"}),n=Object.keys(e),i=a(n.map((t,e)=>[t,e])),r={};return Object.entries(e).forEach(t=>{let[e,n]=t;n.forEach(t=>{r[ta(t)]=i[e]})}),r}if("value"===n){let[e,n]=t.reduce((t,e)=>{let[n,i]=t,r=o(s,e);if("number"!=typeof r)throw Error($("Palette field ".concat(s," is not a number")));return[Math.min(n,r),Math.max(i,r)]},[1/0,-1/0]),i=n-e;return a(t.map(t=>[t.id,(o(s,t)-e)/i]))}}(n,r))})}getPaletteStyle(t,e){let n=this.paletteStyle[e];return n?"edge"===t?{stroke:n}:{fill:n}:{}}computeElementDefaultStyle(t,e){var n;let{options:i}=this.context,s=(null===(n=i[t])||void 0===n?void 0:n.style)||{};this.defaultStyle[ta(e.datum)]=ey(s,e)}computeElementsDefaultStyle(t){let{graph:e}=this.context;this.forEachElementData((n,i)=>{let s=i.length;for(let r=0;r<s;r++){let s=i[r];(void 0===t||t.includes(ta(s)))&&this.computeElementDefaultStyle(n,{datum:s,graph:e})}})}getDefaultStyle(t){return this.defaultStyle[t]||{}}getElementState(t){try{let{model:e}=this.context;return e.getElementState(t)}catch(t){return[]}}getElementStateStyle(t,e,n){var i,s;let{options:r}=this.context,a=(null===(i=r[t])||void 0===i?void 0:null===(s=i.state)||void 0===s?void 0:s[e])||{};return ey(a,n)}computeElementStatesStyle(t,e,n){this.stateStyle[ta(n.datum)]=Object.assign({},...e.map(e=>this.getElementStateStyle(t,e,n)))}computeElementsStatesStyle(t){let{graph:e}=this.context;this.forEachElementData((n,i)=>{let s=i.length;for(let r=0;r<s;r++){let s=i[r];if(void 0===t||t.includes(ta(s))){let t=this.getElementState(ta(s));this.computeElementStatesStyle(n,t,{datum:s,graph:e})}}})}getStateStyle(t){return this.stateStyle[t]||{}}computeStyle(t,e){t&&["translate","zIndex"].includes(t)||(this.computePaletteStyle(),this.computeElementsDefaultStyle(e),this.computeElementsStatesStyle(e))}getElement(t){return this.elementMap[t]}getElementZIndex(t){var e;let n=this.getElement(t);return n&&null!==(e=n.style.zIndex)&&void 0!==e?e:0}getNodes(){return this.context.model.getNodeData().map(t=>{let{id:e}=t;return this.elementMap[e]})}getEdges(){return this.context.model.getEdgeData().map(t=>this.elementMap[ta(t)])}getCombos(){return this.context.model.getComboData().map(t=>{let{id:e}=t;return this.elementMap[e]})}getElementComputedStyle(t,e){let n=ta(e),i=this.getThemeStyle(t),s=this.getPaletteStyle(t,n),r=e.style||{},a=this.getDefaultStyle(n),o=this.getThemeStateStyle(t,this.getElementState(n)),l=this.getStateStyle(n),h=Object.assign({},i,s,r,a,o,l);if("combo"===t){let t=this.context.model.getChildrenData(n),e=!!h.collapsed,i=e?[]:t.map(ta).filter(t=>this.getElement(t));Object.assign(h,{childrenNode:i,childrenData:t})}return h}draw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{animation:!0};this.init();let e=this.computeChangesAndDrawData(t);if(!e)return null;let{dataChanges:n,drawData:i}=e;this.markDestroyElement(i),this.computeStyle(t.stage);let{add:s,update:r,remove:a}=i;this.destroyElements(a,t),this.createElements(s,t),this.updateElements(r,t);let{animation:o,silence:l}=t,{type:h="draw"}=t,c="render"===h;return this.context.animation.animate(o,l?{}:{before:()=>this.emit(new rH(O.BEFORE_DRAW,{dataChanges:n,animation:o,render:c}),t),beforeAnimate:e=>this.emit(new rW(O.BEFORE_ANIMATE,b.DRAW,e,i),t),afterAnimate:e=>this.emit(new rW(O.AFTER_ANIMATE,b.DRAW,e,i),t),after:()=>this.emit(new rH(O.AFTER_DRAW,{dataChanges:n,animation:o,render:c}),t)})}computeChangesAndDrawData(t){let{model:e}=this.context,n=e.getChanges(),i=sf(n);if(0===i.length)return null;let{NodeAdded:s=[],NodeUpdated:r=[],NodeRemoved:a=[],EdgeAdded:o=[],EdgeUpdated:l=[],EdgeRemoved:h=[],ComboAdded:c=[],ComboUpdated:d=[],ComboRemoved:u=[]}=eD(i,t=>t.type),p=t=>new Map(t.map(t=>{let e=t.value;return[ta(e),e]})),g={add:{nodes:p(s),edges:p(o),combos:p(c)},update:{nodes:p(r),edges:p(l),combos:p(d)},remove:{nodes:p(a),edges:p(h),combos:p(u)}},f=this.transformData(g,t);return e.clearChanges(),{dataChanges:n,drawData:f}}transformData(t,e){let n=this.context.transform.getTransformInstance();return Object.values(n).reduce((t,n)=>n.beforeDraw(t,e),t)}createElement(t,e,n){var i;let s=ta(e),r=this.getElement(s);if(r)return;let a=this.getElementType(t,e),o=this.getElementComputedStyle(t,e),l=X(t,a);if(!l)return q.warn("The element ".concat(a," of ").concat(t," is not registered."));this.emit(new rV(O.BEFORE_ELEMENT_CREATE,t,e),n);let h=this.container.appendChild(new l({id:s,style:{context:this.context,...o}}));this.shapeTypeMap[s]=a,this.elementMap[s]=h;let{stage:c="enter"}=n;null===(i=this.context.animation)||void 0===i||i.add({element:h,elementType:t,stage:c,originalStyle:{...h.attributes},modifiedStyle:{...h.attributes,...o}},{after:()=>{var i;this.emit(new rV(O.AFTER_ELEMENT_CREATE,t,e),n),null===(i=h.onCreate)||void 0===i||i.call(h)}})}createElements(t,e){let{nodes:n,edges:i,combos:s}=t;[["node",n],["combo",s],["edge",i]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.createElement(n,t,e))})}updateElement(t,e,n){var i;let s=ta(e),r=this.getElement(s);if(!r)return()=>null;this.emit(new rV(O.BEFORE_ELEMENT_UPDATE,t,e),n);let a=this.getElementType(t,e),o=this.getElementComputedStyle(t,e);this.shapeTypeMap[s]!==a&&(r.destroy(),delete this.shapeTypeMap[s],delete this.elementMap[s],this.createElement(t,e,{animation:!1,silence:!0}));let{stage:l="update"}=n,h="visibility"!==l?l:"hidden"===o.visibility?"hide":"show";"hide"===h&&delete o.visibility,null===(i=this.context.animation)||void 0===i||i.add({element:r,elementType:t,stage:h,originalStyle:{...r.attributes},modifiedStyle:{...r.attributes,...o}},{before:()=>{let t=this.elementMap[s];"collapse"!==l&&it(t,o),"visibility"===l&&(ew(t,"opacity")||eE(t,"opacity"),this.visibilityCache.set(t,"show"===h?"visible":"hidden"),"show"===h&&eP(t,"visible"))},after:()=>{var i;let r=this.elementMap[s];"collapse"===l&&it(r,o),"hide"===h&&eP(r,this.visibilityCache.get(r)),this.emit(new rV(O.AFTER_ELEMENT_UPDATE,t,e),n),null===(i=r.onUpdate)||void 0===i||i.call(r)}})}updateElements(t,e){let{nodes:n,edges:i,combos:s}=t;[["node",n],["combo",s],["edge",i]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.updateElement(n,t,e))})}markDestroyElement(t){Object.values(t.remove).forEach(t=>{t.forEach(t=>{let e=ta(t),n=this.getElement(e);n&&eh(n,"__to_be_destroyed__",!0)})})}destroyElement(t,e,n){var i;let{stage:s="exit"}=n,r=ta(e),a=this.elementMap[r];if(!a)return()=>null;this.emit(new rV(O.BEFORE_ELEMENT_DESTROY,t,e),n),null===(i=this.context.animation)||void 0===i||i.add({element:a,elementType:t,stage:s,originalStyle:{...a.attributes},modifiedStyle:{...a.attributes}},{after:()=>{var i;this.clearElement(r),a.destroy(),null===(i=a.onDestroy)||void 0===i||i.call(a),this.emit(new rV(O.AFTER_ELEMENT_DESTROY,t,e),n)}})}destroyElements(t,e){let{nodes:n,edges:i,combos:s}=t;[["combo",s],["edge",i],["node",n]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.destroyElement(n,t,e))})}clearElement(t){delete this.paletteStyle[t],delete this.defaultStyle[t],delete this.stateStyle[t],delete this.elementMap[t],delete this.shapeTypeMap[t]}async collapseNode(t,e){var n;let{model:i,layout:s}=this.context,r=this.computeChangesAndDrawData({stage:"collapse",animation:e});this.markDestroyElement(r.drawData);let a=await s.simulate();i.updateData(a);let{drawData:o}=this.computeChangesAndDrawData({stage:"collapse",animation:e}),{add:l,remove:h,update:c}=o;this.markDestroyElement(o);let d={animation:e,stage:"collapse",data:o};this.destroyElements(h,d),this.createElements(l,d),this.updateElements(c,d),await (null===(n=this.context.animation.animate(e,{beforeAnimate:t=>this.emit(new rW(O.BEFORE_ANIMATE,b.COLLAPSE,t,o),d),afterAnimate:t=>this.emit(new rW(O.AFTER_ANIMATE,b.COLLAPSE,t,o),d)},{collapse:{target:t,descendants:Array.from(h.nodes).map(t=>{let[,e]=t;return ta(e)}),position:tX(c.nodes.get(t))}}))||void 0===n?void 0:n.finished)}async expandNode(t,e){var n;let{model:i,layout:s}=this.context;if(!i.getAncestorsData(t,U).every(t=>ea(t)))return;let r=tX(i.getNodeData([t])[0]),{drawData:{add:a}}=this.computeChangesAndDrawData({stage:"collapse",animation:e});this.createElements(a,{animation:!1,stage:"expand"}),this.context.animation.clear();let o=await s.simulate();i.updateData(o),this.computeStyle("expand");let{drawData:l}=this.computeChangesAndDrawData({stage:"collapse",animation:e}),{update:h}=l,c={animation:e,stage:"expand",data:l};a.edges.forEach(t=>{let e=ta(t);h.edges.has(e)||h.edges.set(e,t)}),this.updateElements(h,c),await (null===(n=this.context.animation.animate(e,{beforeAnimate:t=>this.emit(new rW(O.BEFORE_ANIMATE,b.EXPAND,t,l),c),afterAnimate:t=>this.emit(new rW(O.AFTER_ANIMATE,b.EXPAND,t,l),c)},{expand:{target:t,descendants:Array.from(a.nodes).map(t=>{let[,e]=t;return ta(e)}),position:r}}))||void 0===n?void 0:n.finished)}async collapseCombo(t,e){var n;let{model:i,element:s}=this.context;if(i.getAncestorsData(t,U).some(t=>ea(t)))return;let r=s.getElement(t),a=r.getComboPosition({...r.attributes,collapsed:!0}),{dataChanges:o,drawData:l}=this.computeChangesAndDrawData({stage:"collapse",animation:e});this.markDestroyElement(l);let{update:h,remove:c}=l,d={animation:e,stage:"collapse",data:l};this.destroyElements(c,d),this.updateElements(h,d);let u=t=>Array.from(t).map(t=>{let[,e]=t;return ta(e)});await (null===(n=this.context.animation.animate(e,{before:()=>this.emit(new rH(O.BEFORE_DRAW,{dataChanges:o,animation:e}),d),beforeAnimate:t=>this.emit(new rW(O.BEFORE_ANIMATE,b.COLLAPSE,t,l),d),afterAnimate:t=>this.emit(new rW(O.AFTER_ANIMATE,b.COLLAPSE,t,l),d),after:()=>this.emit(new rH(O.AFTER_DRAW,{dataChanges:o,animation:e}),d)},{collapse:{target:t,descendants:[...u(c.nodes),...u(c.combos)],position:a}}))||void 0===n?void 0:n.finished)}async expandCombo(t,e){var n;let{model:i}=this.context,s=tX(i.getComboData([t])[0]);this.computeStyle("expand");let{dataChanges:r,drawData:a}=this.computeChangesAndDrawData({stage:"expand",animation:e}),{add:o,update:l}=a,h={animation:e,stage:"expand",data:a};this.createElements(o,h),this.updateElements(l,h);let c=t=>Array.from(t).map(t=>{let[,e]=t;return ta(e)});await (null===(n=this.context.animation.animate(e,{before:()=>this.emit(new rH(O.BEFORE_DRAW,{dataChanges:r,animation:e}),h),beforeAnimate:t=>this.emit(new rW(O.BEFORE_ANIMATE,b.EXPAND,t,a),h),afterAnimate:t=>this.emit(new rW(O.AFTER_ANIMATE,b.EXPAND,t,a),h),after:()=>this.emit(new rH(O.AFTER_DRAW,{dataChanges:r,animation:e}),h)},{expand:{target:t,descendants:[...c(o.nodes),...c(o.combos)],position:s}}))||void 0===n?void 0:n.finished)}getFrontZIndex(t){let{model:e}=this.context,n=e.getElementType(t),i=e.getElementDataById(t),s=e.getData();if(Object.assign(s,{["".concat(n,"s")]:s["".concat(n,"s")].filter(e=>ta(e)!==t)}),"combo"===n&&!ea(i)){let n=e.getAncestorsData(t,U).map(ta);s.nodes=s.nodes.filter(t=>!n.includes(ta(t))),s.combos=s.combos.filter(t=>!n.includes(ta(t))),s.edges=s.edges.filter(t=>{let{source:e,target:i}=t;return n.includes(e)&&n.includes(i)})}return Math.max(0,...Object.values(s).flat().map(t=>{let e=ta(t);return this.getElementZIndex(e)}))+1}destroy(){this.container.destroy(),this.elementMap={},this.shapeTypeMap={},this.defaultStyle={},this.stateStyle={},this.paletteStyle={},this.context={}}constructor(t){this.elementMap={},this.shapeTypeMap={},this.paletteStyle={},this.defaultStyle={},this.stateStyle={},this.visibilityCache=new WeakMap,this.context=t}}var r8=n(38027),r9=n(54375);class r5 extends sg.Z{constructor(t,e,n){super(),this.graph=t,this.layout=e,this.options=n,this.spawnWorker()}spawnWorker(){this.proxy=r9.Ud(new Worker(n.tu(new URL(n.p+n.u(2916),n.b)),{type:void 0})),this.running&&(this.running=!1,this.execute())}execute(){var t;return(0,sF.mG)(this,void 0,void 0,function*(){if(this.running)return this;this.running=!0;let e=this.layout.options,{onTick:n}=e,i=(0,sF._T)(e,["onTick"]),s={};Object.keys(i).forEach(t=>{(0,r8.Z)(i[t])||(s[t]=i[t])});let r={layout:{id:this.layout.id,options:s,iterations:null===(t=this.options)||void 0===t?void 0:t.iterations},nodes:this.graph.getAllNodes(),edges:this.graph.getAllEdges()},a=new Float32Array([0]),[o]=yield this.proxy.calculateLayout(r,[a]);return o})}stop(){return this.running=!1,this.proxy.stopLayout(),this}kill(){this.proxy[r9.Yy]()}isRunning(){return this.running}}var r7=n(10779);class at{get presetOptions(){return{animation:!!tn(this.context.options,!0)}}get options(){let{options:t}=this.context;return t.layout}getLayoutInstance(){return this.instances}async layout(){if(!this.options)return;let t=Array.isArray(this.options)?this.options:[this.options],{graph:e}=this.context;for(let n of(rY(e,new rH(O.BEFORE_LAYOUT)),t)){let i=t.indexOf(n),s=this.getLayoutData(n),r={...this.presetOptions,...n};rY(e,new rH(O.BEFORE_STAGE_LAYOUT,{options:r,index:i}));let a=await this.stepLayout(s,r,i);rY(e,new rH(O.AFTER_STAGE_LAYOUT,{options:r,index:i})),n.animation||this.updateElementPosition(a,!1)}rY(e,new rH(O.AFTER_LAYOUT))}async simulate(){if(!this.options)return{};let t=Array.isArray(this.options)?this.options:[this.options],e={};for(let n of t){let i=t.indexOf(n),s=this.getLayoutData(n),r=await this.stepLayout(s,{...this.presetOptions,...n,animation:!1},i);e=r}return e}async stepLayout(t,e,n){return!function(t){let{type:e}=t;return["compact-box","mindmap","dendrogram","indented"].includes(e)}(e)?await this.graphLayout(t,e,n):await this.treeLayout(t,e,n)}async graphLayout(t,e,n){let{animation:i,enableWorker:s,iterations:r=300}=e,a=this.initGraphLayout(e);if(!a)return{};if(this.instances[n]=a,this.instance=a,s)return this.supervisor=new r5(a.graphData2LayoutModel(t),a.instance,{iterations:r}),iu(await this.supervisor.execute());if((0,r7.h)(a))return i?await a.execute(t,{onTick:t=>{this.updateElementPosition(t,!1)}}):(a.execute(t),a.stop(),a.tick(r));let o=await a.execute(t);return i&&this.updateElementPosition(o,i),o}async treeLayout(t,e,n){let{type:i,animation:s}=e,r=X("layout",i);if(!r)return{};let{nodes:a=[],edges:o=[]}=t,l=new ic.k({nodes:a.map(t=>({id:ta(t),data:t.data||{}})),edges:o.map(t=>({id:ta(t),source:t.source,target:t.target,data:t.data||{}}))});!function(t){if(t.hasTreeStructure(K))return;t.attachTreeStructure(K);let e=t.getAllEdges();for(let n of e){let{source:e,target:i}=n;t.setParent(i,e,K)}}(l);let h={nodes:[],edges:[]},c={nodes:[],edges:[]},d=l.getRoots(K);d.forEach(t=>{ee(t,t=>{t.children=l.getSuccessors(t.id)},t=>l.getSuccessors(t.id),"TB");let n=r(t,e),{x:i,y:s,z:a=0}=n;ee(n,t=>{let{id:e,x:n,y:r,z:o=0}=t;h.nodes.push({id:e,style:{x:i,y:s,z:a}}),c.nodes.push({id:e,style:{x:n,y:r,z:o}})},t=>t.children,"TB")});let u=this.inferTreeLayoutOffset(c);return ae(c,u),s&&(ae(h,u),this.updateElementPosition(h,!1),this.updateElementPosition(c,s)),c}inferTreeLayoutOffset(t){var e;let[n,i]=[1/0,-1/0],[s,r]=[1/0,-1/0];null===(e=t.nodes)||void 0===e||e.forEach(t=>{let{x:e=0,y:a=0}=t.style||{};n=Math.min(n,e),i=Math.max(i,e),s=Math.min(s,a),r=Math.max(r,a)});let{canvas:a}=this.context,o=a.getSize(),[l,h]=a.getCanvasByViewport([0,0]),[c,d]=a.getCanvasByViewport(o);return n>=l&&i<=c&&s>=h&&r<=d?[0,0]:[(l+c)/2-(n+i)/2,(h+d)/2-(s+r)/2]}stopLayout(){this.instance&&(0,r7.h)(this.instance)&&(this.instance.stop(),this.instance=void 0),this.supervisor&&(this.supervisor.stop(),this.supervisor=void 0),this.animationResult&&(this.animationResult.finish(),this.animationResult=void 0)}getLayoutData(t){let{nodeFilter:e=()=>!0}=t,{nodes:n,edges:i,combos:s}=this.context.model.getData(),r=t=>this.context.element.getElement(t),a=n.filter(t=>{let n=ta(t),i=r(n);return!(!i||ie(i))&&e(t)}),o=new Map(a.map(t=>[ta(t),t])),l=i.filter(t=>{let{source:e,target:n}=t;return!!(o.has(e)&&o.has(n))});return{nodes:a,edges:l,combos:s}}initGraphLayout(t){var e,n;let{element:i,viewport:s}=this.context,{type:r,enableWorker:a,animation:o,iterations:l,...h}=t,[c,d]=s.getCanvasSize(),u=[c/2,d/2],p=null!==(e=null==t?void 0:t.nodeSize)&&void 0!==e?e:t=>{let e=null==i?void 0:i.getElement(t.id),{size:n}=(null==e?void 0:e.attributes)||{};return Math.max(...ef(n))},g=X("layout",r);if(!g)return q.warn("The layout of ".concat(r," is not registered."));let f=Object.getPrototypeOf(g.prototype)===id.prototype?g:(n=this.context,class extends id{async execute(t,e){return iu(await this.instance.execute(this.graphData2LayoutModel(t),this.transformOptions(tr({},this.options,e))))}transformOptions(t){let{onTick:e}=t;return e&&(t.onTick=t=>e(iu(t))),t}graphData2LayoutModel(t){let{nodes:e=[],edges:i=[],combos:s=[]}=t,r=e.map(t=>{let e=ta(t),{data:n,style:i,combo:s}=t,r={id:e,data:{...n,...s?{parentId:s}:{}},style:{...i}};return(null==i?void 0:i.x)&&Object.assign(r.data,{x:i.x}),(null==i?void 0:i.y)&&Object.assign(r.data,{y:i.y}),(null==i?void 0:i.z)&&Object.assign(r.data,{z:i.z}),r}),a=new Map(r.map(t=>[t.id,t])),o=i.filter(t=>{let{source:e,target:n}=t;return a.has(e)&&a.has(n)}).map(t=>{let{source:e,target:n,data:i,style:s}=t;return{id:ta(t),source:e,target:n,data:{...i},style:{...s}}}),l=s.map(t=>({id:ta(t),data:{_isCombo:!0,...t.data},style:{...t.style}})),h=new ic.k({nodes:[...r,...l],edges:o});return n.model.model.hasTreeStructure(U)&&(h.attachTreeStructure(U),r.forEach(t=>{let e=n.model.model.getParent(t.id,U);e&&h.hasNode(e.id)&&h.setParent(t.id,e.id,U)})),h}constructor(t,e){if(super(t,e),this.instance=new g({}),this.id=this.instance.id,"stop"in this.instance&&"tick"in this.instance){let t=this.instance;this.stop=t.stop.bind(t),this.tick=e=>{let n=t.tick(e);return iu(n)}}}}),y=new f(this.context),m={nodeSize:p,width:c,height:d,center:u};switch(y.id){case"d3-force":case"d3-force-3d":Object.assign(m,{center:{x:c/2,y:d/2,z:0}})}return tr(y.options,m,h),y}updateElementPosition(t,e){let{model:n,element:i}=this.context;return i?(n.updateData(t),i.draw({animation:e,silence:!0})):null}destroy(){var t;this.stopLayout(),this.context={},null===(t=this.supervisor)||void 0===t||t.kill(),this.supervisor=void 0,this.instance=void 0,this.instances=[],this.animationResult=void 0}constructor(t){this.instances=[],this.context=t}}let ae=(t,e)=>{var n;let[i,s]=e;null===(n=t.nodes)||void 0===n||n.forEach(t=>{if(t.style){let{x:e=0,y:n=0}=t.style;t.style.x=e+i,t.style.y=n+s}else t.style={x:i,y:s}})};class an extends tf{setPlugins(t){this.setExtensions(t)}getPluginInstance(t){let e=this.extensionMap[t];if(e)return e;q.warn("Cannot find the plugin ".concat(t,", will try to find it by type."));let n=this.extensions.find(e=>e.type===t);if(n)return this.extensionMap[n.key]}constructor(t){super(t),this.category="plugin",this.setPlugins(this.context.options.plugins||[])}}let ai=["update-related-edges","collapse-expand-node","collapse-expand-combo","get-edge-actual-ends","arrange-draw-order"];class as extends tf{getTransforms(){}setTransforms(t){this.setExtensions([...ai.slice(0,ai.length-1),...t,ai[ai.length-1]])}getTransformInstance(t){return t?this.extensionMap[t]:this.extensionMap}constructor(t){super(t),this.category="transform",this.setTransforms(this.context.options.transforms||[])}}class ar{get padding(){return tw(this.context.options.padding)}get paddingOffset(){let[t,e,n,i]=this.padding,[s,r,a]=[(i-e)/2,(t-n)/2,0];return[s,r,a]}get camera(){let{canvas:t}=this.context;return new Proxy(t.getCamera(),{get:(e,n)=>{let i=Object.entries(t.getLayers()).filter(t=>{let[e]=t;return!["main"].includes(e)}),s=i.map(t=>{let[,e]=t;return e.getCamera()}),r=e[n];if("function"==typeof r)return function(){for(var t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];let o=r.apply(e,i);return s.forEach(t=>{t[n].apply(t,i)}),o}}})}createLandmark(t){return this.camera.createLandmark("landmark-".concat(this.landmarkCounter++),t)}getAnimation(t){let e=tn(this.context.options,t);return!!e&&nt({...e},["easing","duration"])}getCanvasSize(){let{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e,n]}getCanvasCenter(){let{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e/2,n/2,0]}getViewportCenter(){let[t,e]=this.camera.getPosition();return[t,e,0]}getGraphCenter(){return this.context.graph.getViewportByCanvas(this.getCanvasCenter())}getZoom(){return this.camera.getZoom()}getRotation(){return this.camera.getRoll()}getTranslateOptions(t){let{camera:e}=this,{mode:n,translate:i=[]}=t,s=this.getZoom(),r=e.getPosition(),a=e.getFocalPoint(),[o,l]=this.getCanvasCenter(),[h=0,c=0,d=0]=i,u=t_([-h,-c,-d],s);return"relative"===n?{position:tL(r,u),focalPoint:tL(a,u)}:{position:tL([o,l,r[2]],u),focalPoint:tL([o,l,a[2]],u)}}getRotateOptions(t){let{mode:e,rotate:n=0}=t,i="relative"===e?this.camera.getRoll()+n:n;return{roll:i}}getZoomOptions(t){let{zoomRange:e}=this.context.options,n=this.camera.getZoom(),{mode:i,scale:s=1}=t;return ix("relative"===i?n*s:s,...e)}async transform(t,e){let{graph:n}=this.context,{translate:i,rotate:s,scale:r,origin:a}=t;this.cancelAnimation();let o=this.getAnimation(e);if(rY(n,new rG(O.BEFORE_TRANSFORM,t)),!s&&r&&!i&&a&&!o){this.camera.setZoomByViewportPoint(this.getZoomOptions(t),a),rY(n,new rG(O.AFTER_TRANSFORM,t));return}let l={};if(i&&Object.assign(l,this.getTranslateOptions(t)),el(s)&&Object.assign(l,this.getRotateOptions(t)),el(r)&&Object.assign(l,{zoom:this.getZoomOptions(t)}),o)return rY(n,new rW(O.BEFORE_ANIMATE,b.TRANSFORM,null,t)),new Promise(e=>{this.transformResolver=e,this.camera.gotoLandmark(this.createLandmark(l),{...o,onfinish:()=>{rY(n,new rW(O.AFTER_ANIMATE,b.TRANSFORM,null,t)),rY(n,new rG(O.AFTER_TRANSFORM,t)),this.transformResolver=void 0,e()}})});this.camera.gotoLandmark(this.createLandmark(l),{duration:0}),rY(n,new rG(O.AFTER_TRANSFORM,t))}async fitView(t,e){let[n,i,s,r]=this.padding,{when:a="always",direction:o="both"}=t||{},[l,h]=this.context.canvas.getSize(),c=l-r-i,d=h-n-s,u=this.context.canvas.getBounds(),p=this.getBBoxInViewport(u),[g,f]=tO(p);if("overflow"===a&&!("x"===o&&g>=c||"y"===o&&f>=d||"both"===o&&g>=c&&f>=d))return await this.fitCenter(e);let y=c/g,m=d/f,v="x"===o?y:"y"===o?m:Math.min(y,m),b=this.getAnimation(e);await this.transform({mode:"relative",scale:v,translate:tL(tI(this.getCanvasCenter(),this.getBBoxInViewport(u).center),t_(this.paddingOffset,v))},b)}async fitCenter(t){let e=this.context.canvas.getBounds();await this.focus(e,t)}async focusElements(t,e){let{element:n}=this.context;if(!n)return;let i=tM(t.map(t=>n.getElement(t).getRenderBounds()));await this.focus(i,e)}async focus(t,e){let n=this.context.graph.getViewportByCanvas(t.center),i=this.getCanvasCenter(),s=tI(i,n);await this.transform({mode:"relative",translate:tL(s,this.paddingOffset)},e)}getBBoxInViewport(t){let{min:e,max:n}=t,{graph:i}=this.context,[s,r]=i.getViewportByCanvas(e),[a,o]=i.getViewportByCanvas(n),l=new N.mN;return l.setMinMax([s,r,0],[a,o,0]),l}isInViewport(t){let{graph:e}=this.context,n=this.getCanvasSize(),[i,s]=e.getCanvasByViewport([0,0]),[r,a]=e.getCanvasByViewport(n),o=new N.mN;return o.setMinMax([i,s,0],[r,a,0]),tE(t)?tA(t,o):o.intersects(t)}cancelAnimation(){var t,e;(null===(t=this.camera.landmarks)||void 0===t?void 0:t.length)&&this.camera.cancelLandmarkAnimation(),null===(e=this.transformResolver)||void 0===e||e.call(this)}constructor(t){this.landmarkCounter=0,this.context=t;let[e,n]=this.paddingOffset,{zoom:i,rotation:s,x:r=e,y:a=n}=t.options;this.transform({mode:"absolute",scale:i,translate:[r,a],rotate:s},!1)}}class aa extends sg.Z{getOptions(){return this.options}setOptions(t){var e,n,i;let{behaviors:s,combo:r,data:a,edge:o,height:l,layout:h,node:c,plugins:d,theme:u,transforms:p,width:g,cursor:f,renderer:y}=t;if(y){let t=this.context.canvas;t&&(this.emit(O.BEFORE_RENDERER_CHANGE,{renderer:this.options.renderer}),t.setRenderer(y),this.emit(O.AFTER_RENDERER_CHANGE,{renderer:y}))}Object.assign(this.options,t),f&&(null===(e=this.context.canvas)||void 0===e||e.setCursor(f)),s&&this.setBehaviors(s),r&&this.setCombo(r),a&&this.setData(a),o&&this.setEdge(o),h&&this.setLayout(h),c&&this.setNode(c),u&&this.setTheme(u),d&&this.setPlugins(d),p&&this.setTransforms(p),(el(g)||el(l))&&this.setSize(null!==(n=null!=g?g:this.options.width)&&void 0!==n?n:0,null!==(i=null!=l?l:this.options.height)&&void 0!==i?i:0)}getSize(){return this.context.canvas?this.context.canvas.getSize():[this.options.width||0,this.options.height||0]}setSize(t,e){var n;Object.assign(this.options,{width:t,height:e}),null===(n=this.context.canvas)||void 0===n||n.resize(t,e)}setZoomRange(t){this.options.zoomRange=t}getZoomRange(){return this.options.zoomRange}setNode(t){this.options.node=t,this.context.model.refreshData()}setEdge(t){this.options.edge=t,this.context.model.refreshData()}setCombo(t){this.options.combo=t,this.context.model.refreshData()}getTheme(){return this.options.theme}setTheme(t){this.options.theme=tv(t)?t(this.getTheme()):t}setLayout(t){this.options.layout=tv(t)?t(this.getLayout()):t}getLayout(){return this.options.layout}setBehaviors(t){var e;this.options.behaviors=tv(t)?t(this.getBehaviors()):t,null===(e=this.context.behavior)||void 0===e||e.setBehaviors(this.options.behaviors)}updateBehavior(t){this.setBehaviors(e=>e.map(e=>"object"==typeof e&&e.key===t.key?{...e,...t}:e))}getBehaviors(){return this.options.behaviors||[]}setPlugins(t){var e;this.options.plugins=tv(t)?t(this.getPlugins()):t,null===(e=this.context.plugin)||void 0===e||e.setPlugins(this.options.plugins)}updatePlugin(t){this.setPlugins(e=>e.map(e=>"object"==typeof e&&e.key===t.key?{...e,...t}:e))}getPlugins(){return this.options.plugins||[]}getPluginInstance(t){return this.context.plugin.getPluginInstance(t)}setTransforms(t){var e;this.options.transforms=tv(t)?t(this.getTransforms()):t,null===(e=this.context.transform)||void 0===e||e.setTransforms(this.options.transforms)}updateTransform(t){this.setTransforms(e=>e.map(e=>"object"==typeof e&&e.key===t.key?{...e,...t}:e)),this.context.model.refreshData()}getTransforms(){return this.options.transforms||[]}getData(){return this.context.model.getData()}getElementData(t){return Array.isArray(t)?t.map(t=>this.context.model.getElementDataById(t)):this.context.model.getElementDataById(t)}getNodeData(t){var e;return void 0===t?this.context.model.getNodeData():Array.isArray(t)?this.context.model.getNodeData(t):null===(e=this.context.model.getNodeData([t]))||void 0===e?void 0:e[0]}getEdgeData(t){var e;return void 0===t?this.context.model.getEdgeData():Array.isArray(t)?this.context.model.getEdgeData(t):null===(e=this.context.model.getEdgeData([t]))||void 0===e?void 0:e[0]}getComboData(t){var e;return void 0===t?this.context.model.getComboData():Array.isArray(t)?this.context.model.getComboData(t):null===(e=this.context.model.getComboData([t]))||void 0===e?void 0:e[0]}setData(t){this.context.model.setData(tv(t)?t(this.getData()):t)}addData(t){this.context.model.addData(tv(t)?t(this.getData()):t)}addNodeData(t){this.context.model.addNodeData(tv(t)?t(this.getNodeData()):t)}addEdgeData(t){this.context.model.addEdgeData(tv(t)?t(this.getEdgeData()):t)}addComboData(t){this.context.model.addComboData(tv(t)?t(this.getComboData()):t)}addChildrenData(t,e){this.context.model.addChildrenData(t,e)}updateData(t){this.context.model.updateData(tv(t)?t(this.getData()):t)}updateNodeData(t){this.context.model.updateNodeData(tv(t)?t(this.getNodeData()):t)}updateEdgeData(t){this.context.model.updateEdgeData(tv(t)?t(this.getEdgeData()):t)}updateComboData(t){this.context.model.updateComboData(tv(t)?t(this.getComboData()):t)}removeData(t){this.context.model.removeData(tv(t)?t(this.getData()):t)}removeNodeData(t){this.context.model.removeNodeData(tv(t)?t(this.getNodeData()):t)}removeEdgeData(t){this.context.model.removeEdgeData(tv(t)?t(this.getEdgeData()):t)}removeComboData(t){this.context.model.removeComboData(tv(t)?t(this.getComboData()):t)}getElementType(t){return this.context.model.getElementType(t)}getRelatedEdgesData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";return this.context.model.getRelatedEdgesData(t,e)}getNeighborNodesData(t){return this.context.model.getNeighborNodesData(t)}getAncestorsData(t,e){return this.context.model.getAncestorsData(t,e)}getParentData(t,e){return this.context.model.getParentData(t,e)}getChildrenData(t){return this.context.model.getChildrenData(t)}getElementDataByState(t,e){return this.context.model.getElementDataByState(t,e)}async initCanvas(){if(this.context.canvas)return await this.context.canvas.ready;let{container:t="container",width:e,height:n,renderer:i,cursor:s,background:r}=this.options;if(t instanceof rq)this.context.canvas=t,s&&t.setCursor(s),await t.ready;else{let a=H(t)?document.getElementById(t):t,o=iz(a);this.emit(O.BEFORE_CANVAS_INIT,{container:a,width:e,height:n});let l=new rq({container:a,width:e||o[0],height:n||o[1],background:r,renderer:i,cursor:s});this.context.canvas=l,await l.ready,this.emit(O.AFTER_CANVAS_INIT,{canvas:l})}}initRuntime(){this.context.options=this.options,this.context.batch||(this.context.batch=new rK(this.context)),this.context.plugin||(this.context.plugin=new an(this.context)),this.context.viewport||(this.context.viewport=new ar(this.context)),this.context.transform||(this.context.transform=new as(this.context)),this.context.element||(this.context.element=new r4(this.context)),this.context.animation||(this.context.animation=new rU(this.context)),this.context.layout||(this.context.layout=new at(this.context)),this.context.behavior||(this.context.behavior=new rZ(this.context))}async prepare(){if(await Promise.resolve(),this.destroyed)throw Error($("The graph instance has been destroyed"));await this.initCanvas(),this.initRuntime()}async render(){await this.prepare(),rY(this,new rH(O.BEFORE_RENDER));let t=this.context.element.draw({type:"render"});await Promise.all([null==t?void 0:t.finished,this.context.layout.layout()]),await this.autoFit(),rY(this,new rH(O.AFTER_RENDER))}async draw(){var t;await this.prepare(),await (null===(t=this.context.element.draw())||void 0===t?void 0:t.finished)}async layout(){await this.context.layout.layout()}stopLayout(){this.context.layout.stopLayout()}async clear(){this.context.model.setData({}),await this.draw()}destroy(){rY(this,new rH(O.BEFORE_DESTROY));let{layout:t,animation:e,element:n,model:i,canvas:s,behavior:r,plugin:a}=this.context;null==a||a.destroy(),null==r||r.destroy(),null==t||t.destroy(),null==e||e.destroy(),null==n||n.destroy(),i.destroy(),null==s||s.destroy(),this.options={},this.context={},this.off(),window.removeEventListener("resize",this.onResize),this.destroyed=!0,rY(this,new rH(O.AFTER_DESTROY))}getCanvas(){return this.context.canvas}resize(t,e){let n=t&&e?[t,e]:iz(this.context.canvas.getContainer());W(n,this.getSize())||(rY(this,new rH(O.BEFORE_SIZE_CHANGE,{size:n})),this.context.canvas.resize(...n),rY(this,new rH(O.AFTER_SIZE_CHANGE,{size:n})))}async fitView(t,e){var n;await (null===(n=this.context.viewport)||void 0===n?void 0:n.fitView(t,e))}async fitCenter(t){var e;await (null===(e=this.context.viewport)||void 0===e?void 0:e.fitCenter(t))}async autoFit(){let{autoFit:t}=this.context.options;if(t){if(H(t))"view"===t?await this.fitView():"center"===t&&await this.fitCenter();else{let{type:e,animation:n}=t;"view"===e?await this.fitView(t.options,n):"center"===e&&await this.fitCenter(n)}}}async focusElement(t,e){var n;await (null===(n=this.context.viewport)||void 0===n?void 0:n.focusElements(Array.isArray(t)?t:[t],e))}async zoomBy(t,e,n){await this.context.viewport.transform({mode:"relative",scale:t,origin:n},e)}async zoomTo(t,e,n){this.context.viewport.transform({mode:"absolute",scale:t,origin:n},e)}getZoom(){return this.context.viewport.getZoom()}async rotateBy(t,e,n){await this.context.viewport.transform({mode:"relative",rotate:t,origin:n},e)}async rotateTo(t,e,n){await this.context.viewport.transform({mode:"absolute",rotate:t,origin:n},e)}getRotation(){return this.context.viewport.getRotation()}async translateBy(t,e){await this.context.viewport.transform({mode:"relative",translate:t},e)}async translateTo(t,e){await this.context.viewport.transform({mode:"absolute",translate:t},e)}getPosition(){return tI([0,0],this.getCanvasByViewport([0,0]))}async translateElementBy(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[s,r]=V(t)?[t,null==e||e]:[{[t]:e},i];Object.entries(s).forEach(t=>{let[e,n]=t;return this.context.model.translateNodeLikeBy(e,n)}),await (null===(n=this.context.element.draw({animation:r,stage:"translate"}))||void 0===n?void 0:n.finished)}async translateElementTo(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[s,r]=V(t)?[t,null==e||e]:[{[t]:e},i];Object.entries(s).forEach(t=>{let[e,n]=t;return this.context.model.translateNodeLikeTo(e,n)}),await (null===(n=this.context.element.draw({animation:r,stage:"translate"}))||void 0===n?void 0:n.finished)}getElementPosition(t){return this.context.model.getElementPosition(t)}getElementRenderStyle(t){return iF(this.context.element.getElement(t).attributes,["context"])}async setElementVisibility(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[s,r]=V(t)?[t,null==e||e]:[{[t]:e},i],a={nodes:[],edges:[],combos:[]};Object.entries(s).forEach(t=>{let[e,n]=t,i=this.getElementType(e);a["".concat(i,"s")].push({id:e,style:{visibility:n}})});let{model:o,element:l}=this.context;o.preventUpdateNodeLikeHierarchy(()=>{o.updateData(a)}),await (null===(n=l.draw({animation:r,stage:"visibility"}))||void 0===n?void 0:n.finished)}async showElement(t,e){let n=Array.isArray(t)?t:[t];await this.setElementVisibility(Object.fromEntries(n.map(t=>[t,"visible"])),e)}async hideElement(t,e){let n=Array.isArray(t)?t:[t];await this.setElementVisibility(Object.fromEntries(n.map(t=>[t,"hidden"])),e)}getElementVisibility(t){var e,n;let i=this.context.element.getElement(t);return null!==(n=null==i?void 0:null===(e=i.style)||void 0===e?void 0:e.visibility)&&void 0!==n?n:"visible"}async setElementZIndex(t,e){var n;let i={nodes:[],edges:[],combos:[]},s=V(t)?t:{[t]:e};Object.entries(s).forEach(t=>{let[e,n]=t,s=this.getElementType(e);i["".concat(s,"s")].push({id:e,style:{zIndex:n}})});let{model:r,element:a}=this.context;r.preventUpdateNodeLikeHierarchy(()=>r.updateData(i)),await (null===(n=a.draw({animation:!1,stage:"zIndex"}))||void 0===n?void 0:n.finished)}async frontElement(t){let e=Array.isArray(t)?t:[t],{model:n,element:i}=this.context,s={};e.map(t=>{let e=i.getFrontZIndex(t),r=n.getElementType(t);if("combo"===r){let r=n.getAncestorsData(t,U).at(-1)||this.getComboData(t),a=[r,...n.getDescendantsData(ta(r))],o=e-i.getElementZIndex(t);a.forEach(t=>{s[ta(t)]=this.getElementZIndex(ta(t))+o})}else s[t]=e}),await this.setElementZIndex(s)}getElementZIndex(t){var e,n,i;let{model:s,element:r}=this.context;return null!==(i=null===(e=s.getElementDataById(t))||void 0===e?void 0:null===(n=e.style)||void 0===n?void 0:n.zIndex)&&void 0!==i?i:r.getElementZIndex(t)}async setElementState(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[s,r]=V(t)?[t,null==e||e]:[{[t]:e},i],a=t=>t?Array.isArray(t)?t:[t]:[],o={nodes:[],edges:[],combos:[]};Object.entries(s).forEach(t=>{let[e,n]=t,i=this.getElementType(e);o["".concat(i,"s")].push({id:e,states:a(n)})}),this.updateData(o),await (null===(n=this.context.element.draw({animation:r}))||void 0===n?void 0:n.finished)}getElementState(t){return this.context.model.getElementState(t)}getElementRenderBounds(t){return this.context.element.getElement(t).getRenderBounds()}async collapseElement(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{model:n,element:i}=this.context;if(ea(n.getNodeLikeData([t])[0])||this.isCollapsingExpanding)return;let s=n.getElementType(t);await this.frontElement(t),this.isCollapsingExpanding=!0,this.setElementCollapsibility(t,!0),"node"===s?await i.collapseNode(t,e):"combo"===s&&await i.collapseCombo(t,e),this.isCollapsingExpanding=!1}async expandElement(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{model:n,element:i}=this.context;if(!ea(n.getNodeLikeData([t])[0])||this.isCollapsingExpanding)return;let s=n.getElementType(t);this.isCollapsingExpanding=!0,this.setElementCollapsibility(t,!1),"node"===s?await i.expandNode(t,e):"combo"===s&&await i.expandCombo(t,e),this.isCollapsingExpanding=!1}setElementCollapsibility(t,e){let n=this.getElementType(t);"node"===n?this.updateNodeData([{id:t,style:{collapsed:e}}]):"combo"===n&&this.updateComboData([{id:t,style:{collapsed:e}}])}async toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.context.canvas.toDataURL(t)}getCanvasByViewport(t){return this.context.canvas.getCanvasByViewport(t)}getViewportByCanvas(t){return this.context.canvas.getViewportByCanvas(t)}getClientByCanvas(t){return this.context.canvas.getClientByCanvas(t)}getCanvasByClient(t){return this.context.canvas.getCanvasByClient(t)}getViewportCenter(){return this.context.viewport.getViewportCenter()}getCanvasCenter(){return this.context.viewport.getCanvasCenter()}on(t,e,n){return super.on(t,e,n)}once(t,e){return super.once(t,e)}off(t,e){return super.off(t,e)}constructor(t){super(),this.destroyed=!1,this.context={model:new r6},this.isCollapsingExpanding=!1,this.onResize=io(()=>{this.resize()},300),this.options=Object.assign({},aa.defaultOptions,t),this.setOptions(this.options),this.context.graph=this,this.options.autoResize&&window.addEventListener("resize",this.onResize)}}aa.defaultOptions={autoResize:!1,theme:"light",rotation:0,zoom:1,zoomRange:[.01,10]};let ao=(t,e)=>{let{source:n,target:i}=e,s=t.getElementDataById(n),r=t.getElementDataById(i),a=nO(s,e=>t.getParentData(e,U)),o=nO(r,e=>t.getParentData(e,U)),l=ta(a),h=ta(o),c={sourceNode:l,targetNode:h};return e.style?Object.assign(e.style,c):e.style=c,e};var al=function(t){return z(t,"Boolean")};let ah=["top","top-right","right","right-bottom","bottom","bottom-left","left","left-top"];class ac extends r_{beforeDraw(t){let e=this.getAffectedParallelEdges(t);return 0===e.size||("bundle"===this.options.mode?this.applyBundlingStyle(t,e,this.options.distance):this.applyMergingStyle(t,e)),t}constructor(t,e){super(t,Object.assign({},ac.defaultOptions,e)),this.cacheMergeStyle=new Map,this.getAffectedParallelEdges=t=>{let{add:{edges:e},update:{nodes:n,edges:i,combos:s},remove:{edges:r}}=t,{model:a}=this.context,o=new Map,l=(t,e)=>{let n=a.getRelatedEdgesData(e);n.forEach(t=>!o.has(ta(t))&&o.set(ta(t),t))};n.forEach(l),s.forEach(l);let h=t=>{let e=a.getEdgeData().map(t=>ao(a,t)),n=au(t,e,!0);n.forEach(t=>!o.has(ta(t))&&o.set(ta(t),t))};if(r.size&&r.forEach(h),e.size&&e.forEach(h),i.size){let t=sy(sf(a.getChanges())).update.edges;i.forEach(e=>{var n;h(e);let i=null===(n=t.find(t=>ta(t.value)===ta(e)))||void 0===n?void 0:n.original;i&&!ap(e,i)&&h(i)})}e_(this.options.edges)||o.forEach((t,e)=>!this.options.edges.includes(e)&&o.delete(e));let c=a.getEdgeData().map(ta);return new Map([...o].sort((t,e)=>c.indexOf(t[0])-c.indexOf(e[0])))},this.applyBundlingStyle=(t,e,n)=>{let{edgeMap:i,reverses:s}=ad(e);i.forEach(e=>{e.forEach((e,i,r)=>{var a;let o=Object.assign(e,{type:"quadratic",style:(()=>{let t=r.length,a={};if(e.source===e.target){let t=ah.length;a.loopPlacement=ah[i%t],a.loopDist=Math.floor(i/t)*n+50}else if(1===t)a.curveOffset=0;else{let r=(i%2==0?1:-1)*(s["".concat(e.source,"|").concat(e.target,"|").concat(i)]?-1:1);a.curveOffset=t%2==1?r*Math.ceil(i/2)*n*2:r*(Math.floor(i/2)*n*2+n)}return Object.assign({},e.style,a)})()}),l=null===(a=this.context.element)||void 0===a?void 0:a.getElement(ta(e));l?th(t,"update","edge",o,!0):th(t,"add","edge",o,!0)})})},this.resetEdgeStyle=t=>{let e=t.style||{},n=this.cacheMergeStyle.get(ta(t))||{};return Object.keys(n).forEach(i=>{W(e[i],n[i])&&(t[i]?e[i]=t[i]:delete e[i])}),Object.assign(t,{style:e})},this.applyMergingStyle=(t,e)=>{let{edgeMap:n,reverses:i}=ad(e);n.forEach(e=>{if(1===e.length){var n;let i=e[0],s=null===(n=this.context.element)||void 0===n?void 0:n.getElement(ta(i));th(t,s?"update":"add","edge",this.resetEdgeStyle(i),!0);return}let s=e.map((t,e)=>{let{source:n,target:s,style:r={}}=t,{startArrow:a,endArrow:o}=r,l={},[h,c]=i["".concat(n,"|").concat(s,"|").concat(e)]?["endArrow","startArrow"]:["startArrow","endArrow"];return al(a)&&(l[h]=a),al(o)&&(l[c]=o),l}).reduce((t,e)=>({...t,...e}),{});e.forEach((e,n,i)=>{if(0===n){var r;let n=Object.assign({},tv(this.options.style)?this.options.style(i):this.options.style,{childrenData:i});this.cacheMergeStyle.set(ta(e),n);let a={...e,type:"line",style:{...s,...n}},o=null===(r=this.context.element)||void 0===r?void 0:r.getElement(ta(e));th(t,o?"update":"add","edge",a,!0)}else th(t,"remove","edge",e)})})}}}ac.defaultOptions={mode:"bundle",edges:void 0,distance:15};let ad=t=>{let e=new Map,n=new Set,i={};for(let[s,r]of t){if(n.has(s))continue;let{source:a,target:o}=r,l="".concat(a,"-").concat(o);for(let[h,c]of(e.has(l)||e.set(l,[]),e.get(l).push(r),n.add(s),t))!n.has(h)&&ap(r,c)&&(e.get(l).push(c),n.add(h),a===c.target&&o===c.source&&(i["".concat(c.source,"|").concat(c.target,"|").concat(e.get(l).length-1)]=!0))}return{edgeMap:e,reverses:i}},au=(t,e,n)=>e.filter(e=>(n||ta(e)!==ta(t))&&ap(e,t)),ap=(t,e)=>{let{sourceNode:n,targetNode:i}=t.style||{},{sourceNode:s,targetNode:r}=e.style||{};return n===s&&i===r||n===r&&i===s},ag={animation:{"combo-collapse":tp,"combo-expand":tp,"node-collapse":td,"node-expand":td,"path-in":tu,"path-out":tu,fade:[{fields:["opacity"]}],translate:[{fields:["x","y"]}]},behavior:{"brush-select":t5,"click-select":er,"collapse-expand":ii,"create-edge":ia,"drag-canvas":il,"drag-element-force":class extends ih{get forceLayoutInstance(){return this.context.layout.getLayoutInstance().find(t=>["d3-force","d3-force-3d"].includes(null==t?void 0:t.id))}validate(t){return!!this.context.layout&&(this.forceLayoutInstance?super.validate(t):(q.warn("DragElementForce only works with d3-force or d3-force-3d layout"),!1))}async moveElement(t,e){let n=this.forceLayoutInstance;this.context.graph.getNodeData(t).forEach((i,s)=>{let{x:r=0,y:a=0}=i.style||{};n&&ip(n,"setFixedPosition",t[s],[...tL([+r,+a],e)])})}onDragStart(t){if(this.enable=this.validate(t),!this.enable)return;this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target);let e=this.forceLayoutInstance;e&&ig(e,"simulation").alphaTarget(.3).restart(),this.context.graph.getNodeData(this.target).forEach(t=>{let{x:n=0,y:i=0}=t.style||{};e&&ip(e,"setFixedPosition",ta(t),[+n,+i])})}onDrag(t){if(!this.enable)return;let e=this.getDelta(t);this.moveElement(this.target,e)}onDragEnd(){let t=this.forceLayoutInstance;t&&ig(t,"simulation").alphaTarget(0),this.context.graph.getNodeData(this.target).forEach(e=>{t&&ip(t,"setFixedPosition",ta(e),[null,null,null])})}},"drag-element":ih,"fix-element-size":iy,"focus-element":im,"hover-activate":iv,"lasso-select":class extends t5{onPointerDown(t){if(!super.validate(t)||!super.isKeydown()||this.points)return;let{canvas:e}=this.context;this.pathShape=new N.y$({id:"g6-lasso-select",style:this.options.style}),e.appendChild(this.pathShape),this.points=[t7(t)]}onPointerMove(t){var e;if(!this.points)return;let{immediately:n,mode:i}=this.options;this.points.push(t7(t)),null===(e=this.pathShape)||void 0===e||e.setAttribute("d",function(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=[];return t.forEach((t,e)=>{n.push([0===e?"M":"L",...t])}),e&&n.push(["Z"]),n}(this.points)),n&&"default"===i&&this.points.length>2&&super.updateElementsStates(this.points)}onPointerUp(){if(this.points){if(this.points.length<2){this.clearLasso();return}super.updateElementsStates(this.points),this.clearLasso()}}clearLasso(){var t;null===(t=this.pathShape)||void 0===t||t.remove(),this.pathShape=void 0,this.points=void 0}},"optimize-viewport-transform":ib,"scroll-canvas":iE,"zoom-canvas":iw},combo:{circle:class extends nr{drawKeyShape(t,e){return this.upsert("key",N.Cd,this.getKeyStyle(t),e)}getKeyStyle(t){let{collapsed:e}=t,n=super.getKeyStyle(t),[i]=this.getKeySize(t);return{...n,...e&&eu(n,"collapsed"),r:i/2}}getCollapsedKeySize(t){let[e,n]=ef(t.collapsedSize),i=Math.max(e,n)/2;return[2*i,2*i,0]}getExpandedKeySize(t){let e=this.getContentBBox(t),[n,i]=tO(e),s=Math.sqrt(n**2+i**2)/2;return[2*s,2*s,0]}getIntersectPoint(t){let e=this.getShape("key").getBounds();return t2(t,e)}constructor(t){super(t)}},rect:class extends nr{drawKeyShape(t,e){return this.upsert("key",N.UL,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t),[n,i]=this.getKeySize(t);return{...e,...t.collapsed&&eu(e,"collapsed"),width:n,height:i,x:-n/2,y:-i/2}}constructor(t){super(t)}}},edge:{cubic:nI,line:nF,polyline:nX,quadratic:n$,"cubic-horizontal":nB,"cubic-vertical":n_},layout:{"antv-dagre":iC.b,"combo-combined":iD.u,"compact-box":iS.compactBox,"force-atlas2":iR.E,circular:iO.S,concentric:iT.W,"d3-force":iM.j,dagre:iA.V,dendrogram:iS.dendrogram,force:ik.y,fruchterman:iP.O,grid:iN.M,indented:iS.indented,mds:iL.A,mindmap:iS.mindmap,radial:iI.D,random:iB._},node:{circle:e0,diamond:class extends e1{getPoints(t){let[e,n]=this.getSize(t);return[[0,-n/2],[e/2,0],[0,n/2],[-e/2,0]]}constructor(t){super(t)}},ellipse:e9,hexagon:class extends e1{getOuterR(t){return t.outerR||Math.min(...this.getSize(t))/2}getPoints(t){var e;return[[0,e=this.getOuterR(t)],[e*Math.sqrt(3)/2,e/2],[e*Math.sqrt(3)/2,-e/2],[0,-e],[-e*Math.sqrt(3)/2,-e/2],[-e*Math.sqrt(3)/2,e/2]]}getIconStyle(t){let e=super.getIconStyle(t),n=.8*this.getOuterR(t);return!!e&&{width:n,height:n,...e}}constructor(t){super(t)}},html:nn,image:ni,rect:class extends eQ{getKeyStyle(t){let[e,n]=this.getSize(t);return{...super.getKeyStyle(t),width:e,height:n,x:-e/2,y:-n/2}}getIconStyle(t){let e=super.getIconStyle(t),{width:n,height:i}=this.getShape("key").attributes;return!!e&&{width:.8*n,height:.8*i,...e}}drawKeyShape(t,e){return this.upsert("key",N.UL,this.getKeyStyle(t),e)}constructor(t){super(t)}},star:class extends e1{getInnerR(t){return t.innerR||3*this.getOuterR(t)/8}getOuterR(t){return Math.min(...this.getSize(t))/2}getPoints(t){var e,n;return[[0,-(e=this.getOuterR(t))],[(n=this.getInnerR(t))*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)],[e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[0,n],[-e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[-n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[-e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[-n*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)]]}getIconStyle(t){let e=super.getIconStyle(t),n=2*this.getInnerR(t)*.8;return!!e&&{width:n,height:n,...e}}getPortXY(t,e){let{placement:n="top"}=e,i=this.getShape("key").getLocalBounds(),s=function(t,e){let n={};return n.top=[0,-t],n.left=[-t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n["left-bottom"]=[-t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.bottom=[0,e],n["right-bottom"]=[t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.right=n.default=[t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n}(this.getOuterR(t),this.getInnerR(t));return n1(i,n,s,!1)}constructor(t){super(t)}},donut:e2,triangle:ns},palette:{spectral:["rgb(158, 1, 66)","rgb(213, 62, 79)","rgb(244, 109, 67)","rgb(253, 174, 97)","rgb(254, 224, 139)","rgb(255, 255, 191)","rgb(230, 245, 152)","rgb(171, 221, 164)","rgb(102, 194, 165)","rgb(50, 136, 189)","rgb(94, 79, 162)"],tableau:["rgb(78, 121, 167)","rgb(242, 142, 44)","rgb(225, 87, 89)","rgb(118, 183, 178)","rgb(89, 161, 79)","rgb(237, 201, 73)","rgb(175, 122, 161)","rgb(255, 157, 167)","rgb(156, 117, 95)","rgb(186, 176, 171)"],oranges:["rgb(255, 245, 235)","rgb(254, 230, 206)","rgb(253, 208, 162)","rgb(253, 174, 107)","rgb(253, 141, 60)","rgb(241, 105, 19)","rgb(217, 72, 1)","rgb(166, 54, 3)","rgb(127, 39, 4)"],greens:["rgb(247, 252, 245)","rgb(229, 245, 224)","rgb(199, 233, 192)","rgb(161, 217, 155)","rgb(116, 196, 118)","rgb(65, 171, 93)","rgb(35, 139, 69)","rgb(0, 109, 44)","rgb(0, 68, 27)"],blues:["rgb(247, 251, 255)","rgb(222, 235, 247)","rgb(198, 219, 239)","rgb(158, 202, 225)","rgb(107, 174, 214)","rgb(66, 146, 198)","rgb(33, 113, 181)","rgb(8, 81, 156)","rgb(8, 48, 107)"]},theme:{dark:rI,light:rB},plugin:{"bubble-sets":sa,"edge-filter-lens":sd,"grid-line":sp,background:iG,contextmenu:sh,fullscreen:su,history:sm,hull:sO,legend:sM,minimap:sk,snapline:sI,timebar:rE,toolbar:rC,tooltip:rD,watermark:rR},transform:{"update-related-edges":class extends r_{beforeDraw(t,e){let{stage:n}=e;if("visibility"===n)return t;let{model:i}=this.context,{update:{nodes:s,edges:r,combos:a}}=t,o=(t,e)=>{let n=i.getRelatedEdgesData(e);n.forEach(t=>!r.has(ta(t))&&r.set(ta(t),t))};return s.forEach(o),a.forEach(o),t}},"arrange-draw-order":class extends r_{beforeDraw(t){let{model:e}=this.context,n=t.add.combos,i=t=>{let n=[];return t.forEach((t,i)=>{let s=e.getAncestorsData(i,"combo"),r=s.map(t=>ta(t)).reverse();n.push([i,t,r.length])}),new Map(n.sort((t,e)=>{let[,,n]=t,[,,i]=e;return i-n}).map(t=>{let[e,n]=t;return[e,n]}))};return t.add.combos=i(n),t.update.combos=i(t.update.combos),t}},"collapse-expand-combo":class extends r_{beforeDraw(t,e){if("visibility"===e.stage)return t;let{model:n}=this.context,{add:i,update:s}=t,r=[...t.update.combos.entries(),...t.add.combos.entries()];for(;r.length;){let[e,a]=r.pop();if(ea(a)){let a=n.getDescendantsData(e),o=a.map(ta),{internal:l,external:h}=nC(o,t=>n.getRelatedEdgesData(t));a.forEach(e=>{let i=ta(e),s=r.findIndex(t=>{let[e]=t;return e===i});-1!==s&&r.splice(s,1);let a=n.getElementType(i);rF(t,"remove",a,e)}),l.forEach(e=>rF(t,"remove","edge",e)),h.forEach(t=>{var e;let n=ta(t),r=null===(e=this.context.element)||void 0===e?void 0:e.getElement(n);r?s.edges.set(n,t):i.edges.set(n,t)})}else{let i=n.getChildrenData(e),s=i.map(ta),{edges:a}=nC(s,t=>n.getRelatedEdgesData(t));[...i,...a].forEach(e=>{var i;let s=ta(e),a=n.getElementType(s),o=null===(i=this.context.element)||void 0===i?void 0:i.getElement(s);o?rF(t,"update",a,e):rF(t,"add",a,e),"combo"===a&&r.push([s,e])})}}return t}},"collapse-expand-node":class extends r_{getElement(t){return this.context.element.getElement(t)}handleExpand(t,e){if(rj(e,"add","node",t),ea(t))return;let n=ta(t);rj(e,"add","node",t);let i=this.context.model.getRelatedEdgesData(n,"out");i.forEach(t=>{rF(e,"add","edge",t)});let s=this.context.model.getChildrenData(n);s.forEach(t=>{this.handleExpand(t,e)})}beforeDraw(t){let{graph:e,model:n}=this.context,{add:{nodes:i,edges:s},update:{nodes:r}}=t,a=new Map,o=new Map;i.forEach((t,e)=>{ea(t)&&a.set(e,t)}),s.forEach(t=>{if("node"!==e.getElementType(t.source))return;let n=e.getNodeData(t.source);ea(n)&&a.set(t.source,n)}),r.forEach((t,e)=>{let n=this.getElement(e);if(!n)return;let i=n.attributes.collapsed;ea(t)?i||a.set(e,t):i&&o.set(e,t)});let l=new Set;return a.forEach((e,i)=>{let s=n.getDescendantsData(i);s.forEach(e=>{let i=ta(e);if(l.has(i))return;rF(t,"remove","node",e);let s=n.getRelatedEdgesData(i);s.forEach(e=>{rF(t,"remove","edge",e)}),l.add(i)})}),o.forEach((e,i)=>{let s=n.getAncestorsData(i,K);if(s.some(ea)){rF(t,"remove","node",e);return}this.handleExpand(e,t)}),t}},"process-parallel-edges":ac,"get-edge-actual-ends":class extends r_{beforeDraw(t){let{add:e,update:n}=t,{model:i}=this.context;return[...e.edges.entries(),...n.edges.entries()].forEach(t=>{let[,e]=t;ao(i,e)}),t}}},shape:{circle:N.Cd,ellipse:N.Pj,group:N.ZA,html:N.k9,image:eY,line:N.x1,path:N.y$,polygon:N.mg,polyline:N.aH,rect:N.UL,text:N.xv,label:ez,badge:eH}};N.GZ.enableCSSParsing=!1,Object.entries(ag).forEach(t=>{let[e,n]=t;Object.entries(n).forEach(t=>{let[n,i]=t;!function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=Z[t][e];!i&&s?s!==n&&q.warn("The extension ".concat(e," of ").concat(t," has been registered before.")):Object.assign(Z[t],{[e]:n})}(e,n,i)})})},99397:function(t,e,n){"use strict";n.d(e,{P3:function(){return d}});var i=n(67294),s=i.createContext({graph:null,isReady:!1}),r=n(60976),a=function(){return(a=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},o=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,s,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){s={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return a},l=function(){return(l=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},h=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)0>e.indexOf(i[s])&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n},c=(0,i.forwardRef)(function(t,e){var n,c,d,u,p,g,f,y,m,v,b=t.style,E=t.children,x=(c=(n=h(t,["style","children"])).onInit,d=n.onReady,u=n.onDestroy,p=n.options,f=(g=o((0,i.useState)(!1),2))[0],y=g[1],m=(0,i.useRef)(null),v=(0,i.useRef)(null),(0,i.useEffect)(function(){if(!m.current&&v.current){var t=new r.kJ(a({container:v.current},p));return m.current=t,y(!0),null==c||c(m.current),function(){var t=m.current;t&&(t.destroy(),null==u||u(),m.current=null)}}},[]),(0,i.useEffect)(function(){var t=v.current,e=m.current;p&&t&&e&&!e.destroyed&&(e.setOptions(p),e.render().then(function(){return null==d?void 0:d(e)}))},[p]),{graph:m.current,containerRef:v,isReady:f}),w=x.graph,S=x.containerRef,C=x.isReady;(0,i.useImperativeHandle)(e,function(){return w},[w]);var O=l({height:"inherit",position:"relative"},b);return E?i.createElement(s.Provider,{value:{graph:w,isReady:C}},i.createElement("div",{ref:S,style:O},C&&E)):i.createElement("div",{ref:S,style:O})}),d=(0,i.memo)(c)},53640:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var i=n(61120),s=n(78814),r=n(82963);function a(t,e,n){return e=(0,i.Z)(e),(0,r.Z)(t,(0,s.Z)()?Reflect.construct(e,n||[],(0,i.Z)(t).constructor):e.apply(t,n))}},54375:function(t,e,n){"use strict";n.d(e,{Ud:function(){return d},Yy:function(){return r}});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let i=Symbol("Comlink.proxy"),s=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),o=Symbol("Comlink.thrown"),l=t=>"object"==typeof t&&null!==t||"function"==typeof t,h=new Map([["proxy",{canHandle:t=>l(t)&&t[i],serialize(t){let{port1:e,port2:n}=new MessageChannel;return function t(e,n=globalThis,s=["*"]){n.addEventListener("message",function r(l){let h;if(!l||!l.data)return;if(!function(t,e){for(let n of t)if(e===n||"*"===n||n instanceof RegExp&&n.test(e))return!0;return!1}(s,l.origin)){console.warn(`Invalid origin '${l.origin}' for comlink proxy`);return}let{id:d,type:u,path:p}=Object.assign({path:[]},l.data),g=(l.data.argumentList||[]).map(b);try{var f;let n=p.slice(0,-1).reduce((t,e)=>t[e],e),s=p.reduce((t,e)=>t[e],e);switch(u){case"GET":h=s;break;case"SET":n[p.slice(-1)[0]]=b(l.data.value),h=!0;break;case"APPLY":h=s.apply(n,g);break;case"CONSTRUCT":{let t=new s(...g);h=Object.assign(t,{[i]:!0})}break;case"ENDPOINT":{let{port1:n,port2:i}=new MessageChannel;t(e,i),f=[n],m.set(n,f),h=n}break;case"RELEASE":h=void 0;break;default:return}}catch(t){h={value:t,[o]:0}}Promise.resolve(h).catch(t=>({value:t,[o]:0})).then(t=>{let[i,s]=v(t);n.postMessage(Object.assign(Object.assign({},i),{id:d}),s),"RELEASE"===u&&(n.removeEventListener("message",r),c(n),a in e&&"function"==typeof e[a]&&e[a]())}).catch(t=>{let[e,i]=v({value:TypeError("Unserializable return value"),[o]:0});n.postMessage(Object.assign(Object.assign({},e),{id:d}),i)})}),n.start&&n.start()}(t,e),[n,[n]]},deserialize:t=>(t.start(),d(t))}],["throw",{canHandle:t=>l(t)&&o in t,serialize:({value:t})=>[t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[]],deserialize(t){if(t.isError)throw Object.assign(Error(t.value.message),t.value);throw t.value}}]]);function c(t){"MessagePort"===t.constructor.name&&t.close()}function d(t,e){return function t(e,n=[],i=function(){}){let a=!1,o=new Proxy(i,{get(i,s){if(u(a),s===r)return()=>{f&&f.unregister(o),p(e),a=!0};if("then"===s){if(0===n.length)return{then:()=>o};let t=E(e,{type:"GET",path:n.map(t=>t.toString())}).then(b);return t.then.bind(t)}return t(e,[...n,s])},set(t,i,s){u(a);let[r,o]=v(s);return E(e,{type:"SET",path:[...n,i].map(t=>t.toString()),value:r},o).then(b)},apply(i,r,o){u(a);let l=n[n.length-1];if(l===s)return E(e,{type:"ENDPOINT"}).then(b);if("bind"===l)return t(e,n.slice(0,-1));let[h,c]=y(o);return E(e,{type:"APPLY",path:n.map(t=>t.toString()),argumentList:h},c).then(b)},construct(t,i){u(a);let[s,r]=y(i);return E(e,{type:"CONSTRUCT",path:n.map(t=>t.toString()),argumentList:s},r).then(b)}});return!function(t,e){let n=(g.get(e)||0)+1;g.set(e,n),f&&f.register(t,e,t)}(o,e),o}(t,[],e)}function u(t){if(t)throw Error("Proxy has been released and is not useable")}function p(t){return E(t,{type:"RELEASE"}).then(()=>{c(t)})}let g=new WeakMap,f="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{let e=(g.get(t)||0)-1;g.set(t,e),0===e&&p(t)});function y(t){var e;let n=t.map(v);return[n.map(t=>t[0]),(e=n.map(t=>t[1]),Array.prototype.concat.apply([],e))]}let m=new WeakMap;function v(t){for(let[e,n]of h)if(n.canHandle(t)){let[i,s]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},s]}return[{type:"RAW",value:t},m.get(t)||[]]}function b(t){switch(t.type){case"HANDLER":return h.get(t.name).deserialize(t.value);case"RAW":return t.value}}function E(t,e,n){return new Promise(i=>{let s=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.addEventListener("message",function e(n){n.data&&n.data.id&&n.data.id===s&&(t.removeEventListener("message",e),i(n.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),n)})}}}]);